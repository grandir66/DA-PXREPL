import{L as H,r as e}from"./index-iBd0y6Oe.js";const R=H("ha_store",()=>{const i=e([]),d=e([]),f=e([]),v=e([]),h=e(null),p=e(null),g=e(null),A=e([]),l=e(!1),o=e(null),n=e(null),k=s=>{p.value=s,g.value=new Date},m=async(s=!1,y=!1)=>{if(!s&&o.value&&new Date().getTime()-o.value.getTime()<6e4)return;const u=localStorage.getItem("access_token");if(!u)return;let c=null;try{const t=await fetch("/api/nodes/",{headers:{Authorization:`Bearer ${u}`}});if(t.ok){const a=await t.json();a.length>0&&(c=a[0].id)}}catch(t){console.error(t)}if(c){y||(l.value=!0),n.value=null;try{const t=await fetch(`/api/ha/node/${c}/complete-data`,{headers:{Authorization:`Bearer ${u}`}});if(t.ok){const a=await t.json();i.value=a.ha_resources||[],d.value=a.ha_groups||[],f.value=a.guests||[],v.value=a.cluster_nodes||[],h.value=a.cluster_status||null,o.value=new Date}else n.value="Failed to load HA data"}catch(t){n.value="Network error loading HA data",console.error(t)}finally{y||(l.value=!1)}}};let r=null;const _=(s=3e4)=>{w(),r=setInterval(()=>{l.value||m(!0,!0)},s)},w=()=>{r&&(clearInterval(r),r=null)};return{haResources:i,haGroups:d,availableGuests:f,clusterNodes:v,clusterStatus:h,lastAnalysis:p,analysisTimestamp:g,migrationHistory:A,loading:l,lastUpdated:o,error:n,fetchHAData:m,setAnalysisResult:k,startBackgroundRefresh:_,stopBackgroundRefresh:w}});export{R as u};
