import{y as c,d as I,r as u,o as V,i as w,c as t,a as e,e as l,t as i,n as x,F as S,b as E,f as o,_ as F}from"./index-iBd0y6Oe.js";const b={checkForUpdates(){return c.get("/updates/check")},getStatus(){return c.get("/updates/status")},startUpdate(){return c.post("/updates/start")},getVersion(){return c.get("/updates/version")},refreshVersion(){return c.post("/updates/refresh-version")}},N={class:"updates-page"},z={class:"card version-card"},D={class:"card-header"},L=["disabled"],T={class:"card-body"},B={class:"version-info"},P={class:"version-current"},G={class:"version-number"},H={class:"version-number"},O={key:0,class:"badge badge-success"},M={key:1,class:"badge badge-secondary"},R={key:1,class:"last-check"},X={class:"text-secondary"},j={key:0,class:"card changelog-card"},q={class:"card-header"},J=["href"],K={class:"card-body"},Q={key:0,class:"release-date"},W={class:"changelog-content"},Y={key:1,class:"card action-card"},Z={class:"card-body"},$=["disabled"],ee={key:2,class:"card log-card"},se={class:"card-header"},ae={key:0,class:"badge badge-warning"},te={key:1,class:"badge badge-danger"},oe={key:2,class:"badge badge-success"},re={class:"card-body"},ne={key:0,class:"error-message"},le=I({__name:"Updates",setup(ie){const h=u(""),r=u(null),n=u(null),v=u(!1),g=u(null);let d=null;const p=async()=>{v.value=!0;try{const a=await b.checkForUpdates();r.value=a.data,h.value=a.data.current_version}catch(a){console.error("Errore verifica aggiornamenti:",a)}finally{v.value=!1}},f=async()=>{try{await b.startUpdate(),k()}catch(a){console.error("Errore avvio aggiornamento:",a)}},_=async()=>{try{const a=await b.getStatus();n.value=a.data,g.value&&(g.value.scrollTop=g.value.scrollHeight),!a.data.in_progress&&d&&(m(),p())}catch(a){console.error("Errore fetch status:",a)}},k=()=>{_(),d=window.setInterval(_,2e3)},m=()=>{d&&(clearInterval(d),d=null)},y=a=>{if(!a)return"";try{return new Date(a).toLocaleString("it-IT")}catch{return a}},A=()=>{navigator.clipboard.writeText("/opt/dapx-unified/update.sh")};return V(()=>{p(),_()}),w(()=>{m()}),(a,s)=>(o(),t("div",N,[s[10]||(s[10]=e("div",{class:"page-header"},[e("h2",null,"â¬†ï¸ Aggiornamenti Sistema"),e("p",{class:"text-secondary"},"Gestisci gli aggiornamenti di DAPX-Unified")],-1)),e("div",z,[e("div",D,[s[0]||(s[0]=e("h3",null,"ğŸ“¦ Versione Installata",-1)),e("button",{class:"btn btn-secondary",onClick:p,disabled:v.value},i(v.value?"Controllo...":"ğŸ”„ Verifica Aggiornamenti"),9,L)]),e("div",T,[e("div",B,[e("div",P,[s[1]||(s[1]=e("span",{class:"label"},"Versione attuale:",-1)),e("span",G,i(h.value||"N/A"),1)]),r.value?(o(),t("div",{key:0,class:x(["version-available",{"has-update":r.value.update_available}])},[s[2]||(s[2]=e("span",{class:"label"},"Ultima versione:",-1)),e("span",H,i(r.value.available_version||"N/A"),1),r.value.update_available?(o(),t("span",O,"Aggiornamento disponibile!")):(o(),t("span",M,"Aggiornato"))],2)):l("",!0),r.value?.last_check?(o(),t("div",R,[e("span",X,"Ultimo controllo: "+i(y(r.value.last_check)),1)])):l("",!0)])])]),r.value?.changelog?(o(),t("div",j,[e("div",q,[s[3]||(s[3]=e("h3",null,"ğŸ“ Note di Rilascio",-1)),r.value?.release_url?(o(),t("a",{key:0,href:r.value.release_url,target:"_blank",class:"btn btn-sm"}," ğŸ”— Vedi su GitHub ",8,J)):l("",!0)]),e("div",K,[r.value.release_date?(o(),t("div",Q," ğŸ“… "+i(y(r.value.release_date)),1)):l("",!0),e("pre",W,i(r.value.changelog),1)])])):l("",!0),r.value?.update_available?(o(),t("div",Y,[s[5]||(s[5]=e("div",{class:"card-header"},[e("h3",null,"ğŸš€ Esegui Aggiornamento")],-1)),e("div",Z,[s[4]||(s[4]=e("div",{class:"warning-box"},[e("strong",null,"âš ï¸ Attenzione:"),e("ul",null,[e("li",null,"Il servizio verrÃ  riavviato durante l'aggiornamento"),e("li",null,"VerrÃ  creato un backup automatico del database"),e("li",null,"L'operazione potrebbe richiedere alcuni minuti")])],-1)),e("button",{class:"btn btn-success btn-lg",onClick:f,disabled:n.value?.in_progress},i(n.value?.in_progress?"â³ Aggiornamento in corso...":"â¬†ï¸ Avvia Aggiornamento"),9,$)])])):l("",!0),n.value&&(n.value.in_progress||n.value.log.length>0)?(o(),t("div",ee,[e("div",se,[s[6]||(s[6]=e("h3",null,"ğŸ“‹ Log Aggiornamento",-1)),n.value.in_progress?(o(),t("span",ae,"In corso...")):n.value.error?(o(),t("span",te,"Errore")):n.value.success?(o(),t("span",oe,"Completato")):l("",!0)]),e("div",re,[e("div",{class:"log-output",ref_key:"logOutput",ref:g},[(o(!0),t(S,null,E(n.value.log,(U,C)=>(o(),t("div",{key:C,class:"log-line"},i(U),1))),128))],512),n.value.error?(o(),t("div",ne," âŒ "+i(n.value.error),1)):l("",!0)])])):l("",!0),e("div",{class:"card terminal-card"},[s[9]||(s[9]=e("div",{class:"card-header"},[e("h3",null,"ğŸ’» Aggiornamento da Terminale")],-1)),e("div",{class:"card-body"},[s[8]||(s[8]=e("p",null,"In alternativa, puoi eseguire l'aggiornamento direttamente dal terminale:",-1)),e("div",{class:"code-block"},[s[7]||(s[7]=e("code",null,"/opt/dapx-unified/update.sh",-1)),e("button",{class:"btn-copy",onClick:A,title:"Copia"},"ğŸ“‹")])])])]))}}),ce=F(le,[["__scopeId","data-v-9171c6f9"]]);export{ce as default};
