import{d as Et,r as N,B as G,h as q,o as Gt,D as st,c as a,a as t,e as _,F as b,b as y,k as S,t as l,n as c,E as p,m as w,v as B,q as ot,p as nt,J as z,w as lt,K as at,f as r,_ as Ot}from"./index-CYXbFCAl.js";import{u as Ht}from"./ha_store-CjZDzPDv.js";const Dt={class:"cluster-page"},Bt={class:"page-header"},Ft={class:"actions"},Mt={key:0,class:"cluster-selector mr-3"},Rt=["value"],Pt=["value"],Vt=["disabled"],zt={key:0,class:"spinner-sm"},Ut={class:"tabs"},jt={class:"tab-content"},qt={key:0,class:"config-panel"},Lt={class:"card mb-4"},Jt={class:"flex justify-between items-center"},Qt={key:0,class:"cluster-status-grid mt-4"},Kt={class:"status-item"},Wt={class:"status-item"},Zt={class:"status-item"},Xt={class:"status-item"},Yt={key:1,class:"mt-4 text-secondary"},te={key:0,class:"card"},ee={class:"flex justify-between items-center mb-4"},se={key:0,class:"text-center p-8 bg-custom-gray rounded text-secondary border border-dashed border-gray-600"},oe={key:1,class:"cluster-list"},ne=["onClick"],le={class:"text-2xl"},ae={class:"font-bold flex items-center gap-2 text-lg"},re={key:0,class:"px-2 py-0.5 text-xs bg-blue-900 text-blue-200 rounded"},ie={key:1,class:"px-2 py-0.5 text-xs bg-green-900 text-green-200 rounded"},ue={key:2,class:"px-2 py-0.5 text-xs bg-yellow-900 text-yellow-200 rounded"},de={class:"text-xs text-secondary mt-1 font-mono"},ce={class:"flex gap-2"},pe=["onClick"],me=["onClick"],ve={key:1,class:"card"},ge={class:"mb-6 pb-2 border-b border-gray-700"},fe={class:"form-grid"},_e={class:"form-group"},he={class:"form-group"},be={class:"form-group"},ye={class:"form-group"},ke={class:"form-group checkbox col-span-2 mt-2"},xe={class:"flex items-center gap-2 cursor-pointer"},Ce={class:"form-group checkbox col-span-2"},we={class:"flex items-center gap-2 cursor-pointer"},Ae={class:"mt-8 flex justify-end gap-2 border-t border-gray-700 pt-4"},Ne={key:1,class:"monitor-panel"},Se={key:0,class:"flex justify-center p-12"},$e={key:1},Ie={class:"monitor-summary mb-6"},Te={class:"summary-card"},Ee={class:"summary-value"},Ge={class:"summary-card"},Oe={class:"summary-value"},He={class:"summary-card"},De={class:"summary-value"},Be={key:0,class:"summary-card"},Fe={class:"nodes-grid"},Me={class:"node-header"},Re={class:"node-title"},Pe={class:"metrics-grid"},Ve={class:"metric-item"},ze={class:"metric-label"},Ue={class:"metric-value"},je={class:"progress-bar"},qe={class:"metric-item"},Le={class:"metric-label"},Je={class:"metric-value"},Qe={class:"progress-bar"},Ke={class:"metric-subtext"},We={class:"metric-item"},Ze={class:"metric-label"},Xe={class:"metric-value"},Ye={class:"metric-item"},ts={class:"metric-label"},es={class:"metric-value"},ss={class:"guest-indicators"},os={class:"guest-indicators-header"},ns={class:"indicator-title"},ls=["onClick"],as={class:"guest-chips-grid"},rs=["title"],is={class:"chip-icon"},us={class:"chip-id"},ds={key:0,class:"network-topology"},cs={class:"bridge-header"},ps={class:"vlan-header"},ms={class:"vlan-guests"},vs={class:"node-footer"},gs={class:"guest-counts"},fs={class:"guest-badge vm"},_s={class:"guest-badge ct"},hs={class:"card mt-6"},bs={class:"form-grid"},ys={class:"form-group"},ks={class:"mt-3"},xs=["disabled"],Cs={key:2,class:"ha-panel"},ws={class:"card mb-4"},As={class:"data-table"},Ns=["onClick"],Ss={key:0},$s={class:"card mb-4"},Is={class:"flex justify-between"},Ts={class:"flex gap-2"},Es={class:"table-scroll"},Gs={class:"data-table"},Os=["checked"],Hs=["checked","onChange","disabled"],Ds={key:0,class:"mt-4 p-4 bg-dark-soft rounded border border-gray-700"},Bs={class:"grid grid-cols-3 gap-4 mt-2"},Fs=["value"],Ms={class:"card"},Rs={class:"grid grid-cols-2 gap-6"},Ps={class:"data-table"},Vs=["onClick"],zs={class:"p-4 bg-dark-soft rounded"},Us={class:"space-y-3 mt-2"},js={class:"space-y-1 max-h-40 overflow-y-auto border border-gray-700 p-2 rounded"},qs={class:"flex items-center gap-2"},Ls=["checked","onChange"],Js={key:3,class:"dangerous-panel"},Qs={class:"card border-red-900/30"},Ks={class:"data-table"},Ws={class:"font-bold"},Zs={class:"flex gap-2"},Xs=["onClick"],Ys=["onClick","disabled"],to=Et({__name:"Cluster",setup(eo){const d=Ht(),m=N("monitor"),F=G(()=>d.loading),k=N([]),A=N(null),O=N(!1),$=N(null);G(()=>k.value.find(o=>o.id===A.value));const i=q({name:"",hosts:"",user:"",password:"",verify_ssl:!1,is_default:!1}),P=N({}),M=N(""),H=q({group:"",state:"started",max_restart:1,max_relocate:1}),h=N([]),R=q({name:"",restricted:!1,nofailback:!1}),D=N([]),v=G(()=>d.lastAnalysis),rt=G(()=>!v.value||!v.value.guests?0:Object.values(v.value.guests).filter(o=>o.type==="vm"||o.type==="qemu").length),it=G(()=>!v.value||!v.value.guests?0:Object.values(v.value.guests).filter(o=>o.type==="ct"||o.type==="lxc").length),ut=G(()=>d.clusterStatus?d.clusterStatus.quorum?"Initialized":"No Quorum":"Not Configured"),dt=G(()=>d.clusterStatus?d.clusterStatus.quorum?"status-initialized":"status-warning":"status-not-configured"),L=G(()=>{const o=d.availableGuests.filter(e=>!e.in_ha);return o.length>0&&h.value.length===o.length}),U=async()=>{try{const o=await T();if(!o)return;const e=localStorage.getItem("access_token"),s=await fetch(`/api/ha/node/${o}/monitor`,{headers:{Authorization:`Bearer ${e}`}});if(!s.ok)throw new Error("Monitor API failed");const n=await s.json();d.setAnalysisResult(n)}catch(o){console.error("Error loading monitor data",o)}},V=async()=>{try{const o=await z.get("/api/clusters");if(k.value=o.data,k.value.length>0){if(!(A.value&&k.value.find(s=>s.id===A.value))){const s=k.value.find(n=>n.is_default);A.value=s?s.id:k.value[0].id}}else A.value=null}catch(o){console.error("Failed to fetch clusters",o)}},J=o=>{A.value=o,I()},Q=o=>{o?($.value=o.id,i.name=o.name,i.hosts=o.hosts,i.user=o.api_user||"",i.password="",i.verify_ssl=o.verify_ssl,i.is_default=o.is_default,O.value=!0):($.value=null,i.name="",i.hosts="",i.user="root@pam",i.password="",i.verify_ssl=!1,i.is_default=k.value.length===0,O.value=!0)},ct=()=>{O.value=!1,$.value=null},pt=async()=>{const o={name:i.name,hosts:i.hosts,api_user:i.user,verify_ssl:i.verify_ssl,is_default:i.is_default};i.password&&(o.api_password=i.password);try{$.value?await z.put(`/api/clusters/${$.value}`,o):await z.post("/api/clusters",o),await V(),O.value=!1,$.value=null}catch(e){console.error("Failed to save cluster",e);const s=e.response?.data?.detail||e.message;alert("Failed to save cluster: "+s)}},mt=async o=>{if(confirm(`Sei sicuro di voler eliminare questa configurazione cluster?

I nodi Proxmox e le sincronizzazioni NON verranno toccati.
VerrÃ  rimossa solo la connessione per il monitoraggio e HA.`))try{await z.delete(`/api/clusters/${o}`),await V()}catch(e){console.error("Failed to delete cluster",e)}},I=async()=>{await d.fetchHAData(!0),m.value==="config"&&await V(),m.value==="monitor"&&await U()};Gt(async()=>{await V(),d.fetchHAData(),U(),d.startBackgroundRefresh()}),st(m,o=>{o==="config"&&K(),o==="monitor"&&U()});const T=async()=>{const o=localStorage.getItem("access_token");try{const s=await(await fetch("/api/nodes/",{headers:{Authorization:`Bearer ${o}`}})).json();if(s.length>0)return s[0].id}catch(e){console.error(e)}return null},K=async()=>{try{const o=localStorage.getItem("access_token"),s=await(await fetch("/api/load-balancer/config",{headers:{Authorization:`Bearer ${o}`}})).json();s.proxmox_api&&(i.hosts=s.proxmox_api.hosts||"",i.user=s.proxmox_api.user||"")}catch{}},vt=async()=>{if(!confirm(`Add ${M.value} to cluster?`))return;const o=await T();if(!o)return;const e=localStorage.getItem("access_token");try{const n=await(await fetch(`/api/ha/node/${o}/cluster/nodes`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({new_node_ip:M.value})})).json();n.success?(alert("Node added!"),I()):alert("Error: "+n.message)}catch(s){alert("Error: "+s)}},gt=o=>o==="started"?"badge-success":o==="stopped"?"badge-secondary":"badge-warning",ft=async o=>{if(!confirm("Remove resource?"))return;const e=await T();if(e)try{const s=localStorage.getItem("access_token");await fetch(`/api/ha/node/${e}/resources/${o.sid}?vm_type=${o.type}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}}),I()}catch(s){alert("Error: "+s)}},_t=async o=>{if(!confirm("Delete Group?"))return;const e=await T();if(e)try{const s=localStorage.getItem("access_token");await fetch(`/api/ha/node/${e}/groups/${o}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}}),I()}catch(s){alert("Error: "+s)}},ht=o=>{const e=h.value.indexOf(o);e===-1?h.value.push(o):h.value.splice(e,1)},W=()=>{L.value?h.value=[]:h.value=d.availableGuests.filter(o=>!o.in_ha).map(o=>o.vmid)},bt=()=>W(),yt=async()=>{const o=await T(),e=localStorage.getItem("access_token");for(const s of h.value){const n=d.availableGuests.find(u=>u.vmid===s);n&&await fetch(`/api/ha/node/${o}/resources`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({vmid:s,vm_type:n.type,group:H.group||null,state:H.state,max_restart:1,max_relocate:1})})}h.value=[],I()},kt=o=>{const e=D.value.findIndex(s=>s.name===o);e===-1?D.value.push({name:o,priority:1}):D.value.splice(e,1)},xt=async()=>{if(!R.name)return;const o=await T(),e=localStorage.getItem("access_token"),s=D.value.map(n=>n.name);await fetch(`/api/ha/node/${o}/groups`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({name:R.name,nodes:s,restricted:!1,nofailback:!1})}),R.name="",D.value=[],I()},Z=async()=>{console.log("Triggering auto-backup...");try{const o=localStorage.getItem("access_token");await fetch("/api/load-balancer/cluster/backup-config",{method:"POST",headers:{Authorization:`Bearer ${o}`}})}catch(o){console.warn("Backup endpoint error",o)}},Ct=async o=>{if(!confirm(`DANGER: Remove ${o}? Node must be OFFLINE.`)||!confirm("Are you really sure? This can break quorum."))return;await Z();const e=await T(),s=localStorage.getItem("access_token");try{const u=await(await fetch(`/api/ha/node/${e}/cluster/nodes/${o}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}})).json();u.success?(alert("Removed."),I()):alert("Error: "+u.message)}catch(n){alert("Error: "+n)}},wt=async o=>{if(!confirm(`Clean references for ${o}?`))return;await Z();const e=await T(),s=localStorage.getItem("access_token");try{const n=await fetch(`/api/ha/node/${e}/cluster/nodes/${o}/clean`,{method:"POST",headers:{Authorization:`Bearer ${s}`}});alert("Cleaned.")}catch(n){alert("Error: "+n)}};st(m,o=>{o==="config"&&K()});const E=o=>{if(!o||isNaN(o))return"N/A";const e=o/(1024*1024*1024);return e>=1?e.toFixed(1)+" GB":(o/(1024*1024)).toFixed(0)+" MB"},X=o=>o==null||isNaN(o)?"N/A":o.toFixed(1)+"%",j=o=>{if(!v.value||!v.value.guests)return[];const e=v.value.guests,s=[];for(const n in e){const u=e[n];u.node_current===o&&s.push({...u,id:n})}return s.sort((n,u)=>(n.name||n.id).localeCompare(u.name||u.id))},Y=(o,e)=>{if(!v.value||!v.value.guests)return 0;const s=v.value.guests;let n=0;const u=e==="qemu"?"vm":"ct";for(const g in s){const f=s[g];f.node_current===o&&f.type===u&&n++}return n},At=o=>o.pressure_score>50?"Critical":o.pressure_score>20?"Warning":"Healthy",tt=o=>o.pressure_score>50?"status-critical":o.pressure_score>20?"status-warning":"status-healthy",Nt=o=>o>50?"score-critical":o>20?"score-warning":"score-healthy",St=o=>tt(o),et=o=>o>80?"bg-danger":o>60?"bg-warning":"bg-success",$t=o=>{const e=o.name||o.id,s=o.type==="vm"?"VM":"Container",n=o.cpu_used?(o.cpu_used*100).toFixed(1)+"%":"N/A",u=o.memory_used?E(o.memory_used):"N/A",g=o.disk_used?E(o.disk_used):"N/A",f=o.network_in?E(o.network_in):"0 B",x=o.network_out?E(o.network_out):"0 B";return`${s}: ${e} (ID: ${o.id})
CPU: ${n}
Mem: ${u}
Disk: ${g}
Net In: ${f}/s
Net Out: ${x}/s`},It=o=>{P.value[o]=!P.value[o]},Tt=o=>{const e={};j(o).forEach(u=>{const g=u.networks||[];g.length!==0&&g.forEach(f=>{const x=f.bridge||"Unknown",C=f.tag||"untagged";e[x]||(e[x]={}),e[x][C]||(e[x][C]=[]),e[x][C].push({id:u.id,type:u.type,iface:f.id||f.ifname||"net?"})})});const n={};return Object.keys(e).sort().forEach(u=>{n[u]={},Object.keys(e[u]).sort((g,f)=>g==="untagged"?-1:f==="untagged"?1:parseInt(g)-parseInt(f)).forEach(g=>{n[u][g]=e[u][g]})}),n};return(o,e)=>(r(),a("div",Dt,[t("div",Bt,[e[17]||(e[17]=t("div",null,[t("h1",{class:"page-title"},"ðŸ–¥ï¸ Cluster Management"),t("p",{class:"page-subtitle"},"Manage Proxmox Cluster, HA, and Configuration")],-1)),t("div",Ft,[k.value.length>0?(r(),a("div",Mt,[t("select",{value:A.value,onChange:e[0]||(e[0]=s=>J(Number(s.target.value))),class:"form-select text-sm",style:{"min-width":"200px"}},[(r(!0),a(b,null,y(k.value,s=>(r(),a("option",{key:s.id,value:s.id},l(s.name)+" "+l(s.is_default?"(Default)":""),9,Pt))),128))],40,Rt)])):_("",!0),t("button",{class:"btn btn-secondary btn-sm",onClick:I,disabled:F.value},[F.value?(r(),a("span",zt)):_("",!0),S(" "+l(F.value?"Updating...":"ðŸ”„ Refresh All"),1)],8,Vt)])]),t("div",Ut,[t("button",{class:c(["tab-btn",{active:m.value==="config"}]),onClick:e[1]||(e[1]=s=>m.value="config")}," âš™ï¸ Config ",2),t("button",{class:c(["tab-btn",{active:m.value==="monitor"}]),onClick:e[2]||(e[2]=s=>m.value="monitor")}," ðŸ–¥ï¸ Cluster Monitor ",2),t("button",{class:c(["tab-btn",{active:m.value==="ha"}]),onClick:e[3]||(e[3]=s=>m.value="ha")}," ðŸ›¡ï¸ HA Manager ",2),t("button",{class:c(["tab-btn danger-tab",{active:m.value==="dangerous"}]),onClick:e[4]||(e[4]=s=>m.value="dangerous")}," âš ï¸ Dangerous Ops ",2)]),t("div",jt,[m.value==="config"?(r(),a("div",qt,[t("div",Lt,[t("div",Jt,[e[18]||(e[18]=t("div",null,[t("h4",null,"ðŸ“Š Cluster Status"),t("p",{class:"help-text"},"Current cluster initialization and connection status.")],-1)),t("div",{class:c(["cluster-status-badge",dt.value])},l(ut.value),3)]),p(d).clusterStatus?(r(),a("div",Qt,[t("div",Kt,[e[19]||(e[19]=t("span",{class:"label"},"Cluster Name",-1)),t("strong",null,l(p(d).clusterStatus.cluster_name||"N/A"),1)]),t("div",Wt,[e[20]||(e[20]=t("span",{class:"label"},"Quorum",-1)),t("strong",{class:c(p(d).clusterStatus.quorum?"text-success":"text-danger")},l(p(d).clusterStatus.quorum?"OK":"NO QUORUM"),3)]),t("div",Zt,[e[21]||(e[21]=t("span",{class:"label"},"Nodes",-1)),t("strong",null,l(p(d).clusterNodes?.length||0),1)]),t("div",Xt,[e[22]||(e[22]=t("span",{class:"label"},"Votes",-1)),t("strong",null,l(p(d).clusterStatus.total_votes||0)+" / "+l(p(d).clusterStatus.expected_votes||0),1)])])):(r(),a("div",Yt,[...e[23]||(e[23]=[t("em",null,"âš ï¸ No cluster data available. Configure entry point below and refresh.",-1)])]))]),O.value?_("",!0):(r(),a("div",te,[t("div",ee,[e[24]||(e[24]=t("div",null,[t("h4",null,"ðŸ”Œ Cluster Connections"),t("p",{class:"help-text"},"Manage connecting to one or more Proxmox clusters. These connections are used for Monitoring, HA, and Load Balancing.")],-1)),t("button",{class:"btn btn-primary btn-sm",onClick:e[5]||(e[5]=s=>Q())},"âž• Add Cluster")]),k.value.length===0?(r(),a("div",se,' No clusters configured. Click "Add Cluster" to connect. ')):(r(),a("div",oe,[(r(!0),a(b,null,y(k.value,s=>(r(),a("div",{key:s.id,class:c(["cluster-item p-4 border border-gray-700 rounded mb-2 flex justify-between items-center hover:bg-opacity-50 hover:bg-gray-800 transition-colors",{"ring-2 ring-blue-500 bg-gray-800":A.value===s.id}])},[t("div",{class:"flex items-center gap-3 cursor-pointer flex-grow",onClick:n=>J(s.id)},[t("span",le,l(A.value===s.id?"ðŸŸ¢":"âšª"),1),t("div",null,[t("div",ae,[S(l(s.name||`Cluster (${s.hosts.split(",")[0]})`)+" ",1),s.is_default?(r(),a("span",re,"Default")):_("",!0),s.is_initialized?(r(),a("span",ie,"Online")):(r(),a("span",ue,"Offline"))]),t("div",de,l(s.hosts)+" â€¢ "+l(s.api_user||"Token"),1)])],8,ne),t("div",ce,[t("button",{class:"btn btn-sm btn-secondary",onClick:lt(n=>Q(s),["stop"])},"âœï¸ Edit",8,pe),t("button",{class:"btn btn-sm btn-danger",onClick:lt(n=>mt(s.id),["stop"])},"ðŸ—‘ï¸ Delete",8,me)])],2))),128))]))])),O.value?(r(),a("div",ve,[t("h4",ge,l($.value?"Edit Cluster":"New Cluster Connection"),1),t("div",fe,[t("div",_e,[e[25]||(e[25]=t("label",null,"Friendly Name",-1)),w(t("input",{type:"text","onUpdate:modelValue":e[6]||(e[6]=s=>i.name=s),class:"form-input",placeholder:"e.g. Production Cluster"},null,512),[[B,i.name]]),e[26]||(e[26]=t("small",{class:"text-secondary"},"Name used to identify this cluster in menus.",-1))]),t("div",he,[e[27]||(e[27]=t("label",null,"Cluster Hosts / IPs",-1)),w(t("input",{type:"text","onUpdate:modelValue":e[7]||(e[7]=s=>i.hosts=s),class:"form-input",placeholder:"192.168.1.10, 192.168.1.11"},null,512),[[B,i.hosts]]),e[28]||(e[28]=t("small",{class:"text-secondary"},"Comma separated list of Proxmox node IPs.",-1))]),t("div",be,[e[29]||(e[29]=t("label",null,"Username",-1)),w(t("input",{type:"text","onUpdate:modelValue":e[8]||(e[8]=s=>i.user=s),class:"form-input",placeholder:"root@pam"},null,512),[[B,i.user]])]),t("div",ye,[e[30]||(e[30]=t("label",null,"API Token / Password",-1)),w(t("input",{type:"password","onUpdate:modelValue":e[9]||(e[9]=s=>i.password=s),class:"form-input",placeholder:"Enter only to change"},null,512),[[B,i.password]])]),t("div",ke,[t("label",xe,[w(t("input",{type:"checkbox","onUpdate:modelValue":e[10]||(e[10]=s=>i.verify_ssl=s)},null,512),[[ot,i.verify_ssl]]),e[31]||(e[31]=S(" Verify SSL Certificate (Disable for self-signed) ",-1))])]),t("div",Ce,[t("label",we,[w(t("input",{type:"checkbox","onUpdate:modelValue":e[11]||(e[11]=s=>i.is_default=s)},null,512),[[ot,i.is_default]]),e[32]||(e[32]=S(" Set as Default Cluster ",-1))])])]),t("div",Ae,[t("button",{class:"btn btn-secondary",onClick:ct},"Cancel"),t("button",{class:"btn btn-primary",onClick:pt},"ðŸ’¾ "+l($.value?"Update Connection":"Create Connection"),1)])])):_("",!0)])):_("",!0),m.value==="monitor"?(r(),a("div",Ne,[F.value&&!v.value?(r(),a("div",Se,[...e[33]||(e[33]=[t("span",{class:"spinner-lg"},null,-1)])])):v.value?(r(),a("div",$e,[t("div",Ie,[t("div",Te,[e[34]||(e[34]=t("span",{class:"summary-label"},"Nodes",-1)),t("span",Ee,l(Object.keys(v.value.nodes||{}).length),1)]),t("div",Ge,[e[35]||(e[35]=t("span",{class:"summary-label"},"VMs",-1)),t("span",Oe,l(rt.value),1)]),t("div",He,[e[36]||(e[36]=t("span",{class:"summary-label"},"CTs",-1)),t("span",De,l(it.value),1)]),p(d).clusterStatus?(r(),a("div",Be,[e[37]||(e[37]=t("span",{class:"summary-label"},"Quorum",-1)),t("span",{class:c(["summary-value",p(d).clusterStatus.quorum?"text-success":"text-danger"])},l(p(d).clusterStatus.quorum?"OK":"NO"),3)])):_("",!0)]),t("div",Fe,[(r(!0),a(b,null,y(v.value.nodes,(s,n)=>(r(),a("div",{key:n,class:c(["node-card",St(s)])},[t("div",Me,[t("div",Re,[t("h3",null,l(n),1),t("span",{class:c(["node-status",tt(s)])},l(At(s)),3)]),t("div",{class:c(["node-score",Nt(s.pressure_score)])}," Score: "+l(s.pressure_score.toFixed(1)),3)]),t("div",Pe,[t("div",Ve,[t("div",ze,[e[38]||(e[38]=t("span",null,"CPU",-1)),t("span",Ue,l(X(s.cpu_usage_percent)),1)]),t("div",je,[t("div",{class:c(["progress-fill",et(s.cpu_usage_percent)]),style:at({width:s.cpu_usage_percent+"%"})},null,6)])]),t("div",qe,[t("div",Le,[e[39]||(e[39]=t("span",null,"RAM",-1)),t("span",Je,l(X(s.memory_usage_percent)),1)]),t("div",Qe,[t("div",{class:c(["progress-fill",et(s.memory_usage_percent)]),style:at({width:s.memory_usage_percent+"%"})},null,6)]),t("div",Ke,l(E(s.memory_used))+" / "+l(E(s.memory_total)),1)]),t("div",We,[t("div",Ze,[e[40]||(e[40]=t("span",null,"ðŸ“‰ Net In",-1)),t("span",Xe,l(E(s.network_in||0))+"/s",1)])]),t("div",Ye,[t("div",ts,[e[41]||(e[41]=t("span",null,"ðŸ“ˆ Net Out",-1)),t("span",es,l(E(s.network_out||0))+"/s",1)])])]),t("div",ss,[t("div",os,[t("span",ns,"Running Guests ("+l(j(n).length)+")",1),t("button",{class:"btn-xs btn-text",onClick:u=>It(n)},l(P.value[n]?"Hide Topology":"Show Network Topology"),9,ls)]),t("div",as,[(r(!0),a(b,null,y(j(n),u=>(r(),a("div",{key:u.id,class:c(["guest-chip",u.type]),title:$t(u)},[t("span",is,l(u.type==="vm"?"ðŸ–¥":"ðŸ“¦"),1),t("span",us,l(u.name||u.id),1)],10,rs))),128))])]),P.value[n]?(r(),a("div",ds,[e[42]||(e[42]=t("h4",null,"ðŸ”Œ Network Topology",-1)),(r(!0),a(b,null,y(Tt(n),(u,g)=>(r(),a("div",{key:g,class:"topology-bridge"},[t("div",cs,"ðŸŒ‰ "+l(g),1),(r(!0),a(b,null,y(u,(f,x)=>(r(),a("div",{key:x,class:"topology-vlan"},[t("div",ps,"ðŸ·ï¸ VLAN "+l(x==="untagged"?"Untagged":x),1),t("div",ms,[(r(!0),a(b,null,y(f,C=>(r(),a("div",{key:C.id,class:c(["topology-guest",C.type])},[S(l(C.type==="vm"?"ðŸ–¥":"ðŸ“¦")+" ",1),t("strong",null,l(C.name||C.id),1),S(" ("+l(C.iface)+") ",1)],2))),128))])]))),128))]))),128))])):_("",!0),t("div",vs,[t("div",gs,[t("span",fs,l(Y(n,"qemu"))+" VMs",1),t("span",_s,l(Y(n,"lxc"))+" CTs",1)])])],2))),128))])])):_("",!0),t("div",hs,[e[44]||(e[44]=t("h4",null,"âž• Join Node to Cluster",-1)),t("div",bs,[t("div",ys,[e[43]||(e[43]=t("label",null,"New Node IP",-1)),w(t("input",{type:"text","onUpdate:modelValue":e[12]||(e[12]=s=>M.value=s),class:"form-input",placeholder:"192.168.x.x"},null,512),[[B,M.value]])])]),t("div",ks,[t("button",{class:"btn btn-primary",onClick:vt,disabled:!M.value||F.value}," âž• Add Node ",8,xs)])])])):_("",!0),m.value==="ha"?(r(),a("div",Cs,[t("div",ws,[e[47]||(e[47]=t("h4",null,"HA Managed Resources",-1)),t("table",As,[e[46]||(e[46]=t("thead",null,[t("tr",null,[t("th",null,"SID"),t("th",null,"Type"),t("th",null,"State"),t("th",null,"Group"),t("th",null,"Action")])],-1)),t("tbody",null,[(r(!0),a(b,null,y(p(d).haResources,s=>(r(),a("tr",{key:s.sid},[t("td",null,l(s.sid),1),t("td",null,[t("span",{class:c(["badge",s.type==="vm"?"badge-success":"badge-info"])},l(s.type),3)]),t("td",null,[t("span",{class:c(gt(s.state))},l(s.state),3)]),t("td",null,l(s.group||"-"),1),t("td",null,[t("button",{class:"btn btn-xs btn-danger",onClick:n=>ft(s)},"Remove",8,Ns)])]))),128)),p(d).haResources.length===0?(r(),a("tr",Ss,[...e[45]||(e[45]=[t("td",{colspan:"5",class:"text-center p-4"},"No HA resources.",-1)])])):_("",!0)])])]),t("div",$s,[t("div",Is,[e[48]||(e[48]=t("h4",null,"Available Guests",-1)),t("div",Ts,[t("button",{class:"btn btn-xs btn-secondary",onClick:bt},"Select All"),t("button",{class:"btn btn-xs btn-secondary",onClick:e[13]||(e[13]=s=>h.value=[])},"Clear")])]),t("div",Es,[t("table",Gs,[t("thead",null,[t("tr",null,[t("th",null,[t("input",{type:"checkbox",checked:L.value,onChange:W},null,40,Os)]),e[49]||(e[49]=t("th",null,"ID",-1)),e[50]||(e[50]=t("th",null,"Name",-1)),e[51]||(e[51]=t("th",null,"Node",-1)),e[52]||(e[52]=t("th",null,"Status",-1))])]),t("tbody",null,[(r(!0),a(b,null,y(p(d).availableGuests,s=>(r(),a("tr",{key:s.vmid,class:c({"bg-highlight":h.value.includes(s.vmid),"opacity-50":s.in_ha})},[t("td",null,[t("input",{type:"checkbox",checked:h.value.includes(s.vmid),onChange:n=>ht(s.vmid),disabled:s.in_ha},null,40,Hs)]),t("td",null,l(s.vmid),1),t("td",null,l(s.name),1),t("td",null,l(s.node),1),t("td",null,l(s.in_ha?"âœ… In HA":s.status),1)],2))),128))])])]),h.value.length>0?(r(),a("div",Ds,[t("h5",null,"Add "+l(h.value.length)+" guests to HA",1),t("div",Bs,[w(t("select",{"onUpdate:modelValue":e[14]||(e[14]=s=>H.group=s),class:"form-input"},[e[53]||(e[53]=t("option",{value:""},"No Group",-1)),(r(!0),a(b,null,y(p(d).haGroups,s=>(r(),a("option",{key:s.group,value:s.group},l(s.group),9,Fs))),128))],512),[[nt,H.group]]),w(t("select",{"onUpdate:modelValue":e[15]||(e[15]=s=>H.state=s),class:"form-input"},[...e[54]||(e[54]=[t("option",{value:"started"},"Started",-1),t("option",{value:"stopped"},"Stopped",-1)])],512),[[nt,H.state]]),t("button",{class:"btn btn-primary",onClick:yt},"Add to HA")])])):_("",!0)]),t("div",Ms,[e[57]||(e[57]=t("h4",null,"HA Groups",-1)),t("div",Rs,[t("div",null,[t("table",Ps,[e[55]||(e[55]=t("thead",null,[t("tr",null,[t("th",null,"Group"),t("th",null,"Nodes"),t("th",null,"Action")])],-1)),t("tbody",null,[(r(!0),a(b,null,y(p(d).haGroups,s=>(r(),a("tr",{key:s.group},[t("td",null,l(s.group),1),t("td",null,l(s.nodes),1),t("td",null,[t("button",{class:"btn btn-xs btn-danger",onClick:n=>_t(s.group)},"Delete",8,Vs)])]))),128))])])]),t("div",zs,[e[56]||(e[56]=t("h5",null,"Create Group",-1)),t("div",Us,[w(t("input",{type:"text","onUpdate:modelValue":e[16]||(e[16]=s=>R.name=s),class:"form-input",placeholder:"Group Name"},null,512),[[B,R.name]]),t("div",js,[(r(!0),a(b,null,y(p(d).clusterNodes,s=>(r(),a("div",{key:s.name},[t("label",qs,[t("input",{type:"checkbox",checked:D.value.some(n=>n.name===s.name),onChange:n=>kt(s.name)},null,40,Ls),S(" "+l(s.name),1)])]))),128))]),t("button",{class:"btn btn-primary w-full",onClick:xt},"Create Group")])])])])])):_("",!0),m.value==="dangerous"?(r(),a("div",Js,[e[61]||(e[61]=t("div",{class:"alert alert-danger mb-6 border-l-4 border-red-600"},[t("h3",{class:"text-red-500 font-bold text-lg flex items-center gap-2"}," âš ï¸ DANGER ZONE "),t("p",{class:"mt-2 text-primary"},[S(" The operations in this section are "),t("strong",null,"destructive"),S(". Removing nodes incorrectly can break quorum and make your cluster read-only or inaccessible. ")]),t("p",{class:"mt-2 font-bold"}," ðŸ›¡ï¸ An automatic configuration backup will be triggered before any operation. ")],-1)),t("div",Qs,[e[59]||(e[59]=t("h4",{class:"text-red-400"},"Manage Dead Nodes",-1)),e[60]||(e[60]=t("p",{class:"mb-4 text-sm text-secondary"}," If a node is permanently dead or has been physically removed, you can remove it from the cluster configuration here. ",-1)),t("table",Ks,[e[58]||(e[58]=t("thead",null,[t("tr",null,[t("th",null,"Node Name"),t("th",null,"Status"),t("th",null,"Actions")])],-1)),t("tbody",null,[(r(!0),a(b,null,y(p(d).clusterNodes,s=>(r(),a("tr",{key:s.name},[t("td",Ws,l(s.name),1),t("td",null,[t("span",{class:c(s.status==="online"?"badge-success":"badge-danger")},l(s.status?.toUpperCase()),3)]),t("td",null,[t("div",Zs,[t("button",{class:"btn btn-xs btn-warning",onClick:n=>wt(s.name),title:"Remove leftover config"}," ðŸ§¹ Clean Refs ",8,Xs),t("button",{class:"btn btn-xs btn-danger",onClick:n=>Ct(s.name),disabled:s.is_local||s.status==="online",title:"Remove from quorum (Must be offline)"}," ðŸ’£ Force Remove ",8,Ys)])])]))),128))])])])])):_("",!0)])]))}}),no=Ot(to,[["__scopeId","data-v-6a6449c2"]]);export{no as default};
