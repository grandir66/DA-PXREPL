import{d as Ft,r as C,B as G,h as J,D as Q,o as jt,c as l,a as t,e as v,F as m,b as g,k as w,t as r,n as p,E as _,m as S,v as R,q as ut,p as ct,J as D,w as pt,K as vt,L as Dt,f as a,_ as Ut}from"./index-DisZpmug.js";import{u as qt}from"./ha_store-CMOJDULB.js";const Lt={class:"cluster-page"},Jt={class:"page-header"},Qt={class:"actions"},Wt={key:0,class:"cluster-selector mr-3"},Kt=["value"],Xt=["value"],Zt=["disabled"],Yt={key:0,class:"spinner-sm"},te={class:"tabs"},ee={class:"tab-content"},se={key:0,class:"config-panel"},oe={class:"card mb-4"},ne={class:"flex justify-between items-center"},le={key:0,class:"cluster-status-grid mt-4"},ae={class:"status-item"},re={class:"status-item"},ie={class:"status-item"},de={class:"status-item"},ue={key:1,class:"mt-4 text-secondary"},ce={key:0,class:"card"},pe={class:"flex justify-between items-center mb-4"},ve={key:0,class:"text-center p-8 bg-custom-gray rounded text-secondary border border-dashed border-gray-600"},me={key:1,class:"cluster-list"},ge=["onClick"],ye={class:"text-2xl"},fe={class:"font-bold flex items-center gap-2 text-lg"},_e={key:0,class:"px-2 py-0.5 text-xs bg-blue-900 text-blue-200 rounded"},be={key:1,class:"px-2 py-0.5 text-xs bg-green-900 text-green-200 rounded"},he={key:2,class:"px-2 py-0.5 text-xs bg-yellow-900 text-yellow-200 rounded"},ke={class:"text-xs text-secondary mt-1 font-mono"},xe={class:"flex gap-2"},Ce=["onClick"],we=["onClick"],Ae={key:1,class:"card"},Se={class:"mb-6 pb-2 border-b border-gray-700"},$e={class:"form-grid"},Ne={class:"form-group"},Ie={class:"form-group"},Te={class:"form-group"},Ee={class:"form-group"},Be={class:"form-group checkbox col-span-2 mt-2"},Ge={class:"flex items-center gap-2 cursor-pointer"},Oe={class:"form-group checkbox col-span-2"},Me={class:"flex items-center gap-2 cursor-pointer"},ze={class:"mt-8 flex justify-end gap-2 border-t border-gray-700 pt-4"},Re={key:1,class:"topology-panel",style:{animation:"fadeIn 0.3s ease"}},Ve={key:0,style:{display:"flex","flex-direction":"column","align-items":"center","justify-content":"center",padding:"80px 20px"}},He={key:1},Pe={class:"card",style:{"margin-bottom":"24px"}},Fe={class:"table-container"},je={class:"data-table"},De={style:{"font-weight":"600"}},Ue={style:{"text-align":"center"}},qe={key:0,class:"badge badge-success"},Le={key:1,class:"text-secondary"},Je={style:{"text-align":"center"}},Qe={key:0,class:"badge badge-success"},We={key:1,class:"text-secondary"},Ke={style:{"text-align":"right","font-family":"monospace"}},Xe={class:"topology-grid"},Ze={class:"topology-node-header"},Ye={style:{display:"flex","align-items":"center",gap:"12px"}},ts=["onClick"],es={class:"topology-node-content"},ss={class:"topology-section"},os={class:"topology-iface-list"},ns={class:"topology-section"},ls={class:"topology-bridges-list"},as={class:"topology-bridge-header"},rs={class:"bridge-name"},is={class:"bridge-cidr"},ds={key:0,class:"bridge-ports-info"},us={class:"bridge-ports-list"},cs={key:0,class:"bond-mode-badge"},ps={key:0,class:"bond-slaves"},vs={class:"topology-guests"},ms=["onClick"],gs={class:"guest-icon"},ys={class:"guest-info"},fs={style:{color:"var(--accent)"}},_s={class:"guest-id"},bs={key:0,class:"badge badge-purple",style:{"margin-left":"auto","font-size":"0.7rem"}},hs={key:0,class:"no-guests"},ks={key:2,class:"monitor-panel"},xs={key:0,class:"flex justify-center p-12"},Cs={key:1},ws={class:"monitor-summary mb-6"},As={class:"summary-card"},Ss={class:"summary-value"},$s={class:"summary-card"},Ns={class:"summary-value"},Is={class:"summary-card"},Ts={class:"summary-value"},Es={key:0,class:"summary-card"},Bs={class:"nodes-grid"},Gs={class:"node-header"},Os={class:"node-title"},Ms={class:"metrics-grid"},zs={class:"metric-item"},Rs={class:"metric-label"},Vs={class:"metric-value"},Hs={class:"progress-bar"},Ps={class:"metric-item"},Fs={class:"metric-label"},js={class:"metric-value"},Ds={class:"progress-bar"},Us={class:"metric-subtext"},qs={class:"metric-item"},Ls={class:"metric-label"},Js={class:"metric-value"},Qs={class:"metric-item"},Ws={class:"metric-label"},Ks={class:"metric-value"},Xs={class:"guest-indicators"},Zs={class:"guest-indicators-header"},Ys={class:"indicator-title"},to=["onClick"],eo={class:"guest-chips-grid"},so=["title"],oo={class:"chip-icon"},no={class:"chip-id"},lo={key:0,class:"network-topology"},ao={class:"bridge-header"},ro={class:"vlan-header"},io={class:"vlan-guests"},uo={class:"node-footer"},co={class:"guest-counts"},po={class:"guest-badge vm"},vo={class:"guest-badge ct"},mo={class:"card mt-6"},go={class:"form-grid"},yo={class:"form-group"},fo={class:"mt-3"},_o=["disabled"],bo={key:3,class:"ha-panel"},ho={class:"card mb-4"},ko={class:"data-table"},xo=["onClick"],Co={key:0},wo={class:"card mb-4"},Ao={class:"flex justify-between"},So={class:"flex gap-2"},$o={class:"table-scroll"},No={class:"data-table"},Io=["checked"],To=["checked","onChange","disabled"],Eo={key:0,class:"mt-4 p-4 bg-dark-soft rounded border border-gray-700"},Bo={class:"grid grid-cols-3 gap-4 mt-2"},Go=["value"],Oo={class:"card"},Mo={class:"grid grid-cols-2 gap-6"},zo={class:"data-table"},Ro=["onClick"],Vo={class:"p-4 bg-dark-soft rounded"},Ho={class:"space-y-3 mt-2"},Po={class:"space-y-1 max-h-40 overflow-y-auto border border-gray-700 p-2 rounded"},Fo={class:"flex items-center gap-2"},jo=["checked","onChange"],Do={key:4,class:"dangerous-panel"},Uo={class:"card border-red-900/30"},qo={class:"data-table"},Lo={class:"font-bold"},Jo={class:"flex gap-2"},Qo=["onClick"],Wo=["onClick","disabled"],Ko=Ft({__name:"Cluster",setup(Xo){const c=qt(),W=Dt(),y=C("monitor"),V=G(()=>c.loading),k=C([]),$=C(null),O=C(!1),I=C(null);G(()=>k.value.find(o=>o.id===$.value));const u=J({name:"",hosts:"",user:"",password:"",verify_ssl:!1,is_default:!1}),F=C({}),H=C(""),M=J({group:"",state:"started",max_restart:1,max_relocate:1}),h=C([]),P=J({name:"",restricted:!1,nofailback:!1}),z=C([]),b=G(()=>c.lastAnalysis),mt=G(()=>!b.value||!b.value.guests?0:Object.values(b.value.guests).filter(o=>o.type==="vm"||o.type==="qemu").length),gt=G(()=>!b.value||!b.value.guests?0:Object.values(b.value.guests).filter(o=>o.type==="ct"||o.type==="lxc").length),yt=G(()=>c.clusterStatus?c.clusterStatus.quorum?"Initialized":"No Quorum":"Not Configured"),ft=G(()=>c.clusterStatus?c.clusterStatus.quorum?"status-initialized":"status-warning":"status-not-configured"),K=G(()=>{const o=c.availableGuests.filter(e=>!e.in_ha);return o.length>0&&h.value.length===o.length}),T=C(null),U=C(!1),_t=async()=>{U.value=!0;try{const o=await N();if(!o)return;const e=localStorage.getItem("access_token"),s=await fetch(`/api/ha/node/${o}/topology`,{headers:{Authorization:`Bearer ${e}`}});s.ok&&(T.value=await s.json())}catch(o){console.error("Topology load failed",o)}finally{U.value=!1}};Q(y,o=>{o==="topology"&&(!T.value||k.value.length>0)&&_t()});const X=(o,e)=>{if(!T.value||!T.value.guests)return[];const s=e?e.trim():"";return Object.values(T.value.guests).filter(n=>n.networks?n.node===o&&n.networks.some(i=>(i.bridge&&i.bridge.trim())===s):!1)},Z=(o,e)=>{if(!o||!o.networks)return null;const s=e?e.trim():"";return o.networks.find(i=>i.bridge&&i.bridge.trim()===s)?.tag||null},bt=o=>{W.push({path:"/nodes",query:{openInfo:o}})},ht=o=>{if(!o)return;const e=o.id||o.vmid,s=o.type==="ct"||o.type==="lxc"?"lxc":"qemu";W.push({path:"/vms",query:{openVm:String(e),type:s}})},Y=(o,e)=>{if(!o||!e.startsWith("bond"))return null;const s=o.find(i=>i.iface===e&&i.type==="bond");return!s||!s.bond_mode?null:{"balance-rr":"RR","active-backup":"Active-Backup","balance-xor":"XOR",broadcast:"Broadcast","802.3ad":"LACP","balance-tlb":"TLB","balance-alb":"ALB"}[s.bond_mode]||s.bond_mode},tt=(o,e)=>{if(!o||!e.startsWith("bond"))return null;const s=o.find(n=>n.iface===e&&n.type==="bond");return s?s.slaves?s.slaves.split(" ").filter(n=>n.trim()):s.bond_slaves?s.bond_slaves.split(" ").filter(n=>n.trim()):null:null},q=async()=>{try{const o=await N();if(!o)return;const e=localStorage.getItem("access_token"),s=await fetch(`/api/ha/node/${o}/monitor`,{headers:{Authorization:`Bearer ${e}`}});if(!s.ok)throw new Error("Monitor API failed");const n=await s.json();c.setAnalysisResult(n)}catch(o){console.error("Error loading monitor data",o)}},j=async()=>{try{const o=await D.get("/api/clusters");if(k.value=o.data,k.value.length>0){if(!($.value&&k.value.find(s=>s.id===$.value))){const s=k.value.find(n=>n.is_default);$.value=s?s.id:k.value[0].id}}else $.value=null}catch(o){console.error("Failed to fetch clusters",o)}},et=o=>{$.value=o,E()},st=o=>{o?(I.value=o.id,u.name=o.name,u.hosts=o.hosts,u.user=o.api_user||"",u.password="",u.verify_ssl=o.verify_ssl,u.is_default=o.is_default,O.value=!0):(I.value=null,u.name="",u.hosts="",u.user="root@pam",u.password="",u.verify_ssl=!1,u.is_default=k.value.length===0,O.value=!0)},kt=()=>{O.value=!1,I.value=null},xt=async()=>{const o={name:u.name,hosts:u.hosts,api_user:u.user,verify_ssl:u.verify_ssl,is_default:u.is_default};u.password&&(o.api_password=u.password);try{I.value?await D.put(`/api/clusters/${I.value}`,o):await D.post("/api/clusters",o),await j(),O.value=!1,I.value=null}catch(e){console.error("Failed to save cluster",e);const s=e.response?.data?.detail||e.message;alert("Failed to save cluster: "+s)}},Ct=async o=>{if(confirm(`Sei sicuro di voler eliminare questa configurazione cluster?

I nodi Proxmox e le sincronizzazioni NON verranno toccati.
VerrÃ  rimossa solo la connessione per il monitoraggio e HA.`))try{await D.delete(`/api/clusters/${o}`),await j()}catch(e){console.error("Failed to delete cluster",e)}},E=async()=>{await c.fetchHAData(!0),y.value==="config"&&await j(),y.value==="monitor"&&await q()};jt(async()=>{await j(),c.fetchHAData(),q(),c.startBackgroundRefresh()}),Q(y,o=>{o==="config"&&ot(),o==="monitor"&&q()});const N=async()=>{const o=localStorage.getItem("access_token");try{const s=await(await fetch("/api/nodes/",{headers:{Authorization:`Bearer ${o}`}})).json();if(s.length>0)return s[0].id}catch(e){console.error(e)}return null},ot=async()=>{try{const o=localStorage.getItem("access_token"),s=await(await fetch("/api/load-balancer/config",{headers:{Authorization:`Bearer ${o}`}})).json();s.proxmox_api&&(u.hosts=s.proxmox_api.hosts||"",u.user=s.proxmox_api.user||"")}catch{}},wt=async()=>{if(!confirm(`Add ${H.value} to cluster?`))return;const o=await N();if(!o)return;const e=localStorage.getItem("access_token");try{const n=await(await fetch(`/api/ha/node/${o}/cluster/nodes`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({new_node_ip:H.value})})).json();n.success?(alert("Node added!"),E()):alert("Error: "+n.message)}catch(s){alert("Error: "+s)}},At=o=>o==="started"?"badge-success":o==="stopped"?"badge-secondary":"badge-warning",St=async o=>{if(!confirm("Remove resource?"))return;const e=await N();if(e)try{const s=localStorage.getItem("access_token");await fetch(`/api/ha/node/${e}/resources/${o.sid}?vm_type=${o.type}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}}),E()}catch(s){alert("Error: "+s)}},$t=async o=>{if(!confirm("Delete Group?"))return;const e=await N();if(e)try{const s=localStorage.getItem("access_token");await fetch(`/api/ha/node/${e}/groups/${o}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}}),E()}catch(s){alert("Error: "+s)}},Nt=o=>{const e=h.value.indexOf(o);e===-1?h.value.push(o):h.value.splice(e,1)},nt=()=>{K.value?h.value=[]:h.value=c.availableGuests.filter(o=>!o.in_ha).map(o=>o.vmid)},It=()=>nt(),Tt=async()=>{const o=await N(),e=localStorage.getItem("access_token");for(const s of h.value){const n=c.availableGuests.find(i=>i.vmid===s);n&&await fetch(`/api/ha/node/${o}/resources`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({vmid:s,vm_type:n.type,group:M.group||null,state:M.state,max_restart:1,max_relocate:1})})}h.value=[],E()},Et=o=>{const e=z.value.findIndex(s=>s.name===o);e===-1?z.value.push({name:o,priority:1}):z.value.splice(e,1)},Bt=async()=>{if(!P.name)return;const o=await N(),e=localStorage.getItem("access_token"),s=z.value.map(n=>n.name);await fetch(`/api/ha/node/${o}/groups`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({name:P.name,nodes:s,restricted:!1,nofailback:!1})}),P.name="",z.value=[],E()},lt=async()=>{console.log("Triggering auto-backup...");try{const o=localStorage.getItem("access_token");await fetch("/api/load-balancer/cluster/backup-config",{method:"POST",headers:{Authorization:`Bearer ${o}`}})}catch(o){console.warn("Backup endpoint error",o)}},Gt=async o=>{if(!confirm(`DANGER: Remove ${o}? Node must be OFFLINE.`)||!confirm("Are you really sure? This can break quorum."))return;await lt();const e=await N(),s=localStorage.getItem("access_token");try{const i=await(await fetch(`/api/ha/node/${e}/cluster/nodes/${o}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}})).json();i.success?(alert("Removed."),E()):alert("Error: "+i.message)}catch(n){alert("Error: "+n)}},Ot=async o=>{if(!confirm(`Clean references for ${o}?`))return;await lt();const e=await N(),s=localStorage.getItem("access_token");try{const n=await fetch(`/api/ha/node/${e}/cluster/nodes/${o}/clean`,{method:"POST",headers:{Authorization:`Bearer ${s}`}});alert("Cleaned.")}catch(n){alert("Error: "+n)}};Q(y,o=>{o==="config"&&ot()});const B=o=>{if(!o||isNaN(o))return"N/A";const e=o/(1024*1024*1024);return e>=1?e.toFixed(1)+" GB":(o/(1024*1024)).toFixed(0)+" MB"},at=o=>o==null||isNaN(o)?"N/A":o.toFixed(1)+"%",L=o=>{if(!b.value||!b.value.guests)return[];const e=b.value.guests,s=[];for(const n in e){const i=e[n];i.node_current===o&&s.push({...i,id:n})}return s.sort((n,i)=>(n.name||n.id).localeCompare(i.name||i.id))},rt=(o,e)=>{if(!b.value||!b.value.guests)return 0;const s=b.value.guests;let n=0;const i=e==="qemu"?"vm":"ct";for(const d in s){const f=s[d];f.node_current===o&&f.type===i&&n++}return n},Mt=o=>o.pressure_score>50?"Critical":o.pressure_score>20?"Warning":"Healthy",it=o=>o.pressure_score>50?"status-critical":o.pressure_score>20?"status-warning":"status-healthy",zt=o=>o>50?"score-critical":o>20?"score-warning":"score-healthy",Rt=o=>it(o),dt=o=>o>80?"bg-danger":o>60?"bg-warning":"bg-success",Vt=o=>{const e=o.name||o.id,s=o.type==="vm"?"VM":"Container",n=o.cpu_used?(o.cpu_used*100).toFixed(1)+"%":"N/A",i=o.memory_used?B(o.memory_used):"N/A",d=o.disk_used?B(o.disk_used):"N/A",f=o.network_in?B(o.network_in):"0 B",x=o.network_out?B(o.network_out):"0 B";return`${s}: ${e} (ID: ${o.id})
CPU: ${n}
Mem: ${i}
Disk: ${d}
Net In: ${f}/s
Net Out: ${x}/s`},Ht=o=>{F.value[o]=!F.value[o]},Pt=o=>{const e={};L(o).forEach(i=>{const d=i.networks||[];d.length!==0&&d.forEach(f=>{const x=f.bridge||"Unknown",A=f.tag||"untagged";e[x]||(e[x]={}),e[x][A]||(e[x][A]=[]),e[x][A].push({id:i.id,type:i.type,iface:f.id||f.ifname||"net?"})})});const n={};return Object.keys(e).sort().forEach(i=>{n[i]={},Object.keys(e[i]).sort((d,f)=>d==="untagged"?-1:f==="untagged"?1:parseInt(d)-parseInt(f)).forEach(d=>{n[i][d]=e[i][d]})}),n};return(o,e)=>(a(),l("div",Lt,[t("div",Jt,[e[18]||(e[18]=t("div",null,[t("h1",{class:"page-title"},"ðŸ–¥ï¸ Cluster Management"),t("p",{class:"page-subtitle"},"Manage Proxmox Cluster, HA, and Configuration")],-1)),t("div",Qt,[k.value.length>0?(a(),l("div",Wt,[t("select",{value:$.value,onChange:e[0]||(e[0]=s=>et(Number(s.target.value))),class:"form-select text-sm",style:{"min-width":"200px"}},[(a(!0),l(m,null,g(k.value,s=>(a(),l("option",{key:s.id,value:s.id},r(s.name)+" "+r(s.is_default?"(Default)":""),9,Xt))),128))],40,Kt)])):v("",!0),t("button",{class:"btn btn-secondary btn-sm",onClick:E,disabled:V.value},[V.value?(a(),l("span",Yt)):v("",!0),w(" "+r(V.value?"Updating...":"ðŸ”„ Refresh All"),1)],8,Zt)])]),t("div",te,[t("button",{class:p(["tab-btn",{active:y.value==="config"}]),onClick:e[1]||(e[1]=s=>y.value="config")}," âš™ï¸ Config ",2),t("button",{class:p(["tab-btn",{active:y.value==="monitor"}]),onClick:e[2]||(e[2]=s=>y.value="monitor")}," ðŸ–¥ï¸ Cluster Monitor ",2),t("button",{class:p(["tab-btn",{active:y.value==="ha"}]),onClick:e[3]||(e[3]=s=>y.value="ha")}," ðŸ›¡ï¸ HA Manager ",2),t("button",{class:p(["tab-btn",{active:y.value==="topology"}]),onClick:e[4]||(e[4]=s=>y.value="topology")}," ðŸŒ Topology ",2),t("button",{class:p(["tab-btn danger-tab",{active:y.value==="dangerous"}]),onClick:e[5]||(e[5]=s=>y.value="dangerous")}," âš ï¸ Dangerous Ops ",2)]),t("div",ee,[y.value==="config"?(a(),l("div",se,[t("div",oe,[t("div",ne,[e[19]||(e[19]=t("div",null,[t("h4",null,"ðŸ“Š Cluster Status"),t("p",{class:"help-text"},"Current cluster initialization and connection status.")],-1)),t("div",{class:p(["cluster-status-badge",ft.value])},r(yt.value),3)]),_(c).clusterStatus?(a(),l("div",le,[t("div",ae,[e[20]||(e[20]=t("span",{class:"label"},"Cluster Name",-1)),t("strong",null,r(_(c).clusterStatus.cluster_name||"N/A"),1)]),t("div",re,[e[21]||(e[21]=t("span",{class:"label"},"Quorum",-1)),t("strong",{class:p(_(c).clusterStatus.quorum?"text-success":"text-danger")},r(_(c).clusterStatus.quorum?"OK":"NO QUORUM"),3)]),t("div",ie,[e[22]||(e[22]=t("span",{class:"label"},"Nodes",-1)),t("strong",null,r(_(c).clusterNodes?.length||0),1)]),t("div",de,[e[23]||(e[23]=t("span",{class:"label"},"Votes",-1)),t("strong",null,r(_(c).clusterStatus.total_votes||0)+" / "+r(_(c).clusterStatus.expected_votes||0),1)])])):(a(),l("div",ue,[...e[24]||(e[24]=[t("em",null,"âš ï¸ No cluster data available. Configure entry point below and refresh.",-1)])]))]),O.value?v("",!0):(a(),l("div",ce,[t("div",pe,[e[25]||(e[25]=t("div",null,[t("h4",null,"ðŸ”Œ Cluster Connections"),t("p",{class:"help-text"},"Manage connecting to one or more Proxmox clusters. These connections are used for Monitoring, HA, and Load Balancing.")],-1)),t("button",{class:"btn btn-primary btn-sm",onClick:e[6]||(e[6]=s=>st())},"âž• Add Cluster")]),k.value.length===0?(a(),l("div",ve,' No clusters configured. Click "Add Cluster" to connect. ')):(a(),l("div",me,[(a(!0),l(m,null,g(k.value,s=>(a(),l("div",{key:s.id,class:p(["cluster-item p-4 border border-gray-700 rounded mb-2 flex justify-between items-center hover:bg-opacity-50 hover:bg-gray-800 transition-colors",{"ring-2 ring-blue-500 bg-gray-800":$.value===s.id}])},[t("div",{class:"flex items-center gap-3 cursor-pointer flex-grow",onClick:n=>et(s.id)},[t("span",ye,r($.value===s.id?"ðŸŸ¢":"âšª"),1),t("div",null,[t("div",fe,[w(r(s.name||`Cluster (${s.hosts.split(",")[0]})`)+" ",1),s.is_default?(a(),l("span",_e,"Default")):v("",!0),s.is_initialized?(a(),l("span",be,"Online")):(a(),l("span",he,"Offline"))]),t("div",ke,r(s.hosts)+" â€¢ "+r(s.api_user||"Token"),1)])],8,ge),t("div",xe,[t("button",{class:"btn btn-sm btn-secondary",onClick:pt(n=>st(s),["stop"])},"âœï¸ Edit",8,Ce),t("button",{class:"btn btn-sm btn-danger",onClick:pt(n=>Ct(s.id),["stop"])},"ðŸ—‘ï¸ Delete",8,we)])],2))),128))]))])),O.value?(a(),l("div",Ae,[t("h4",Se,r(I.value?"Edit Cluster":"New Cluster Connection"),1),t("div",$e,[t("div",Ne,[e[26]||(e[26]=t("label",null,"Friendly Name",-1)),S(t("input",{type:"text","onUpdate:modelValue":e[7]||(e[7]=s=>u.name=s),class:"form-input",placeholder:"e.g. Production Cluster"},null,512),[[R,u.name]]),e[27]||(e[27]=t("small",{class:"text-secondary"},"Name used to identify this cluster in menus.",-1))]),t("div",Ie,[e[28]||(e[28]=t("label",null,"Cluster Hosts / IPs",-1)),S(t("input",{type:"text","onUpdate:modelValue":e[8]||(e[8]=s=>u.hosts=s),class:"form-input",placeholder:"192.168.1.10, 192.168.1.11"},null,512),[[R,u.hosts]]),e[29]||(e[29]=t("small",{class:"text-secondary"},"Comma separated list of Proxmox node IPs.",-1))]),t("div",Te,[e[30]||(e[30]=t("label",null,"Username",-1)),S(t("input",{type:"text","onUpdate:modelValue":e[9]||(e[9]=s=>u.user=s),class:"form-input",placeholder:"root@pam"},null,512),[[R,u.user]])]),t("div",Ee,[e[31]||(e[31]=t("label",null,"API Token / Password",-1)),S(t("input",{type:"password","onUpdate:modelValue":e[10]||(e[10]=s=>u.password=s),class:"form-input",placeholder:"Enter only to change"},null,512),[[R,u.password]])]),t("div",Be,[t("label",Ge,[S(t("input",{type:"checkbox","onUpdate:modelValue":e[11]||(e[11]=s=>u.verify_ssl=s)},null,512),[[ut,u.verify_ssl]]),e[32]||(e[32]=w(" Verify SSL Certificate (Disable for self-signed) ",-1))])]),t("div",Oe,[t("label",Me,[S(t("input",{type:"checkbox","onUpdate:modelValue":e[12]||(e[12]=s=>u.is_default=s)},null,512),[[ut,u.is_default]]),e[33]||(e[33]=w(" Set as Default Cluster ",-1))])])]),t("div",ze,[t("button",{class:"btn btn-secondary",onClick:kt},"Cancel"),t("button",{class:"btn btn-primary",onClick:xt},"ðŸ’¾ "+r(I.value?"Update Connection":"Create Connection"),1)])])):v("",!0)])):v("",!0),y.value==="topology"?(a(),l("div",Re,[U.value?(a(),l("div",Ve,[...e[34]||(e[34]=[t("div",{class:"spinner-sm",style:{width:"40px",height:"40px","border-width":"3px","margin-bottom":"16px"}},null,-1),t("h3",{style:{margin:"0 0 8px 0","font-size":"1.25rem"}},"Analyzing Network Topology...",-1),t("p",{class:"text-secondary",style:{margin:"0"}},"Connecting to nodes and retrieving configuration",-1)])])):T.value?(a(),l("div",He,[t("div",Pe,[e[37]||(e[37]=t("div",{style:{display:"flex","align-items":"center",gap:"10px","margin-bottom":"16px","padding-bottom":"12px","border-bottom":"1px solid var(--border-color)"}},[t("span",{style:{"font-size":"1.5rem"}},"ðŸ”—"),t("h4",{style:{margin:"0","font-size":"1.1rem"}},"Corosync Cluster Status")],-1)),t("div",Fe,[t("table",je,[t("thead",null,[t("tr",null,[e[35]||(e[35]=t("th",null,"Node",-1)),(a(),l(m,null,g([0,1],s=>t("th",{key:s,style:{"text-align":"center"}},"Ring "+r(s),1)),64)),e[36]||(e[36]=t("th",{style:{"text-align":"right"}},"Quorum Votes",-1))])]),t("tbody",null,[(a(!0),l(m,null,g(T.value.corosync?.rings||{},(s,n)=>(a(),l("tr",{key:n},[t("td",De,r(n),1),t("td",Ue,[s.ring0_addr?(a(),l("span",qe,r(s.ring0_addr),1)):(a(),l("span",Le,"-"))]),t("td",Je,[s.ring1_addr?(a(),l("span",Qe,r(s.ring1_addr),1)):(a(),l("span",We,"-"))]),t("td",Ke,r(s.quorum_votes||1),1)]))),128))])])])]),t("div",null,[e[45]||(e[45]=t("div",{style:{display:"flex","align-items":"center",gap:"10px","margin-bottom":"16px"}},[t("span",{style:{"font-size":"1.5rem"}},"ðŸ•¸ï¸"),t("h4",{style:{margin:"0","font-size":"1.1rem"}},"Network Map")],-1)),t("div",Xe,[(a(!0),l(m,null,g(T.value.nodes,(s,n)=>(a(),l("div",{key:n,class:"topology-node-card"},[t("div",Ze,[t("div",Ye,[e[39]||(e[39]=t("div",{class:"topology-node-icon"},"ðŸ–¥ï¸",-1)),t("div",null,[t("h3",{style:{margin:"0","font-size":"1.1rem",cursor:"pointer",color:"var(--accent)"},onClick:i=>bt(String(n)),title:"Click to view node details"},r(n),9,ts),e[38]||(e[38]=t("span",{class:"text-xs text-secondary"},"Proxmox Node",-1))])]),e[40]||(e[40]=t("span",{class:"badge badge-success"},"Online",-1))]),t("div",es,[t("div",ss,[e[41]||(e[41]=t("h5",{class:"topology-section-title"},"ðŸ”Œ Physical Interfaces",-1)),t("div",os,[(a(!0),l(m,null,g((s||[]).filter(i=>i.type==="eth"||i.type==="bond"),i=>(a(),l("div",{key:i.iface,class:p(["topology-iface-chip",{active:i.active}])},[t("span",{class:p(["iface-dot",{active:i.active}])},null,2),w(" "+r(i.iface),1)],2))),128))])]),t("div",ns,[e[44]||(e[44]=t("h5",{class:"topology-section-title"},"ðŸŒ‰ Bridges & Virtual Machines",-1)),t("div",ls,[(a(!0),l(m,null,g((s||[]).filter(i=>i.type==="bridge"),i=>(a(),l("div",{key:i.iface,class:"topology-bridge-box"},[t("div",as,[t("span",rs,r(i.iface),1),t("span",is,r(i.cidr||"L2 Switch"),1)]),i.bridge_ports?(a(),l("div",ds,[e[43]||(e[43]=t("span",{class:"bridge-ports-label"},"Uplink:",-1)),t("div",us,[(a(!0),l(m,null,g(i.bridge_ports.split(" ").filter(d=>d),d=>(a(),l("div",{key:d,class:"bridge-port-group"},[t("span",{class:p(["bridge-port-chip",{bond:d.startsWith("bond")}])},[w(r(d)+" ",1),Y(s,d)?(a(),l("span",cs,r(Y(s,d)),1)):v("",!0)],2),tt(s,d)?(a(),l("div",ps,[e[42]||(e[42]=t("span",{class:"slaves-arrow"},"â†’",-1)),(a(!0),l(m,null,g(tt(s,d),f=>(a(),l("span",{key:f,class:"slave-nic"},r(f),1))),128))])):v("",!0)]))),128))])])):v("",!0),t("div",vs,[(a(!0),l(m,null,g(X(String(n),i.iface),d=>(a(),l("div",{key:d.id,class:p(["topology-guest-item clickable-guest",{vm:d.type==="vm",ct:d.type==="ct"}]),onClick:f=>ht(d),title:"Click to view VM details"},[t("span",gs,r(d.type==="vm"?"ðŸ’»":"ðŸ“¦"),1),t("div",ys,[t("strong",fs,r(d.name||d.id),1),t("span",_s,"ID: "+r(d.id),1)]),Z(d,i.iface)?(a(),l("span",bs," VLAN "+r(Z(d,i.iface)),1)):v("",!0)],10,ms))),128)),X(String(n),i.iface).length===0?(a(),l("div",hs," No guests connected ")):v("",!0)])]))),128))])])])]))),128))])])])):v("",!0)])):v("",!0),y.value==="monitor"?(a(),l("div",ks,[V.value&&!b.value?(a(),l("div",xs,[...e[46]||(e[46]=[t("span",{class:"spinner-lg"},null,-1)])])):b.value?(a(),l("div",Cs,[t("div",ws,[t("div",As,[e[47]||(e[47]=t("span",{class:"summary-label"},"Nodes",-1)),t("span",Ss,r(Object.keys(b.value.nodes||{}).length),1)]),t("div",$s,[e[48]||(e[48]=t("span",{class:"summary-label"},"VMs",-1)),t("span",Ns,r(mt.value),1)]),t("div",Is,[e[49]||(e[49]=t("span",{class:"summary-label"},"CTs",-1)),t("span",Ts,r(gt.value),1)]),_(c).clusterStatus?(a(),l("div",Es,[e[50]||(e[50]=t("span",{class:"summary-label"},"Quorum",-1)),t("span",{class:p(["summary-value",_(c).clusterStatus.quorum?"text-success":"text-danger"])},r(_(c).clusterStatus.quorum?"OK":"NO"),3)])):v("",!0)]),t("div",Bs,[(a(!0),l(m,null,g(b.value.nodes,(s,n)=>(a(),l("div",{key:n,class:p(["node-card",Rt(s)])},[t("div",Gs,[t("div",Os,[t("h3",null,r(n),1),t("span",{class:p(["node-status",it(s)])},r(Mt(s)),3)]),t("div",{class:p(["node-score",zt(s.pressure_score)])}," Score: "+r(s.pressure_score.toFixed(1)),3)]),t("div",Ms,[t("div",zs,[t("div",Rs,[e[51]||(e[51]=t("span",null,"CPU",-1)),t("span",Vs,r(at(s.cpu_usage_percent)),1)]),t("div",Hs,[t("div",{class:p(["progress-fill",dt(s.cpu_usage_percent)]),style:vt({width:s.cpu_usage_percent+"%"})},null,6)])]),t("div",Ps,[t("div",Fs,[e[52]||(e[52]=t("span",null,"RAM",-1)),t("span",js,r(at(s.memory_usage_percent)),1)]),t("div",Ds,[t("div",{class:p(["progress-fill",dt(s.memory_usage_percent)]),style:vt({width:s.memory_usage_percent+"%"})},null,6)]),t("div",Us,r(B(s.memory_used))+" / "+r(B(s.memory_total)),1)]),t("div",qs,[t("div",Ls,[e[53]||(e[53]=t("span",null,"ðŸ“‰ Net In",-1)),t("span",Js,r(B(s.network_in||0))+"/s",1)])]),t("div",Qs,[t("div",Ws,[e[54]||(e[54]=t("span",null,"ðŸ“ˆ Net Out",-1)),t("span",Ks,r(B(s.network_out||0))+"/s",1)])])]),t("div",Xs,[t("div",Zs,[t("span",Ys,"Running Guests ("+r(L(n).length)+")",1),t("button",{class:"btn-xs btn-text",onClick:i=>Ht(n)},r(F.value[n]?"Hide Topology":"Show Network Topology"),9,to)]),t("div",eo,[(a(!0),l(m,null,g(L(n),i=>(a(),l("div",{key:i.id,class:p(["guest-chip",i.type]),title:Vt(i)},[t("span",oo,r(i.type==="vm"?"ðŸ–¥":"ðŸ“¦"),1),t("span",no,r(i.name||i.id),1)],10,so))),128))])]),F.value[n]?(a(),l("div",lo,[e[55]||(e[55]=t("h4",null,"ðŸ”Œ Network Topology",-1)),(a(!0),l(m,null,g(Pt(n),(i,d)=>(a(),l("div",{key:d,class:"topology-bridge"},[t("div",ao,"ðŸŒ‰ "+r(d),1),(a(!0),l(m,null,g(i,(f,x)=>(a(),l("div",{key:x,class:"topology-vlan"},[t("div",ro,"ðŸ·ï¸ VLAN "+r(x==="untagged"?"Untagged":x),1),t("div",io,[(a(!0),l(m,null,g(f,A=>(a(),l("div",{key:A.id,class:p(["topology-guest",A.type])},[w(r(A.type==="vm"?"ðŸ–¥":"ðŸ“¦")+" ",1),t("strong",null,r(A.name||A.id),1),w(" ("+r(A.iface)+") ",1)],2))),128))])]))),128))]))),128))])):v("",!0),t("div",uo,[t("div",co,[t("span",po,r(rt(n,"qemu"))+" VMs",1),t("span",vo,r(rt(n,"lxc"))+" CTs",1)])])],2))),128))])])):v("",!0),t("div",mo,[e[57]||(e[57]=t("h4",null,"âž• Join Node to Cluster",-1)),t("div",go,[t("div",yo,[e[56]||(e[56]=t("label",null,"New Node IP",-1)),S(t("input",{type:"text","onUpdate:modelValue":e[13]||(e[13]=s=>H.value=s),class:"form-input",placeholder:"192.168.x.x"},null,512),[[R,H.value]])])]),t("div",fo,[t("button",{class:"btn btn-primary",onClick:wt,disabled:!H.value||V.value}," âž• Add Node ",8,_o)])])])):v("",!0),y.value==="ha"?(a(),l("div",bo,[t("div",ho,[e[60]||(e[60]=t("h4",null,"HA Managed Resources",-1)),t("table",ko,[e[59]||(e[59]=t("thead",null,[t("tr",null,[t("th",null,"SID"),t("th",null,"Type"),t("th",null,"State"),t("th",null,"Group"),t("th",null,"Action")])],-1)),t("tbody",null,[(a(!0),l(m,null,g(_(c).haResources,s=>(a(),l("tr",{key:s.sid},[t("td",null,r(s.sid),1),t("td",null,[t("span",{class:p(["badge",s.type==="vm"?"badge-success":"badge-info"])},r(s.type),3)]),t("td",null,[t("span",{class:p(At(s.state))},r(s.state),3)]),t("td",null,r(s.group||"-"),1),t("td",null,[t("button",{class:"btn btn-xs btn-danger",onClick:n=>St(s)},"Remove",8,xo)])]))),128)),_(c).haResources.length===0?(a(),l("tr",Co,[...e[58]||(e[58]=[t("td",{colspan:"5",class:"text-center p-4"},"No HA resources.",-1)])])):v("",!0)])])]),t("div",wo,[t("div",Ao,[e[61]||(e[61]=t("h4",null,"Available Guests",-1)),t("div",So,[t("button",{class:"btn btn-xs btn-secondary",onClick:It},"Select All"),t("button",{class:"btn btn-xs btn-secondary",onClick:e[14]||(e[14]=s=>h.value=[])},"Clear")])]),t("div",$o,[t("table",No,[t("thead",null,[t("tr",null,[t("th",null,[t("input",{type:"checkbox",checked:K.value,onChange:nt},null,40,Io)]),e[62]||(e[62]=t("th",null,"ID",-1)),e[63]||(e[63]=t("th",null,"Name",-1)),e[64]||(e[64]=t("th",null,"Node",-1)),e[65]||(e[65]=t("th",null,"Status",-1))])]),t("tbody",null,[(a(!0),l(m,null,g(_(c).availableGuests,s=>(a(),l("tr",{key:s.vmid,class:p({"bg-highlight":h.value.includes(s.vmid),"opacity-50":s.in_ha})},[t("td",null,[t("input",{type:"checkbox",checked:h.value.includes(s.vmid),onChange:n=>Nt(s.vmid),disabled:s.in_ha},null,40,To)]),t("td",null,r(s.vmid),1),t("td",null,r(s.name),1),t("td",null,r(s.node),1),t("td",null,r(s.in_ha?"âœ… In HA":s.status),1)],2))),128))])])]),h.value.length>0?(a(),l("div",Eo,[t("h5",null,"Add "+r(h.value.length)+" guests to HA",1),t("div",Bo,[S(t("select",{"onUpdate:modelValue":e[15]||(e[15]=s=>M.group=s),class:"form-input"},[e[66]||(e[66]=t("option",{value:""},"No Group",-1)),(a(!0),l(m,null,g(_(c).haGroups,s=>(a(),l("option",{key:s.group,value:s.group},r(s.group),9,Go))),128))],512),[[ct,M.group]]),S(t("select",{"onUpdate:modelValue":e[16]||(e[16]=s=>M.state=s),class:"form-input"},[...e[67]||(e[67]=[t("option",{value:"started"},"Started",-1),t("option",{value:"stopped"},"Stopped",-1)])],512),[[ct,M.state]]),t("button",{class:"btn btn-primary",onClick:Tt},"Add to HA")])])):v("",!0)]),t("div",Oo,[e[70]||(e[70]=t("h4",null,"HA Groups",-1)),t("div",Mo,[t("div",null,[t("table",zo,[e[68]||(e[68]=t("thead",null,[t("tr",null,[t("th",null,"Group"),t("th",null,"Nodes"),t("th",null,"Action")])],-1)),t("tbody",null,[(a(!0),l(m,null,g(_(c).haGroups,s=>(a(),l("tr",{key:s.group},[t("td",null,r(s.group),1),t("td",null,r(s.nodes),1),t("td",null,[t("button",{class:"btn btn-xs btn-danger",onClick:n=>$t(s.group)},"Delete",8,Ro)])]))),128))])])]),t("div",Vo,[e[69]||(e[69]=t("h5",null,"Create Group",-1)),t("div",Ho,[S(t("input",{type:"text","onUpdate:modelValue":e[17]||(e[17]=s=>P.name=s),class:"form-input",placeholder:"Group Name"},null,512),[[R,P.name]]),t("div",Po,[(a(!0),l(m,null,g(_(c).clusterNodes,s=>(a(),l("div",{key:s.name},[t("label",Fo,[t("input",{type:"checkbox",checked:z.value.some(n=>n.name===s.name),onChange:n=>Et(s.name)},null,40,jo),w(" "+r(s.name),1)])]))),128))]),t("button",{class:"btn btn-primary w-full",onClick:Bt},"Create Group")])])])])])):v("",!0),y.value==="dangerous"?(a(),l("div",Do,[e[74]||(e[74]=t("div",{class:"alert alert-danger mb-6 border-l-4 border-red-600"},[t("h3",{class:"text-red-500 font-bold text-lg flex items-center gap-2"}," âš ï¸ DANGER ZONE "),t("p",{class:"mt-2 text-primary"},[w(" The operations in this section are "),t("strong",null,"destructive"),w(". Removing nodes incorrectly can break quorum and make your cluster read-only or inaccessible. ")]),t("p",{class:"mt-2 font-bold"}," ðŸ›¡ï¸ An automatic configuration backup will be triggered before any operation. ")],-1)),t("div",Uo,[e[72]||(e[72]=t("h4",{class:"text-red-400"},"Manage Dead Nodes",-1)),e[73]||(e[73]=t("p",{class:"mb-4 text-sm text-secondary"}," If a node is permanently dead or has been physically removed, you can remove it from the cluster configuration here. ",-1)),t("table",qo,[e[71]||(e[71]=t("thead",null,[t("tr",null,[t("th",null,"Node Name"),t("th",null,"Status"),t("th",null,"Actions")])],-1)),t("tbody",null,[(a(!0),l(m,null,g(_(c).clusterNodes,s=>(a(),l("tr",{key:s.name},[t("td",Lo,r(s.name),1),t("td",null,[t("span",{class:p(s.status==="online"?"badge-success":"badge-danger")},r(s.status?.toUpperCase()),3)]),t("td",null,[t("div",Jo,[t("button",{class:"btn btn-xs btn-warning",onClick:n=>Ot(s.name),title:"Remove leftover config"}," ðŸ§¹ Clean Refs ",8,Qo),t("button",{class:"btn btn-xs btn-danger",onClick:n=>Gt(s.name),disabled:s.is_local||s.status==="online",title:"Remove from quorum (Must be offline)"}," ðŸ’£ Force Remove ",8,Wo)])])]))),128))])])])])):v("",!0)])]))}}),tn=Ut(Ko,[["__scopeId","data-v-24f5119f"]]);export{tn as default};
