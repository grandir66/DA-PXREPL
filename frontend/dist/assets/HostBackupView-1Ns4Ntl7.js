import{d as P,r as u,h as L,o as F,x as I,y as p,c as l,z as O,a as e,m as d,t as i,A as T,v as y,F as g,b as k,p as _,k as E,q as V,e as U,n as j,f as n,_ as q}from"./index-CYXbFCAl.js";const G={class:"host-backup-page"},K={class:"card mb-6"},Q={class:"card-body"},W={class:"grid-2"},X={class:"form-group"},Y={class:"form-group"},Z=["value"],ee={class:"grid-3"},te={class:"form-group"},se={class:"form-group"},oe={class:"form-group"},ae={class:"grid-2 mt-4"},le={class:"checkbox-label"},ne={class:"flex-col gap-2"},ie={class:"checkbox-label"},de={class:"grid-2 mt-4"},re={class:"form-group"},ue={key:0,class:"form-group"},ce={class:"mt-4 text-right"},pe=["disabled"],ve={class:"card mb-6"},me={class:"card-body p-0"},be={class:"table-container"},fe={key:0,class:"data-table"},ye={class:"font-bold"},ge={class:"text-xs"},ke={class:"btn-group"},_e=["onClick","disabled"],he=["onClick"],xe={key:1,class:"empty-state"},Ce={class:"card"},we={class:"card-body"},ze={style:{display:"flex",gap:"12px","align-items":"flex-end"}},Be={class:"form-group",style:{flex:"1"}},Se=["value"],Ee=["disabled"],Ve={class:"card mb-6"},Ue={class:"card-header"},Ne={style:{display:"flex",gap:"12px","align-items":"center"}},$e=["value"],Me=["disabled"],De={class:"card-body p-0"},Je={class:"table-container"},Re={key:0,class:"data-table"},Ae={class:"font-mono text-sm"},He={class:"text-sm"},Pe={class:"btn-group"},Le=["onClick"],Fe=["onClick"],Ie={key:1,class:"empty-state"},Oe={key:2,class:"empty-state"},Te={key:3,class:"empty-state"},je=P({__name:"HostBackupView",setup(qe){const h=u([]),z=u([]),m=u(!0),x=u(!1),C=u(!1),b=u(null),f=u([]),c=u(null),w=u(!1),a=L({name:"Backup Config",node_id:null,schedule:null,keep_last:7,dest_path:"/var/backups/proxmox-config",compress:!0,encrypt:!1,encrypt_password:"",notify_mode:"daily",notify_subject:""});F(()=>{N(),v()});const N=async()=>{try{const o=await I.getNodes();h.value=o.data}catch(o){console.error("Error loading nodes",o)}},v=async()=>{try{const o=await p.get("/host-backup/jobs");z.value=o.data.jobs}catch(o){console.error("Error loading jobs",o)}},$=async()=>{if(!a.node_id){alert("Seleziona un nodo");return}x.value=!0;try{await p.post("/host-backup/jobs",a),alert("Job creato con successo"),v(),m.value=!1}catch(o){alert("Errore creazione: "+(o.response?.data?.detail||o.message))}finally{x.value=!1}},M=async o=>{if(confirm(`Eliminare job ${o.name}?`))try{await p.delete(`/host-backup/jobs/${o.id}`),v()}catch{alert("Errore eliminazione")}},D=async o=>{try{o.running=!0,await p.post(`/host-backup/jobs/${o.id}/run`),alert(`Backup ${o.name} avviato e completato!`),v()}catch(t){alert("Errore esecuzione: "+(t.response?.data?.detail||t.message))}finally{o.running=!1}},J=async()=>{if(b.value){C.value=!0;try{await p.post(`/host-backup/nodes/${b.value}/backup`,{dest_path:"/var/backups/proxmox-config",compress:!0}),alert("Backup manuale completato!"),v()}catch(o){alert("Errore backup manuale: "+(o.response?.data?.detail||o.message))}finally{C.value=!1}}},S=o=>o?new Date(o).toLocaleString():"-",R=o=>o==="success"?"badge-success":o==="failed"?"badge-danger":"badge-secondary",B=async()=>{if(!c.value){f.value=[];return}w.value=!0;try{const o=await p.get(`/host-backup/nodes/${c.value}/backups`);f.value=o.data.backups||[]}catch(o){console.error("Error loading backups",o),f.value=[]}finally{w.value=!1}},A=async o=>{if(confirm(`Eliminare backup ${o.filename}?`))try{await p.delete(`/host-backup/nodes/${c.value}/backups/${o.filename}`),B()}catch(t){alert("Errore eliminazione: "+(t.response?.data?.detail||t.message))}},H=async o=>{try{const t=await p.get(`/host-backup/nodes/${c.value}/backups/${o.filename}/download`,{responseType:"blob"}),s=window.URL.createObjectURL(new Blob([t.data])),r=document.createElement("a");r.href=s,r.setAttribute("download",o.filename),document.body.appendChild(r),r.click(),r.remove(),window.URL.revokeObjectURL(s)}catch(t){alert("Errore download: "+(t.response?.data?.detail||t.message))}};return(o,t)=>(n(),l("div",G,[t[34]||(t[34]=O('<div class="page-header" data-v-f0649e5a><h1 class="page-title" data-v-f0649e5a>ğŸ“¦ Host Config Backup</h1><p class="page-subtitle" data-v-f0649e5a>Backup configurazione host Proxmox PVE e PBS</p></div><div class="info-banner mb-6" data-v-f0649e5a><div class="icon" data-v-f0649e5a>ğŸ’¡</div><div class="content" data-v-f0649e5a><strong data-v-f0649e5a>Cos&#39;Ã¨ l&#39;Host Config Backup?</strong><p data-v-f0649e5a>Backup dei file di configurazione del sistema Proxmox (non delle VM). Include: /etc/pve, /etc/network, configurazione cluster, chiavi SSH, cron jobs.</p><div class="mt-1 text-xs opacity-75" data-v-f0649e5a>Utile per: Disaster recovery, migrazioni server, ripristino configurazione.</div></div></div>',2)),e("div",K,[e("div",{class:"card-header collapse-header",onClick:t[0]||(t[0]=s=>m.value=!m.value)},[t[13]||(t[13]=e("h3",null,"â• Crea Job Host Backup Schedulato",-1)),e("span",null,i(m.value?"â–²":"â–¼"),1)]),d(e("div",Q,[e("div",W,[e("div",X,[t[14]||(t[14]=e("label",null,"Nome Job",-1)),d(e("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=s=>a.name=s),class:"form-input",placeholder:"Backup Config PVE"},null,512),[[y,a.name]])]),e("div",Y,[t[16]||(t[16]=e("label",null,"Nodo",-1)),d(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>a.node_id=s),class:"form-input"},[t[15]||(t[15]=e("option",{value:null,disabled:""},"-- Seleziona nodo --",-1)),(n(!0),l(g,null,k(h.value,s=>(n(),l("option",{key:s.id,value:s.id},i(s.name)+" ("+i(s.node_type)+") ",9,Z))),128))],512),[[_,a.node_id]])])]),e("div",ee,[e("div",te,[t[18]||(t[18]=e("label",null,"Schedule",-1)),d(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>a.schedule=s),class:"form-input"},[...t[17]||(t[17]=[e("option",{value:null},"â¸ï¸ Manuale (disattivato)",-1),e("option",{value:"daily"},"ğŸ“… Giornaliero (00:00)",-1),e("option",{value:"weekly"},"ğŸ“… Settimanale (Domenica)",-1)])],512),[[_,a.schedule]])]),e("div",se,[t[19]||(t[19]=e("label",null,"Retention (mantieni ultimi)",-1)),d(e("input",{type:"number","onUpdate:modelValue":t[4]||(t[4]=s=>a.keep_last=s),class:"form-input",min:"1",max:"100"},null,512),[[y,a.keep_last,void 0,{number:!0}]])]),e("div",oe,[t[20]||(t[20]=e("label",null,"Percorso Destinazione",-1)),d(e("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=s=>a.dest_path=s),class:"form-input",placeholder:"/var/backups/proxmox-config"},null,512),[[y,a.dest_path]])])]),e("div",ae,[e("label",le,[d(e("input",{type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=s=>a.compress=s)},null,512),[[V,a.compress]]),t[21]||(t[21]=E(" ğŸ“¦ Comprimi (gzip) ",-1))]),e("div",ne,[e("label",ie,[d(e("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=s=>a.encrypt=s)},null,512),[[V,a.encrypt]]),t[22]||(t[22]=E(" ğŸ”’ Cripta (AES-256) ",-1))]),a.encrypt?d((n(),l("input",{key:0,type:"password","onUpdate:modelValue":t[8]||(t[8]=s=>a.encrypt_password=s),class:"form-input mt-1",placeholder:"Password crittografia"},null,512)),[[y,a.encrypt_password]]):U("",!0)])]),e("div",de,[e("div",re,[t[24]||(t[24]=e("label",null,"Notifiche Email",-1)),d(e("select",{"onUpdate:modelValue":t[9]||(t[9]=s=>a.notify_mode=s),class:"form-input"},[...t[23]||(t[23]=[e("option",{value:"never"},"Mai",-1),e("option",{value:"always"},"Sempre",-1),e("option",{value:"failure"},"Solo su errore",-1),e("option",{value:"daily"},"ğŸ“… Solo nel riepilogo giornaliero",-1)])],512),[[_,a.notify_mode]])]),a.notify_mode!=="never"&&a.notify_mode!=="daily"?(n(),l("div",ue,[t[25]||(t[25]=e("label",null,"Soggetto Email",-1)),d(e("input",{type:"text","onUpdate:modelValue":t[10]||(t[10]=s=>a.notify_subject=s),class:"form-input",placeholder:"[HOST BACKUP] config-{node_name}"},null,512),[[y,a.notify_subject]])])):U("",!0)]),e("div",ce,[e("button",{class:"btn btn-primary",onClick:$,disabled:x.value},i(x.value?"Creazione...":"+ Crea Job"),9,pe)])],512),[[T,m.value]])]),e("div",ve,[e("div",{class:"card-header"},[t[26]||(t[26]=e("h3",null,"ğŸ“‹ Job Host Backup Configurati",-1)),e("button",{class:"btn btn-sm btn-secondary",onClick:v},"ğŸ”„ Aggiorna")]),e("div",me,[e("div",be,[z.value.length>0?(n(),l("table",fe,[t[27]||(t[27]=e("thead",null,[e("tr",null,[e("th",null,"Nome"),e("th",null,"Nodo"),e("th",null,"Schedule"),e("th",null,"Retention"),e("th",null,"Ultimo Run"),e("th",null,"Stato"),e("th",null,"Azioni")])],-1)),e("tbody",null,[(n(!0),l(g,null,k(z.value,s=>(n(),l("tr",{key:s.id},[e("td",ye,i(s.name),1),e("td",null,i(s.node_name),1),e("td",null,i(s.schedule||"Manuale"),1),e("td",null,i(s.keep_last),1),e("td",ge,i(S(s.last_run)),1),e("td",null,[e("span",{class:j(["badge",R(s.last_status)])},i(s.last_status||"Mai eseguito"),3)]),e("td",null,[e("div",ke,[e("button",{class:"btn btn-xs btn-primary",onClick:r=>D(s),disabled:s.running}," â–¶ï¸ Run ",8,_e),e("button",{class:"btn btn-xs btn-danger",onClick:r=>M(s)}," ğŸ—‘ï¸ ",8,he)])])]))),128))])])):(n(),l("div",xe," Nessun job configurato. Crea un nuovo job per iniziare. "))])])]),e("div",Ce,[t[30]||(t[30]=e("div",{class:"card-header"},[e("h3",null,"âš¡ Backup Manuale Rapido")],-1)),e("div",we,[e("div",ze,[e("div",Be,[t[29]||(t[29]=e("label",null,"Nodo",-1)),d(e("select",{"onUpdate:modelValue":t[11]||(t[11]=s=>b.value=s),class:"form-input"},[t[28]||(t[28]=e("option",{value:null,disabled:""},"-- Seleziona nodo --",-1)),(n(!0),l(g,null,k(h.value,s=>(n(),l("option",{key:s.id,value:s.id},i(s.name),9,Se))),128))],512),[[_,b.value]])]),e("button",{class:"btn btn-success",onClick:J,disabled:!b.value||C.value},i(C.value?"Esecuzione...":"ğŸ’¾ Backup Ora"),9,Ee)])])]),e("div",Ve,[e("div",Ue,[t[32]||(t[32]=e("h3",null,"ğŸ“ Backup Esistenti",-1)),e("div",Ne,[d(e("select",{"onUpdate:modelValue":t[12]||(t[12]=s=>c.value=s),class:"form-input",style:{width:"200px"},onChange:B},[t[31]||(t[31]=e("option",{value:null},"-- Nodo --",-1)),(n(!0),l(g,null,k(h.value,s=>(n(),l("option",{key:s.id,value:s.id},i(s.name),9,$e))),128))],544),[[_,c.value]]),e("button",{class:"btn btn-sm btn-secondary",onClick:B,disabled:!c.value},"ğŸ”„ Aggiorna",8,Me)])]),e("div",De,[e("div",Je,[f.value.length>0?(n(),l("table",Re,[t[33]||(t[33]=e("thead",null,[e("tr",null,[e("th",null,"File"),e("th",null,"Dimensione"),e("th",null,"Data Creazione"),e("th",null,"Azioni")])],-1)),e("tbody",null,[(n(!0),l(g,null,k(f.value,s=>(n(),l("tr",{key:s.filename},[e("td",Ae,i(s.filename),1),e("td",null,i(s.size_human),1),e("td",He,i(S(s.created_at)),1),e("td",null,[e("div",Pe,[e("button",{class:"btn btn-xs btn-secondary",onClick:r=>H(s),title:"Download"}," ğŸ“¥ Download ",8,Le),e("button",{class:"btn btn-xs btn-danger",onClick:r=>A(s),title:"Elimina"}," ğŸ—‘ï¸ ",8,Fe)])])]))),128))])])):c.value&&!w.value?(n(),l("div",Ie," Nessun backup trovato per questo nodo. ")):w.value?(n(),l("div",Oe," â³ Caricamento... ")):(n(),l("div",Te," Seleziona un nodo per visualizzare i backup. "))])])])]))}}),Ke=q(je,[["__scopeId","data-v-f0649e5a"]]);export{Ke as default};
