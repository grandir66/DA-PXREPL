import{d as Ht,r as C,B as G,h as J,D as Q,o as Vt,c as l,a as t,e as v,F as m,b as g,k as w,t as r,n as p,E as _,m as S,v as R,q as dt,p as ut,J as D,w as ct,K as pt,f as a,_ as Pt}from"./index-iBd0y6Oe.js";import{u as Ft}from"./ha_store-BE8Z6xyC.js";const jt={class:"cluster-page"},Dt={class:"page-header"},Ut={class:"actions"},qt={key:0,class:"cluster-selector mr-3"},Lt=["value"],Jt=["value"],Qt=["disabled"],Wt={key:0,class:"spinner-sm"},Kt={class:"tabs"},Xt={class:"tab-content"},Zt={key:0,class:"config-panel"},Yt={class:"card mb-4"},te={class:"flex justify-between items-center"},ee={key:0,class:"cluster-status-grid mt-4"},se={class:"status-item"},oe={class:"status-item"},ne={class:"status-item"},le={class:"status-item"},ae={key:1,class:"mt-4 text-secondary"},re={key:0,class:"card"},ie={class:"flex justify-between items-center mb-4"},de={key:0,class:"text-center p-8 bg-custom-gray rounded text-secondary border border-dashed border-gray-600"},ue={key:1,class:"cluster-list"},ce=["onClick"],pe={class:"text-2xl"},ve={class:"font-bold flex items-center gap-2 text-lg"},me={key:0,class:"px-2 py-0.5 text-xs bg-blue-900 text-blue-200 rounded"},ge={key:1,class:"px-2 py-0.5 text-xs bg-green-900 text-green-200 rounded"},ye={key:2,class:"px-2 py-0.5 text-xs bg-yellow-900 text-yellow-200 rounded"},fe={class:"text-xs text-secondary mt-1 font-mono"},_e={class:"flex gap-2"},be=["onClick"],he=["onClick"],ke={key:1,class:"card"},xe={class:"mb-6 pb-2 border-b border-gray-700"},Ce={class:"form-grid"},we={class:"form-group"},Ae={class:"form-group"},Se={class:"form-group"},Ne={class:"form-group"},$e={class:"form-group checkbox col-span-2 mt-2"},Ie={class:"flex items-center gap-2 cursor-pointer"},Te={class:"form-group checkbox col-span-2"},Ee={class:"flex items-center gap-2 cursor-pointer"},Be={class:"mt-8 flex justify-end gap-2 border-t border-gray-700 pt-4"},Ge={key:1,class:"topology-panel",style:{animation:"fadeIn 0.3s ease"}},Oe={key:0,style:{display:"flex","flex-direction":"column","align-items":"center","justify-content":"center",padding:"80px 20px"}},ze={key:1},Me={class:"card",style:{"margin-bottom":"24px"}},Re={class:"table-container"},He={class:"data-table"},Ve={style:{"font-weight":"600"}},Pe={style:{"text-align":"center"}},Fe={key:0,class:"badge badge-success"},je={key:1,class:"text-secondary"},De={style:{"text-align":"center"}},Ue={key:0,class:"badge badge-success"},qe={key:1,class:"text-secondary"},Le={style:{"text-align":"right","font-family":"monospace"}},Je={class:"topology-grid"},Qe={class:"topology-node-header"},We={style:{display:"flex","align-items":"center",gap:"12px"}},Ke={style:{margin:"0","font-size":"1.1rem"}},Xe={class:"topology-node-content"},Ze={class:"topology-section"},Ye={class:"topology-iface-list"},ts={class:"topology-section"},es={class:"topology-bridges-list"},ss={class:"topology-bridge-header"},os={class:"bridge-name"},ns={class:"bridge-cidr"},ls={key:0,class:"bridge-ports-info"},as={class:"bridge-ports-list"},rs={key:0,class:"bond-mode-badge"},is={key:0,class:"bond-slaves"},ds={class:"topology-guests"},us={class:"guest-icon"},cs={class:"guest-info"},ps={class:"guest-id"},vs={key:0,class:"badge badge-purple",style:{"margin-left":"auto","font-size":"0.7rem"}},ms={key:0,class:"no-guests"},gs={key:2,class:"monitor-panel"},ys={key:0,class:"flex justify-center p-12"},fs={key:1},_s={class:"monitor-summary mb-6"},bs={class:"summary-card"},hs={class:"summary-value"},ks={class:"summary-card"},xs={class:"summary-value"},Cs={class:"summary-card"},ws={class:"summary-value"},As={key:0,class:"summary-card"},Ss={class:"nodes-grid"},Ns={class:"node-header"},$s={class:"node-title"},Is={class:"metrics-grid"},Ts={class:"metric-item"},Es={class:"metric-label"},Bs={class:"metric-value"},Gs={class:"progress-bar"},Os={class:"metric-item"},zs={class:"metric-label"},Ms={class:"metric-value"},Rs={class:"progress-bar"},Hs={class:"metric-subtext"},Vs={class:"metric-item"},Ps={class:"metric-label"},Fs={class:"metric-value"},js={class:"metric-item"},Ds={class:"metric-label"},Us={class:"metric-value"},qs={class:"guest-indicators"},Ls={class:"guest-indicators-header"},Js={class:"indicator-title"},Qs=["onClick"],Ws={class:"guest-chips-grid"},Ks=["title"],Xs={class:"chip-icon"},Zs={class:"chip-id"},Ys={key:0,class:"network-topology"},to={class:"bridge-header"},eo={class:"vlan-header"},so={class:"vlan-guests"},oo={class:"node-footer"},no={class:"guest-counts"},lo={class:"guest-badge vm"},ao={class:"guest-badge ct"},ro={class:"card mt-6"},io={class:"form-grid"},uo={class:"form-group"},co={class:"mt-3"},po=["disabled"],vo={key:3,class:"ha-panel"},mo={class:"card mb-4"},go={class:"data-table"},yo=["onClick"],fo={key:0},_o={class:"card mb-4"},bo={class:"flex justify-between"},ho={class:"flex gap-2"},ko={class:"table-scroll"},xo={class:"data-table"},Co=["checked"],wo=["checked","onChange","disabled"],Ao={key:0,class:"mt-4 p-4 bg-dark-soft rounded border border-gray-700"},So={class:"grid grid-cols-3 gap-4 mt-2"},No=["value"],$o={class:"card"},Io={class:"grid grid-cols-2 gap-6"},To={class:"data-table"},Eo=["onClick"],Bo={class:"p-4 bg-dark-soft rounded"},Go={class:"space-y-3 mt-2"},Oo={class:"space-y-1 max-h-40 overflow-y-auto border border-gray-700 p-2 rounded"},zo={class:"flex items-center gap-2"},Mo=["checked","onChange"],Ro={key:4,class:"dangerous-panel"},Ho={class:"card border-red-900/30"},Vo={class:"data-table"},Po={class:"font-bold"},Fo={class:"flex gap-2"},jo=["onClick"],Do=["onClick","disabled"],Uo=Ht({__name:"Cluster",setup(qo){const c=Ft(),y=C("monitor"),H=G(()=>c.loading),k=C([]),N=C(null),O=C(!1),I=C(null);G(()=>k.value.find(o=>o.id===N.value));const u=J({name:"",hosts:"",user:"",password:"",verify_ssl:!1,is_default:!1}),F=C({}),V=C(""),z=J({group:"",state:"started",max_restart:1,max_relocate:1}),h=C([]),P=J({name:"",restricted:!1,nofailback:!1}),M=C([]),b=G(()=>c.lastAnalysis),vt=G(()=>!b.value||!b.value.guests?0:Object.values(b.value.guests).filter(o=>o.type==="vm"||o.type==="qemu").length),mt=G(()=>!b.value||!b.value.guests?0:Object.values(b.value.guests).filter(o=>o.type==="ct"||o.type==="lxc").length),gt=G(()=>c.clusterStatus?c.clusterStatus.quorum?"Initialized":"No Quorum":"Not Configured"),yt=G(()=>c.clusterStatus?c.clusterStatus.quorum?"status-initialized":"status-warning":"status-not-configured"),W=G(()=>{const o=c.availableGuests.filter(e=>!e.in_ha);return o.length>0&&h.value.length===o.length}),T=C(null),U=C(!1),ft=async()=>{U.value=!0;try{const o=await $();if(!o)return;const e=localStorage.getItem("access_token"),s=await fetch(`/api/ha/node/${o}/topology`,{headers:{Authorization:`Bearer ${e}`}});s.ok&&(T.value=await s.json())}catch(o){console.error("Topology load failed",o)}finally{U.value=!1}};Q(y,o=>{o==="topology"&&(!T.value||k.value.length>0)&&ft()});const K=(o,e)=>{if(!T.value||!T.value.guests)return[];const s=e?e.trim():"";return Object.values(T.value.guests).filter(n=>n.networks?n.node===o&&n.networks.some(i=>(i.bridge&&i.bridge.trim())===s):!1)},X=(o,e)=>{if(!o||!o.networks)return null;const s=e?e.trim():"";return o.networks.find(i=>i.bridge&&i.bridge.trim()===s)?.tag||null},Z=(o,e)=>{if(!o||!e.startsWith("bond"))return null;const s=o.find(i=>i.iface===e&&i.type==="bond");return!s||!s.bond_mode?null:{"balance-rr":"RR","active-backup":"Active-Backup","balance-xor":"XOR",broadcast:"Broadcast","802.3ad":"LACP","balance-tlb":"TLB","balance-alb":"ALB"}[s.bond_mode]||s.bond_mode},Y=(o,e)=>{if(!o||!e.startsWith("bond"))return null;const s=o.find(n=>n.iface===e&&n.type==="bond");return s?s.slaves?s.slaves.split(" ").filter(n=>n.trim()):s.bond_slaves?s.bond_slaves.split(" ").filter(n=>n.trim()):null:null},q=async()=>{try{const o=await $();if(!o)return;const e=localStorage.getItem("access_token"),s=await fetch(`/api/ha/node/${o}/monitor`,{headers:{Authorization:`Bearer ${e}`}});if(!s.ok)throw new Error("Monitor API failed");const n=await s.json();c.setAnalysisResult(n)}catch(o){console.error("Error loading monitor data",o)}},j=async()=>{try{const o=await D.get("/api/clusters");if(k.value=o.data,k.value.length>0){if(!(N.value&&k.value.find(s=>s.id===N.value))){const s=k.value.find(n=>n.is_default);N.value=s?s.id:k.value[0].id}}else N.value=null}catch(o){console.error("Failed to fetch clusters",o)}},tt=o=>{N.value=o,E()},et=o=>{o?(I.value=o.id,u.name=o.name,u.hosts=o.hosts,u.user=o.api_user||"",u.password="",u.verify_ssl=o.verify_ssl,u.is_default=o.is_default,O.value=!0):(I.value=null,u.name="",u.hosts="",u.user="root@pam",u.password="",u.verify_ssl=!1,u.is_default=k.value.length===0,O.value=!0)},_t=()=>{O.value=!1,I.value=null},bt=async()=>{const o={name:u.name,hosts:u.hosts,api_user:u.user,verify_ssl:u.verify_ssl,is_default:u.is_default};u.password&&(o.api_password=u.password);try{I.value?await D.put(`/api/clusters/${I.value}`,o):await D.post("/api/clusters",o),await j(),O.value=!1,I.value=null}catch(e){console.error("Failed to save cluster",e);const s=e.response?.data?.detail||e.message;alert("Failed to save cluster: "+s)}},ht=async o=>{if(confirm(`Sei sicuro di voler eliminare questa configurazione cluster?

I nodi Proxmox e le sincronizzazioni NON verranno toccati.
VerrÃ  rimossa solo la connessione per il monitoraggio e HA.`))try{await D.delete(`/api/clusters/${o}`),await j()}catch(e){console.error("Failed to delete cluster",e)}},E=async()=>{await c.fetchHAData(!0),y.value==="config"&&await j(),y.value==="monitor"&&await q()};Vt(async()=>{await j(),c.fetchHAData(),q(),c.startBackgroundRefresh()}),Q(y,o=>{o==="config"&&st(),o==="monitor"&&q()});const $=async()=>{const o=localStorage.getItem("access_token");try{const s=await(await fetch("/api/nodes/",{headers:{Authorization:`Bearer ${o}`}})).json();if(s.length>0)return s[0].id}catch(e){console.error(e)}return null},st=async()=>{try{const o=localStorage.getItem("access_token"),s=await(await fetch("/api/load-balancer/config",{headers:{Authorization:`Bearer ${o}`}})).json();s.proxmox_api&&(u.hosts=s.proxmox_api.hosts||"",u.user=s.proxmox_api.user||"")}catch{}},kt=async()=>{if(!confirm(`Add ${V.value} to cluster?`))return;const o=await $();if(!o)return;const e=localStorage.getItem("access_token");try{const n=await(await fetch(`/api/ha/node/${o}/cluster/nodes`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({new_node_ip:V.value})})).json();n.success?(alert("Node added!"),E()):alert("Error: "+n.message)}catch(s){alert("Error: "+s)}},xt=o=>o==="started"?"badge-success":o==="stopped"?"badge-secondary":"badge-warning",Ct=async o=>{if(!confirm("Remove resource?"))return;const e=await $();if(e)try{const s=localStorage.getItem("access_token");await fetch(`/api/ha/node/${e}/resources/${o.sid}?vm_type=${o.type}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}}),E()}catch(s){alert("Error: "+s)}},wt=async o=>{if(!confirm("Delete Group?"))return;const e=await $();if(e)try{const s=localStorage.getItem("access_token");await fetch(`/api/ha/node/${e}/groups/${o}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}}),E()}catch(s){alert("Error: "+s)}},At=o=>{const e=h.value.indexOf(o);e===-1?h.value.push(o):h.value.splice(e,1)},ot=()=>{W.value?h.value=[]:h.value=c.availableGuests.filter(o=>!o.in_ha).map(o=>o.vmid)},St=()=>ot(),Nt=async()=>{const o=await $(),e=localStorage.getItem("access_token");for(const s of h.value){const n=c.availableGuests.find(i=>i.vmid===s);n&&await fetch(`/api/ha/node/${o}/resources`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({vmid:s,vm_type:n.type,group:z.group||null,state:z.state,max_restart:1,max_relocate:1})})}h.value=[],E()},$t=o=>{const e=M.value.findIndex(s=>s.name===o);e===-1?M.value.push({name:o,priority:1}):M.value.splice(e,1)},It=async()=>{if(!P.name)return;const o=await $(),e=localStorage.getItem("access_token"),s=M.value.map(n=>n.name);await fetch(`/api/ha/node/${o}/groups`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({name:P.name,nodes:s,restricted:!1,nofailback:!1})}),P.name="",M.value=[],E()},nt=async()=>{console.log("Triggering auto-backup...");try{const o=localStorage.getItem("access_token");await fetch("/api/load-balancer/cluster/backup-config",{method:"POST",headers:{Authorization:`Bearer ${o}`}})}catch(o){console.warn("Backup endpoint error",o)}},Tt=async o=>{if(!confirm(`DANGER: Remove ${o}? Node must be OFFLINE.`)||!confirm("Are you really sure? This can break quorum."))return;await nt();const e=await $(),s=localStorage.getItem("access_token");try{const i=await(await fetch(`/api/ha/node/${e}/cluster/nodes/${o}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}})).json();i.success?(alert("Removed."),E()):alert("Error: "+i.message)}catch(n){alert("Error: "+n)}},Et=async o=>{if(!confirm(`Clean references for ${o}?`))return;await nt();const e=await $(),s=localStorage.getItem("access_token");try{const n=await fetch(`/api/ha/node/${e}/cluster/nodes/${o}/clean`,{method:"POST",headers:{Authorization:`Bearer ${s}`}});alert("Cleaned.")}catch(n){alert("Error: "+n)}};Q(y,o=>{o==="config"&&st()});const B=o=>{if(!o||isNaN(o))return"N/A";const e=o/(1024*1024*1024);return e>=1?e.toFixed(1)+" GB":(o/(1024*1024)).toFixed(0)+" MB"},lt=o=>o==null||isNaN(o)?"N/A":o.toFixed(1)+"%",L=o=>{if(!b.value||!b.value.guests)return[];const e=b.value.guests,s=[];for(const n in e){const i=e[n];i.node_current===o&&s.push({...i,id:n})}return s.sort((n,i)=>(n.name||n.id).localeCompare(i.name||i.id))},at=(o,e)=>{if(!b.value||!b.value.guests)return 0;const s=b.value.guests;let n=0;const i=e==="qemu"?"vm":"ct";for(const d in s){const f=s[d];f.node_current===o&&f.type===i&&n++}return n},Bt=o=>o.pressure_score>50?"Critical":o.pressure_score>20?"Warning":"Healthy",rt=o=>o.pressure_score>50?"status-critical":o.pressure_score>20?"status-warning":"status-healthy",Gt=o=>o>50?"score-critical":o>20?"score-warning":"score-healthy",Ot=o=>rt(o),it=o=>o>80?"bg-danger":o>60?"bg-warning":"bg-success",zt=o=>{const e=o.name||o.id,s=o.type==="vm"?"VM":"Container",n=o.cpu_used?(o.cpu_used*100).toFixed(1)+"%":"N/A",i=o.memory_used?B(o.memory_used):"N/A",d=o.disk_used?B(o.disk_used):"N/A",f=o.network_in?B(o.network_in):"0 B",x=o.network_out?B(o.network_out):"0 B";return`${s}: ${e} (ID: ${o.id})
CPU: ${n}
Mem: ${i}
Disk: ${d}
Net In: ${f}/s
Net Out: ${x}/s`},Mt=o=>{F.value[o]=!F.value[o]},Rt=o=>{const e={};L(o).forEach(i=>{const d=i.networks||[];d.length!==0&&d.forEach(f=>{const x=f.bridge||"Unknown",A=f.tag||"untagged";e[x]||(e[x]={}),e[x][A]||(e[x][A]=[]),e[x][A].push({id:i.id,type:i.type,iface:f.id||f.ifname||"net?"})})});const n={};return Object.keys(e).sort().forEach(i=>{n[i]={},Object.keys(e[i]).sort((d,f)=>d==="untagged"?-1:f==="untagged"?1:parseInt(d)-parseInt(f)).forEach(d=>{n[i][d]=e[i][d]})}),n};return(o,e)=>(a(),l("div",jt,[t("div",Dt,[e[18]||(e[18]=t("div",null,[t("h1",{class:"page-title"},"ðŸ–¥ï¸ Cluster Management"),t("p",{class:"page-subtitle"},"Manage Proxmox Cluster, HA, and Configuration")],-1)),t("div",Ut,[k.value.length>0?(a(),l("div",qt,[t("select",{value:N.value,onChange:e[0]||(e[0]=s=>tt(Number(s.target.value))),class:"form-select text-sm",style:{"min-width":"200px"}},[(a(!0),l(m,null,g(k.value,s=>(a(),l("option",{key:s.id,value:s.id},r(s.name)+" "+r(s.is_default?"(Default)":""),9,Jt))),128))],40,Lt)])):v("",!0),t("button",{class:"btn btn-secondary btn-sm",onClick:E,disabled:H.value},[H.value?(a(),l("span",Wt)):v("",!0),w(" "+r(H.value?"Updating...":"ðŸ”„ Refresh All"),1)],8,Qt)])]),t("div",Kt,[t("button",{class:p(["tab-btn",{active:y.value==="config"}]),onClick:e[1]||(e[1]=s=>y.value="config")}," âš™ï¸ Config ",2),t("button",{class:p(["tab-btn",{active:y.value==="monitor"}]),onClick:e[2]||(e[2]=s=>y.value="monitor")}," ðŸ–¥ï¸ Cluster Monitor ",2),t("button",{class:p(["tab-btn",{active:y.value==="ha"}]),onClick:e[3]||(e[3]=s=>y.value="ha")}," ðŸ›¡ï¸ HA Manager ",2),t("button",{class:p(["tab-btn",{active:y.value==="topology"}]),onClick:e[4]||(e[4]=s=>y.value="topology")}," ðŸŒ Topology ",2),t("button",{class:p(["tab-btn danger-tab",{active:y.value==="dangerous"}]),onClick:e[5]||(e[5]=s=>y.value="dangerous")}," âš ï¸ Dangerous Ops ",2)]),t("div",Xt,[y.value==="config"?(a(),l("div",Zt,[t("div",Yt,[t("div",te,[e[19]||(e[19]=t("div",null,[t("h4",null,"ðŸ“Š Cluster Status"),t("p",{class:"help-text"},"Current cluster initialization and connection status.")],-1)),t("div",{class:p(["cluster-status-badge",yt.value])},r(gt.value),3)]),_(c).clusterStatus?(a(),l("div",ee,[t("div",se,[e[20]||(e[20]=t("span",{class:"label"},"Cluster Name",-1)),t("strong",null,r(_(c).clusterStatus.cluster_name||"N/A"),1)]),t("div",oe,[e[21]||(e[21]=t("span",{class:"label"},"Quorum",-1)),t("strong",{class:p(_(c).clusterStatus.quorum?"text-success":"text-danger")},r(_(c).clusterStatus.quorum?"OK":"NO QUORUM"),3)]),t("div",ne,[e[22]||(e[22]=t("span",{class:"label"},"Nodes",-1)),t("strong",null,r(_(c).clusterNodes?.length||0),1)]),t("div",le,[e[23]||(e[23]=t("span",{class:"label"},"Votes",-1)),t("strong",null,r(_(c).clusterStatus.total_votes||0)+" / "+r(_(c).clusterStatus.expected_votes||0),1)])])):(a(),l("div",ae,[...e[24]||(e[24]=[t("em",null,"âš ï¸ No cluster data available. Configure entry point below and refresh.",-1)])]))]),O.value?v("",!0):(a(),l("div",re,[t("div",ie,[e[25]||(e[25]=t("div",null,[t("h4",null,"ðŸ”Œ Cluster Connections"),t("p",{class:"help-text"},"Manage connecting to one or more Proxmox clusters. These connections are used for Monitoring, HA, and Load Balancing.")],-1)),t("button",{class:"btn btn-primary btn-sm",onClick:e[6]||(e[6]=s=>et())},"âž• Add Cluster")]),k.value.length===0?(a(),l("div",de,' No clusters configured. Click "Add Cluster" to connect. ')):(a(),l("div",ue,[(a(!0),l(m,null,g(k.value,s=>(a(),l("div",{key:s.id,class:p(["cluster-item p-4 border border-gray-700 rounded mb-2 flex justify-between items-center hover:bg-opacity-50 hover:bg-gray-800 transition-colors",{"ring-2 ring-blue-500 bg-gray-800":N.value===s.id}])},[t("div",{class:"flex items-center gap-3 cursor-pointer flex-grow",onClick:n=>tt(s.id)},[t("span",pe,r(N.value===s.id?"ðŸŸ¢":"âšª"),1),t("div",null,[t("div",ve,[w(r(s.name||`Cluster (${s.hosts.split(",")[0]})`)+" ",1),s.is_default?(a(),l("span",me,"Default")):v("",!0),s.is_initialized?(a(),l("span",ge,"Online")):(a(),l("span",ye,"Offline"))]),t("div",fe,r(s.hosts)+" â€¢ "+r(s.api_user||"Token"),1)])],8,ce),t("div",_e,[t("button",{class:"btn btn-sm btn-secondary",onClick:ct(n=>et(s),["stop"])},"âœï¸ Edit",8,be),t("button",{class:"btn btn-sm btn-danger",onClick:ct(n=>ht(s.id),["stop"])},"ðŸ—‘ï¸ Delete",8,he)])],2))),128))]))])),O.value?(a(),l("div",ke,[t("h4",xe,r(I.value?"Edit Cluster":"New Cluster Connection"),1),t("div",Ce,[t("div",we,[e[26]||(e[26]=t("label",null,"Friendly Name",-1)),S(t("input",{type:"text","onUpdate:modelValue":e[7]||(e[7]=s=>u.name=s),class:"form-input",placeholder:"e.g. Production Cluster"},null,512),[[R,u.name]]),e[27]||(e[27]=t("small",{class:"text-secondary"},"Name used to identify this cluster in menus.",-1))]),t("div",Ae,[e[28]||(e[28]=t("label",null,"Cluster Hosts / IPs",-1)),S(t("input",{type:"text","onUpdate:modelValue":e[8]||(e[8]=s=>u.hosts=s),class:"form-input",placeholder:"192.168.1.10, 192.168.1.11"},null,512),[[R,u.hosts]]),e[29]||(e[29]=t("small",{class:"text-secondary"},"Comma separated list of Proxmox node IPs.",-1))]),t("div",Se,[e[30]||(e[30]=t("label",null,"Username",-1)),S(t("input",{type:"text","onUpdate:modelValue":e[9]||(e[9]=s=>u.user=s),class:"form-input",placeholder:"root@pam"},null,512),[[R,u.user]])]),t("div",Ne,[e[31]||(e[31]=t("label",null,"API Token / Password",-1)),S(t("input",{type:"password","onUpdate:modelValue":e[10]||(e[10]=s=>u.password=s),class:"form-input",placeholder:"Enter only to change"},null,512),[[R,u.password]])]),t("div",$e,[t("label",Ie,[S(t("input",{type:"checkbox","onUpdate:modelValue":e[11]||(e[11]=s=>u.verify_ssl=s)},null,512),[[dt,u.verify_ssl]]),e[32]||(e[32]=w(" Verify SSL Certificate (Disable for self-signed) ",-1))])]),t("div",Te,[t("label",Ee,[S(t("input",{type:"checkbox","onUpdate:modelValue":e[12]||(e[12]=s=>u.is_default=s)},null,512),[[dt,u.is_default]]),e[33]||(e[33]=w(" Set as Default Cluster ",-1))])])]),t("div",Be,[t("button",{class:"btn btn-secondary",onClick:_t},"Cancel"),t("button",{class:"btn btn-primary",onClick:bt},"ðŸ’¾ "+r(I.value?"Update Connection":"Create Connection"),1)])])):v("",!0)])):v("",!0),y.value==="topology"?(a(),l("div",Ge,[U.value?(a(),l("div",Oe,[...e[34]||(e[34]=[t("div",{class:"spinner-sm",style:{width:"40px",height:"40px","border-width":"3px","margin-bottom":"16px"}},null,-1),t("h3",{style:{margin:"0 0 8px 0","font-size":"1.25rem"}},"Analyzing Network Topology...",-1),t("p",{class:"text-secondary",style:{margin:"0"}},"Connecting to nodes and retrieving configuration",-1)])])):T.value?(a(),l("div",ze,[t("div",Me,[e[37]||(e[37]=t("div",{style:{display:"flex","align-items":"center",gap:"10px","margin-bottom":"16px","padding-bottom":"12px","border-bottom":"1px solid var(--border-color)"}},[t("span",{style:{"font-size":"1.5rem"}},"ðŸ”—"),t("h4",{style:{margin:"0","font-size":"1.1rem"}},"Corosync Cluster Status")],-1)),t("div",Re,[t("table",He,[t("thead",null,[t("tr",null,[e[35]||(e[35]=t("th",null,"Node",-1)),(a(),l(m,null,g([0,1],s=>t("th",{key:s,style:{"text-align":"center"}},"Ring "+r(s),1)),64)),e[36]||(e[36]=t("th",{style:{"text-align":"right"}},"Quorum Votes",-1))])]),t("tbody",null,[(a(!0),l(m,null,g(T.value.corosync?.rings||{},(s,n)=>(a(),l("tr",{key:n},[t("td",Ve,r(n),1),t("td",Pe,[s.ring0_addr?(a(),l("span",Fe,r(s.ring0_addr),1)):(a(),l("span",je,"-"))]),t("td",De,[s.ring1_addr?(a(),l("span",Ue,r(s.ring1_addr),1)):(a(),l("span",qe,"-"))]),t("td",Le,r(s.quorum_votes||1),1)]))),128))])])])]),t("div",null,[e[45]||(e[45]=t("div",{style:{display:"flex","align-items":"center",gap:"10px","margin-bottom":"16px"}},[t("span",{style:{"font-size":"1.5rem"}},"ðŸ•¸ï¸"),t("h4",{style:{margin:"0","font-size":"1.1rem"}},"Network Map")],-1)),t("div",Je,[(a(!0),l(m,null,g(T.value.nodes,(s,n)=>(a(),l("div",{key:n,class:"topology-node-card"},[t("div",Qe,[t("div",We,[e[39]||(e[39]=t("div",{class:"topology-node-icon"},"ðŸ–¥ï¸",-1)),t("div",null,[t("h3",Ke,r(n),1),e[38]||(e[38]=t("span",{class:"text-xs text-secondary"},"Proxmox Node",-1))])]),e[40]||(e[40]=t("span",{class:"badge badge-success"},"Online",-1))]),t("div",Xe,[t("div",Ze,[e[41]||(e[41]=t("h5",{class:"topology-section-title"},"ðŸ”Œ Physical Interfaces",-1)),t("div",Ye,[(a(!0),l(m,null,g((s||[]).filter(i=>i.type==="eth"||i.type==="bond"),i=>(a(),l("div",{key:i.iface,class:p(["topology-iface-chip",{active:i.active}])},[t("span",{class:p(["iface-dot",{active:i.active}])},null,2),w(" "+r(i.iface),1)],2))),128))])]),t("div",ts,[e[44]||(e[44]=t("h5",{class:"topology-section-title"},"ðŸŒ‰ Bridges & Virtual Machines",-1)),t("div",es,[(a(!0),l(m,null,g((s||[]).filter(i=>i.type==="bridge"),i=>(a(),l("div",{key:i.iface,class:"topology-bridge-box"},[t("div",ss,[t("span",os,r(i.iface),1),t("span",ns,r(i.cidr||"L2 Switch"),1)]),i.bridge_ports?(a(),l("div",ls,[e[43]||(e[43]=t("span",{class:"bridge-ports-label"},"Uplink:",-1)),t("div",as,[(a(!0),l(m,null,g(i.bridge_ports.split(" ").filter(d=>d),d=>(a(),l("div",{key:d,class:"bridge-port-group"},[t("span",{class:p(["bridge-port-chip",{bond:d.startsWith("bond")}])},[w(r(d)+" ",1),Z(s,d)?(a(),l("span",rs,r(Z(s,d)),1)):v("",!0)],2),Y(s,d)?(a(),l("div",is,[e[42]||(e[42]=t("span",{class:"slaves-arrow"},"â†’",-1)),(a(!0),l(m,null,g(Y(s,d),f=>(a(),l("span",{key:f,class:"slave-nic"},r(f),1))),128))])):v("",!0)]))),128))])])):v("",!0),t("div",ds,[(a(!0),l(m,null,g(K(String(n),i.iface),d=>(a(),l("div",{key:d.id,class:p(["topology-guest-item",{vm:d.type==="vm",ct:d.type==="ct"}])},[t("span",us,r(d.type==="vm"?"ðŸ’»":"ðŸ“¦"),1),t("div",cs,[t("strong",null,r(d.name||d.id),1),t("span",ps,"ID: "+r(d.id),1)]),X(d,i.iface)?(a(),l("span",vs," VLAN "+r(X(d,i.iface)),1)):v("",!0)],2))),128)),K(String(n),i.iface).length===0?(a(),l("div",ms," No guests connected ")):v("",!0)])]))),128))])])])]))),128))])])])):v("",!0)])):v("",!0),y.value==="monitor"?(a(),l("div",gs,[H.value&&!b.value?(a(),l("div",ys,[...e[46]||(e[46]=[t("span",{class:"spinner-lg"},null,-1)])])):b.value?(a(),l("div",fs,[t("div",_s,[t("div",bs,[e[47]||(e[47]=t("span",{class:"summary-label"},"Nodes",-1)),t("span",hs,r(Object.keys(b.value.nodes||{}).length),1)]),t("div",ks,[e[48]||(e[48]=t("span",{class:"summary-label"},"VMs",-1)),t("span",xs,r(vt.value),1)]),t("div",Cs,[e[49]||(e[49]=t("span",{class:"summary-label"},"CTs",-1)),t("span",ws,r(mt.value),1)]),_(c).clusterStatus?(a(),l("div",As,[e[50]||(e[50]=t("span",{class:"summary-label"},"Quorum",-1)),t("span",{class:p(["summary-value",_(c).clusterStatus.quorum?"text-success":"text-danger"])},r(_(c).clusterStatus.quorum?"OK":"NO"),3)])):v("",!0)]),t("div",Ss,[(a(!0),l(m,null,g(b.value.nodes,(s,n)=>(a(),l("div",{key:n,class:p(["node-card",Ot(s)])},[t("div",Ns,[t("div",$s,[t("h3",null,r(n),1),t("span",{class:p(["node-status",rt(s)])},r(Bt(s)),3)]),t("div",{class:p(["node-score",Gt(s.pressure_score)])}," Score: "+r(s.pressure_score.toFixed(1)),3)]),t("div",Is,[t("div",Ts,[t("div",Es,[e[51]||(e[51]=t("span",null,"CPU",-1)),t("span",Bs,r(lt(s.cpu_usage_percent)),1)]),t("div",Gs,[t("div",{class:p(["progress-fill",it(s.cpu_usage_percent)]),style:pt({width:s.cpu_usage_percent+"%"})},null,6)])]),t("div",Os,[t("div",zs,[e[52]||(e[52]=t("span",null,"RAM",-1)),t("span",Ms,r(lt(s.memory_usage_percent)),1)]),t("div",Rs,[t("div",{class:p(["progress-fill",it(s.memory_usage_percent)]),style:pt({width:s.memory_usage_percent+"%"})},null,6)]),t("div",Hs,r(B(s.memory_used))+" / "+r(B(s.memory_total)),1)]),t("div",Vs,[t("div",Ps,[e[53]||(e[53]=t("span",null,"ðŸ“‰ Net In",-1)),t("span",Fs,r(B(s.network_in||0))+"/s",1)])]),t("div",js,[t("div",Ds,[e[54]||(e[54]=t("span",null,"ðŸ“ˆ Net Out",-1)),t("span",Us,r(B(s.network_out||0))+"/s",1)])])]),t("div",qs,[t("div",Ls,[t("span",Js,"Running Guests ("+r(L(n).length)+")",1),t("button",{class:"btn-xs btn-text",onClick:i=>Mt(n)},r(F.value[n]?"Hide Topology":"Show Network Topology"),9,Qs)]),t("div",Ws,[(a(!0),l(m,null,g(L(n),i=>(a(),l("div",{key:i.id,class:p(["guest-chip",i.type]),title:zt(i)},[t("span",Xs,r(i.type==="vm"?"ðŸ–¥":"ðŸ“¦"),1),t("span",Zs,r(i.name||i.id),1)],10,Ks))),128))])]),F.value[n]?(a(),l("div",Ys,[e[55]||(e[55]=t("h4",null,"ðŸ”Œ Network Topology",-1)),(a(!0),l(m,null,g(Rt(n),(i,d)=>(a(),l("div",{key:d,class:"topology-bridge"},[t("div",to,"ðŸŒ‰ "+r(d),1),(a(!0),l(m,null,g(i,(f,x)=>(a(),l("div",{key:x,class:"topology-vlan"},[t("div",eo,"ðŸ·ï¸ VLAN "+r(x==="untagged"?"Untagged":x),1),t("div",so,[(a(!0),l(m,null,g(f,A=>(a(),l("div",{key:A.id,class:p(["topology-guest",A.type])},[w(r(A.type==="vm"?"ðŸ–¥":"ðŸ“¦")+" ",1),t("strong",null,r(A.name||A.id),1),w(" ("+r(A.iface)+") ",1)],2))),128))])]))),128))]))),128))])):v("",!0),t("div",oo,[t("div",no,[t("span",lo,r(at(n,"qemu"))+" VMs",1),t("span",ao,r(at(n,"lxc"))+" CTs",1)])])],2))),128))])])):v("",!0),t("div",ro,[e[57]||(e[57]=t("h4",null,"âž• Join Node to Cluster",-1)),t("div",io,[t("div",uo,[e[56]||(e[56]=t("label",null,"New Node IP",-1)),S(t("input",{type:"text","onUpdate:modelValue":e[13]||(e[13]=s=>V.value=s),class:"form-input",placeholder:"192.168.x.x"},null,512),[[R,V.value]])])]),t("div",co,[t("button",{class:"btn btn-primary",onClick:kt,disabled:!V.value||H.value}," âž• Add Node ",8,po)])])])):v("",!0),y.value==="ha"?(a(),l("div",vo,[t("div",mo,[e[60]||(e[60]=t("h4",null,"HA Managed Resources",-1)),t("table",go,[e[59]||(e[59]=t("thead",null,[t("tr",null,[t("th",null,"SID"),t("th",null,"Type"),t("th",null,"State"),t("th",null,"Group"),t("th",null,"Action")])],-1)),t("tbody",null,[(a(!0),l(m,null,g(_(c).haResources,s=>(a(),l("tr",{key:s.sid},[t("td",null,r(s.sid),1),t("td",null,[t("span",{class:p(["badge",s.type==="vm"?"badge-success":"badge-info"])},r(s.type),3)]),t("td",null,[t("span",{class:p(xt(s.state))},r(s.state),3)]),t("td",null,r(s.group||"-"),1),t("td",null,[t("button",{class:"btn btn-xs btn-danger",onClick:n=>Ct(s)},"Remove",8,yo)])]))),128)),_(c).haResources.length===0?(a(),l("tr",fo,[...e[58]||(e[58]=[t("td",{colspan:"5",class:"text-center p-4"},"No HA resources.",-1)])])):v("",!0)])])]),t("div",_o,[t("div",bo,[e[61]||(e[61]=t("h4",null,"Available Guests",-1)),t("div",ho,[t("button",{class:"btn btn-xs btn-secondary",onClick:St},"Select All"),t("button",{class:"btn btn-xs btn-secondary",onClick:e[14]||(e[14]=s=>h.value=[])},"Clear")])]),t("div",ko,[t("table",xo,[t("thead",null,[t("tr",null,[t("th",null,[t("input",{type:"checkbox",checked:W.value,onChange:ot},null,40,Co)]),e[62]||(e[62]=t("th",null,"ID",-1)),e[63]||(e[63]=t("th",null,"Name",-1)),e[64]||(e[64]=t("th",null,"Node",-1)),e[65]||(e[65]=t("th",null,"Status",-1))])]),t("tbody",null,[(a(!0),l(m,null,g(_(c).availableGuests,s=>(a(),l("tr",{key:s.vmid,class:p({"bg-highlight":h.value.includes(s.vmid),"opacity-50":s.in_ha})},[t("td",null,[t("input",{type:"checkbox",checked:h.value.includes(s.vmid),onChange:n=>At(s.vmid),disabled:s.in_ha},null,40,wo)]),t("td",null,r(s.vmid),1),t("td",null,r(s.name),1),t("td",null,r(s.node),1),t("td",null,r(s.in_ha?"âœ… In HA":s.status),1)],2))),128))])])]),h.value.length>0?(a(),l("div",Ao,[t("h5",null,"Add "+r(h.value.length)+" guests to HA",1),t("div",So,[S(t("select",{"onUpdate:modelValue":e[15]||(e[15]=s=>z.group=s),class:"form-input"},[e[66]||(e[66]=t("option",{value:""},"No Group",-1)),(a(!0),l(m,null,g(_(c).haGroups,s=>(a(),l("option",{key:s.group,value:s.group},r(s.group),9,No))),128))],512),[[ut,z.group]]),S(t("select",{"onUpdate:modelValue":e[16]||(e[16]=s=>z.state=s),class:"form-input"},[...e[67]||(e[67]=[t("option",{value:"started"},"Started",-1),t("option",{value:"stopped"},"Stopped",-1)])],512),[[ut,z.state]]),t("button",{class:"btn btn-primary",onClick:Nt},"Add to HA")])])):v("",!0)]),t("div",$o,[e[70]||(e[70]=t("h4",null,"HA Groups",-1)),t("div",Io,[t("div",null,[t("table",To,[e[68]||(e[68]=t("thead",null,[t("tr",null,[t("th",null,"Group"),t("th",null,"Nodes"),t("th",null,"Action")])],-1)),t("tbody",null,[(a(!0),l(m,null,g(_(c).haGroups,s=>(a(),l("tr",{key:s.group},[t("td",null,r(s.group),1),t("td",null,r(s.nodes),1),t("td",null,[t("button",{class:"btn btn-xs btn-danger",onClick:n=>wt(s.group)},"Delete",8,Eo)])]))),128))])])]),t("div",Bo,[e[69]||(e[69]=t("h5",null,"Create Group",-1)),t("div",Go,[S(t("input",{type:"text","onUpdate:modelValue":e[17]||(e[17]=s=>P.name=s),class:"form-input",placeholder:"Group Name"},null,512),[[R,P.name]]),t("div",Oo,[(a(!0),l(m,null,g(_(c).clusterNodes,s=>(a(),l("div",{key:s.name},[t("label",zo,[t("input",{type:"checkbox",checked:M.value.some(n=>n.name===s.name),onChange:n=>$t(s.name)},null,40,Mo),w(" "+r(s.name),1)])]))),128))]),t("button",{class:"btn btn-primary w-full",onClick:It},"Create Group")])])])])])):v("",!0),y.value==="dangerous"?(a(),l("div",Ro,[e[74]||(e[74]=t("div",{class:"alert alert-danger mb-6 border-l-4 border-red-600"},[t("h3",{class:"text-red-500 font-bold text-lg flex items-center gap-2"}," âš ï¸ DANGER ZONE "),t("p",{class:"mt-2 text-primary"},[w(" The operations in this section are "),t("strong",null,"destructive"),w(". Removing nodes incorrectly can break quorum and make your cluster read-only or inaccessible. ")]),t("p",{class:"mt-2 font-bold"}," ðŸ›¡ï¸ An automatic configuration backup will be triggered before any operation. ")],-1)),t("div",Ho,[e[72]||(e[72]=t("h4",{class:"text-red-400"},"Manage Dead Nodes",-1)),e[73]||(e[73]=t("p",{class:"mb-4 text-sm text-secondary"}," If a node is permanently dead or has been physically removed, you can remove it from the cluster configuration here. ",-1)),t("table",Vo,[e[71]||(e[71]=t("thead",null,[t("tr",null,[t("th",null,"Node Name"),t("th",null,"Status"),t("th",null,"Actions")])],-1)),t("tbody",null,[(a(!0),l(m,null,g(_(c).clusterNodes,s=>(a(),l("tr",{key:s.name},[t("td",Po,r(s.name),1),t("td",null,[t("span",{class:p(s.status==="online"?"badge-success":"badge-danger")},r(s.status?.toUpperCase()),3)]),t("td",null,[t("div",Fo,[t("button",{class:"btn btn-xs btn-warning",onClick:n=>Et(s.name),title:"Remove leftover config"}," ðŸ§¹ Clean Refs ",8,jo),t("button",{class:"btn btn-xs btn-danger",onClick:n=>Tt(s.name),disabled:s.is_local||s.status==="online",title:"Remove from quorum (Must be offline)"}," ðŸ’£ Force Remove ",8,Do)])])]))),128))])])])])):v("",!0)])]))}}),Qo=Pt(Uo,[["__scopeId","data-v-4d52ae16"]]);export{Qo as default};
