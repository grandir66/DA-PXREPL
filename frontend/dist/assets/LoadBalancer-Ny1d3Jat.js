import{y as q,d as ft,r as c,B as $,C as yt,h as Ce,D as Q,o as ht,i as _t,c as n,a as t,e as p,F as h,b as _,n as g,k as v,t as a,E as m,m as d,v as N,p as T,q as I,G as kt,H as xt,I as Ct,z as wt,J as Nt,f as o,_ as At}from"./index-DisZpmug.js";import{u as St}from"./ha_store-CMOJDULB.js";const we={async analyzeCluster(R){const k={};return R&&(k.params={cluster_id:R}),q.get("/load-balancer/analyze",k)},async executeBalancing(R=!0,k=null,x){const M={};return x&&(M.cluster_id=x),q.post("/load-balancer/execute",{dry_run:R,config:k},{params:M})},async getConfig(){return q.get("/load-balancer/config")},async updateConfig(R){return q.post("/load-balancer/config",R)},async getMigrationHistory(R=100,k){const x=new URLSearchParams;return x.append("limit",R.toString()),k&&x.append("status",k),q.get(`/load-balancer/migrations?${x.toString()}`)},async getMigration(R){return q.get(`/load-balancer/migrations/${R}`)}},$t={class:"load-balancer-view"},It={class:"page-header"},Rt={class:"actions"},Gt={key:0,class:"cluster-selector mr-3"},Ut=["value"],Vt=["value"],Mt={class:"tabs"},Pt={class:"tab-content"},Et={key:0,class:"analysis-panel"},Tt={class:"control-bar"},Ht=["disabled"],Ot={key:0,class:"spinner-sm"},Lt={key:0,class:"analysis-actions"},zt={class:"result-summary"},Bt=["disabled"],Dt=["disabled"],jt={key:0,class:"alert alert-danger"},Ft={key:1,class:"log-output"},Jt={class:"log-window"},qt={key:2,class:"results-grid"},Qt={class:"card"},Wt={class:"data-table"},Yt={class:"card"},Kt={key:0},Xt={class:"data-table"},Zt={key:1,class:"empty-state"},es={key:1,class:"history-panel"},ts={class:"control-bar"},ss=["disabled"],ls={key:0,class:"spinner-sm"},ns={key:0,class:"history-count"},os={key:0,class:"empty-state"},as={key:1,class:"history-table-wrapper"},is={class:"data-table history-table"},rs={class:"date-col"},us={class:"reason-col"},ds={key:2,class:"guests-panel"},cs={class:"control-bar"},ps=["disabled"],vs={key:0,class:"spinner-sm"},ms={class:"search-box"},gs=["value"],bs={key:0,class:"bulk-actions-bar"},fs={class:"selection-count"},ys={class:"bulk-buttons"},hs={class:"table-wrapper"},_s={class:"data-table"},ks={class:"col-checkbox"},xs=["checked"],Cs={class:"col-checkbox"},ws=["value"],Ns={class:"font-mono"},As={class:"font-bold"},Ss={class:"mono-text"},$s={class:"metric-cell"},Is={class:"sub-metric"},Rs={class:"mono-text"},Gs={class:"metric-cell"},Us={class:"sub-metric"},Vs={class:"mono-text"},Ms={class:"metric-cell"},Ps={class:"sub-metric"},Es={key:0,class:"badge-ignored"},Ts={key:1,class:"text-muted"},Hs={key:0},Os={key:3,class:"ha-panel"},Ls={class:"section-header"},zs=["disabled"],Bs={key:0,class:"loading-indicator"},Ds={class:"card mt-3"},js={class:"data-table"},Fs=["onClick"],Js={key:0},qs={class:"card mt-3"},Qs={class:"d-flex align-items-center justify-between"},Ws={class:"badge-info"},Ys={key:0,class:"data-table"},Ks={style:{width:"40px"}},Xs=["checked"],Zs=["checked","onChange","disabled"],el={key:0,class:"badge-success"},tl={key:1,class:"badge-secondary"},sl={key:1,class:"text-center py-4"},ll={key:2,class:"mt-3 p-3 bg-highlight"},nl={class:"form-grid"},ol={class:"form-group"},al=["value"],il={class:"form-group"},rl={class:"form-group"},ul={class:"form-group"},dl=["disabled"],cl={class:"card mt-3"},pl={class:"data-table"},vl=["onClick"],ml={key:0},gl={class:"card mt-3"},bl={class:"form-grid"},fl={class:"form-group"},yl={class:"form-group checkbox"},hl={class:"form-group checkbox"},_l={class:"mt-3"},kl={key:0,class:"node-selection-grid"},xl=["id","checked","onChange"],Cl=["for"],wl=["value","onInput"],Nl={key:1,class:"text-muted"},Al=["disabled"],Sl={key:4,class:"cluster-panel"},$l={class:"section-header"},Il=["disabled"],Rl={key:0,class:"loading-indicator"},Gl={key:1,class:"card mt-3"},Ul={class:"cluster-status-grid"},Vl={class:"status-item"},Ml={class:"status-item"},Pl={class:"status-item"},El={class:"status-item"},Tl={class:"card mt-3"},Hl={class:"data-table"},Ol={key:0,class:"badge-info ml-1"},Ll=["onClick"],zl=["onClick","disabled"],Bl={key:0},Dl={class:"card mt-3"},jl={class:"form-grid"},Fl={class:"form-group"},Jl={class:"form-group"},ql={class:"form-group"},Ql=["disabled"],Wl={key:5,class:"config-panel"},Yl={class:"config-note"},Kl={class:"note-content"},Xl={class:"config-section"},Zl={class:"form-grid"},en={class:"form-group checkbox"},tn={class:"form-group"},sn={class:"form-group"},ln={class:"form-group"},nn={class:"slider-value"},on={class:"form-group"},an={class:"slider-value"},rn={class:"form-group checkbox-group"},un=["checked"],dn=["checked"],cn={class:"form-group checkbox"},pn={class:"config-section"},vn={class:"form-grid"},mn={class:"form-group checkbox"},gn={class:"form-group checkbox"},bn={class:"form-group checkbox"},fn={class:"form-group checkbox"},yn={key:0,class:"form-group"},hn={class:"form-group"},_n={class:"config-section"},kn={class:"form-grid"},xn={class:"form-group checkbox"},Cn={class:"form-group checkbox"},wn={class:"config-section"},Nn={class:"subsection"},An={key:0,class:"multi-select-grid"},Sn=["checked","onChange"],$n={class:"node-name"},In={key:1,class:"empty-hint"},Rn={class:"subsection"},Gn={key:0,class:"multi-select-grid"},Un=["checked","onChange"],Vn={class:"node-name"},Mn={key:1,class:"empty-hint"},Pn={class:"form-group",style:{"margin-top":"16px"}},En={class:"config-section"},Tn={class:"guest-management-grid"},Hn={class:"guest-list-panel"},On={key:0,class:"guest-list"},Ln={class:"guest-name"},zn={class:"guest-node"},Bn=["onClick"],Dn={key:1,class:"empty-hint"},jn={class:"guest-list-panel"},Fn={key:0,class:"guest-list"},Jn={class:"guest-name"},qn={class:"guest-node"},Qn=["onClick"],Wn={key:1,class:"empty-hint"},Yn={class:"config-section"},Kn={class:"form-grid"},Xn={class:"form-group checkbox"},Zn={key:0,class:"form-group"},eo={class:"inline-inputs"},to={class:"form-group"},so={class:"config-section"},lo={key:0,class:"json-preview"},no=ft({__name:"LoadBalancer",setup(R){const k=c([]),x=c(null),M=St(),Je=async()=>{try{const l=await Nt.get("/api/clusters");if(k.value=l.data,k.value.length>0&&!(x.value&&k.value.find(i=>i.id===x.value))){const i=k.value.find(s=>s.is_default);x.value=i?i.id:k.value[0].id}}catch(l){console.error(l)}},qe=l=>{x.value=l,M.setAnalysisResult(null),ge()},b=c("analysis"),y=c(!1),se=c(!1),B=c(null),D=c([]),j=c([]),Qe=c(""),Ne=c(0),le=c(!1),ye=c(!1),ne=c(30),W=c(0);c("");let oe=null,ae=null;const ie=c(!1),We=l=>l?new Date(l).toLocaleString():"-",Ye=l=>({proposed:"üìù",executing:"‚è≥",completed:"‚úÖ",failed:"‚ùå",skipped:"‚è≠Ô∏è"})[l]||"‚ùì",re=c(""),ue=c("all"),de=c("all"),C=c([]),Y=$(()=>!f.value||!f.value.nodes?[]:Object.keys(f.value.nodes).sort()),K=$(()=>{if(!f.value||!f.value.guests)return[];let l=Object.values(f.value.guests);if(re.value){const e=re.value.toLowerCase();l=l.filter(i=>i.name&&i.name.toLowerCase().includes(e)||i.id&&i.id.toString().includes(e))}return ue.value!=="all"&&(l=l.filter(e=>e.type===ue.value)),de.value!=="all"&&(l=l.filter(e=>e.node_current===de.value)),l.sort((e,i)=>parseInt(e.id)-parseInt(i.id))}),Ae=$(()=>K.value.length>0&&C.value.length===K.value.length),Ke=()=>{Ae.value?C.value=[]:C.value=K.value.map(l=>l.id)},Se=l=>U.value.includes(l),$e=async l=>{if(C.value.length===0)return;const e=new Set(U.value);C.value.forEach(i=>{l?e.add(i):e.delete(i)}),U.value=Array.from(e),y.value=!0;try{await De(),C.value=[]}finally{y.value=!1}},Xe=async()=>{if(C.value.length===0)return;const l=new Map;_e.value.forEach(e=>{if(C.value.includes(e.id)){const i=e.node_current;l.has(i)||l.set(i,[]);const s=parseInt(e.id,10);isNaN(s)||l.get(i).push(s)}}),y.value=!0;try{let e=0,i=0;for(const[s,u]of l){L.value.length===0&&await Ue();const V=L.value?.find(fe=>fe.name===s);if(!V){console.warn(`Node ${s} not found in registered nodes`),i+=u.length;continue}const P=localStorage.getItem("access_token"),J=await fetch(`/api/vms/node/${V.id}/bulk-unlock`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${P}`},body:JSON.stringify({guest_ids:u})});if(J.ok){const fe=await J.json();e+=fe.success?.length||0,i+=fe.failed?.length||0}else i+=u.length}e>0?alert(`Unlocked ${e} guests${i>0?`, ${i} failed`:""}`):i>0&&alert(`Failed to unlock ${i} guests`),C.value=[]}catch(e){console.error("Bulk unlock error:",e),alert("Error during bulk unlock")}finally{y.value=!1}},{haResources:Ie,haGroups:he,availableGuests:H,clusterNodes:ce,clusterStatus:F,loading:Re,lastAnalysis:f,migrationHistory:X}=yt(M),O=$(()=>Re.value),Ze=$(()=>Re.value),_e=$(()=>H.value||[]),E=c(""),pe=c(""),ve=c(""),A=Ce({vmid:null,vm_type:"vm",group:"",state:"started",max_restart:1,max_relocate:1}),S=Ce({name:"",nodesStr:"",restricted:!1,nofailback:!1}),w=c([]),G=c([]),Ge=$(()=>{const l=H.value.filter(e=>!e.in_ha);return l.length>0&&l.every(e=>w.value.includes(e.vmid))}),L=c([]),Ue=async()=>{try{const l=localStorage.getItem("access_token"),e=await fetch("/api/nodes/",{headers:{Authorization:`Bearer ${l}`}});e.ok&&(L.value=await e.json())}catch(l){console.error("Error fetching registered nodes:",l)}},z=async()=>(L.value.length===0&&await Ue(),L.value.length>0?L.value.find(e=>e.type==="pve"||e.node_type==="pve")?.id||L.value[0].id:null),Z=async()=>{await M.fetchHAData(!0)},ke=async()=>{await M.fetchHAData(!0)},et=l=>{switch(l){case"started":return"badge-success";case"stopped":return"badge-warning";case"disabled":return"badge-secondary";case"error":return"badge-danger";default:return"badge-info"}},tt=async l=>{if(!confirm(`Remove ${l.sid} from HA?`))return;const e=await z();if(!e)return;const[i,s]=l.sid.split(":");try{const u=localStorage.getItem("access_token"),P=await(await fetch(`/api/ha/node/${e}/resources/${s}?vm_type=${i}`,{method:"DELETE",headers:{Authorization:`Bearer ${u}`}})).json();alert(P.message||"Resource removed"),Z()}catch{alert("Error removing resource from HA")}},st=async l=>{if(!confirm(`Delete HA group "${l}"?`))return;const e=await z();if(e)try{const i=localStorage.getItem("access_token"),u=await(await fetch(`/api/ha/node/${e}/groups/${l}`,{method:"DELETE",headers:{Authorization:`Bearer ${i}`}})).json();alert(u.message||"Group removed"),Z()}catch{alert("Error removing HA group")}},lt=l=>{const e=w.value.indexOf(l);e===-1?w.value.push(l):w.value.splice(e,1)},nt=()=>{const l=H.value.filter(e=>!e.in_ha);Ge.value?w.value=[]:w.value=l.map(e=>e.vmid)},ot=async()=>{if(w.value.length===0)return;const l=await z();if(!l)return;O.value=!0;const e=localStorage.getItem("access_token");let i=0;try{const s=w.value.map(V=>{const P=H.value.find(J=>J.vmid===V);return P?fetch(`/api/ha/node/${l}/resources`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({vmid:V,vm_type:P.type,group:A.group||null,state:A.state,max_restart:A.max_restart,max_relocate:A.max_relocate})}).then(J=>J.ok):Promise.resolve(!1)});i=(await Promise.all(s)).filter(V=>V).length,alert(`Process complete. Added ${i} guests.`),w.value=[],await Z()}catch(s){console.error("Error adding resources to HA:",s)}finally{O.value=!1}},at=l=>{const e=G.value.findIndex(i=>i.name===l);e===-1?G.value.push({name:l,priority:1}):G.value.splice(e,1)},it=l=>{const e=G.value.find(i=>i.name===l);return e?e.priority:1},rt=(l,e)=>{const i=parseInt(e)||1,s=G.value.find(u=>u.name===l);s&&(s.priority=i)},ut=async()=>{const l=G.value.map(i=>i.priority>1?`${i.name}:${i.priority}`:i.name),e=await z();if(e){if(!S.name){alert("Please enter a group name");return}O.value=!0;try{const i=localStorage.getItem("access_token"),s=await fetch(`/api/ha/node/${e}/groups`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({name:S.name,nodes:l,restricted:S.restricted,nofailback:S.nofailback})}),u=await s.json();s.ok?(alert(u.message||"HA Group created"),S.name="",G.value=[],Z()):alert("Error: "+u.detail)}catch(i){console.error(i),alert("Failed to create HA group")}finally{O.value=!1}}},dt=async l=>{if(!confirm(`‚ö†Ô∏è DANGEROUS: Remove node "${l}" from cluster?

The node must be POWERED OFF before removal!`))return;const e=await z();if(e)try{const i=localStorage.getItem("access_token"),u=await(await fetch(`/api/ha/node/${e}/cluster/nodes/${l}`,{method:"DELETE",headers:{Authorization:`Bearer ${i}`}})).json();u.success?(alert(`Node ${l} removed successfully`),ke()):alert(`Error: ${u.message}`)}catch{alert("Error removing node from cluster")}},ct=async l=>{if(!confirm(`Clean leftover references for node "${l}"?`))return;const e=await z();if(e)try{const i=localStorage.getItem("access_token"),u=await(await fetch(`/api/ha/node/${e}/cluster/nodes/${l}/clean`,{method:"POST",headers:{Authorization:`Bearer ${i}`}})).json();alert(`Cleanup complete for ${l}`)}catch{alert("Error cleaning node references")}},pt=async()=>{if(!E.value||!confirm(`Add node ${E.value} to cluster?

The new node must have:
- Proxmox installed
- SSH access configured
- NOT already in a cluster`))return;const l=await z();if(l){y.value=!0;try{const e=localStorage.getItem("access_token"),s=await(await fetch(`/api/ha/node/${l}/cluster/nodes`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({new_node_ip:E.value,link0:pe.value||null,link1:ve.value||null})})).json();s.success?(alert(`Node ${E.value} added successfully!`),E.value="",pe.value="",ve.value="",ke()):alert(`Error: ${s.message}`)}catch{alert("Error adding node to cluster")}finally{y.value=!1}}},r=Ce({proxmox_api:{hosts:"",user:"root@pam",pass:"",ssl_verification:!1},proxmox_cluster:{maintenance_nodes:[],ignore_nodes:[],ignored_guests:[],overprovisioning:!0},balancing:{enable:!1,enforce_affinity:!1,enforce_pinning:!1,parallel:!1,parallel_jobs:1,live:!0,with_local_disks:!1,with_conntrack_state:!0,balance_types:["vm","ct"],max_job_validation:1800,memory_threshold:75,balanciness:5,method:"memory",mode:"used",balance_larger_guests_first:!1,node_resource_reserve:{defaults:{memory:2}}},service:{daemon:!1,log_level:"INFO",schedule:{interval:12,format:"hours"}}}),Ve=c(""),Me=c(""),me=c(2),ee=c(12),te=c("hours");Q(Ve,l=>{r.proxmox_cluster.maintenance_nodes=l.split(",").map(e=>e.trim()).filter(e=>e)}),Q(Me,l=>{r.proxmox_cluster.ignore_nodes=l.split(",").map(e=>e.trim()).filter(e=>e)}),Q(me,l=>{r.balancing.node_resource_reserve.defaults.memory=l}),Q([ee,te],()=>{r.service.schedule={interval:ee.value,format:te.value}});const Pe=l=>{const e=r.balancing.balance_types.indexOf(l);e>=0?r.balancing.balance_types.splice(e,1):r.balancing.balance_types.push(l)},U=c([]),Ee=(l,e)=>{const i=l==="maintenance"?r.proxmox_cluster.maintenance_nodes:r.proxmox_cluster.ignore_nodes,s=i.indexOf(e);s>=0?i.splice(s,1):i.push(e)},Te=$(()=>_e.value.filter(l=>!U.value.includes(String(l.id)))),He=$(()=>_e.value.filter(l=>U.value.includes(String(l.id)))),vt=l=>{const e=String(l.id);U.value.includes(e)||U.value.push(e)},mt=l=>{const e=String(l.id),i=U.value.indexOf(e);i>=0&&U.value.splice(i,1)},gt=$(()=>{const l=JSON.parse(JSON.stringify(r));return l.proxmox_api&&l.proxmox_api.pass&&(l.proxmox_api.pass="********"),l}),ge=async()=>{y.value=!0,B.value=null,j.value=[];try{const l=localStorage.getItem("access_token"),e=new URL("/api/load-balancer/analyze",window.location.origin);x.value&&e.searchParams.append("cluster_id",String(x.value));const i=await fetch(e.toString(),{headers:{Authorization:`Bearer ${l}`}});if(!i.ok){const u=await i.json();throw new Error(u.detail||"Analysis failed")}const s=await i.json();M.setAnalysisResult(s),D.value=s.moves||[],Ne.value=s.score_before||0,D.value.length===0?j.value.push("‚úÖ Cluster is balanced. No migrations proposed."):j.value.push(`üîç Analysis complete. Proposed ${D.value.length} migrations.`)}catch(l){console.error("Analysis error:",l),B.value=l.message}finally{y.value=!1}},Oe=async l=>{se.value=!0,B.value=null;try{const e=await we.executeBalancing(l,null,x.value||void 0);M.setAnalysisResult(e.data.data),e.data.log&&(j.value=e.data.log)}catch(e){B.value=e.response?.data?.detail||e.message}finally{se.value=!1}},Le=async()=>{try{const l=localStorage.getItem("access_token"),e=await fetch("/api/load-balancer/migrations?limit=50",{headers:{Authorization:`Bearer ${l}`}});if(e.ok){const i=await e.json();X.value=i}}catch(l){console.error(l)}},ze=()=>{xe(),W.value=ne.value,ae=setInterval(()=>{W.value--,W.value<=0&&(W.value=ne.value)},1e3),oe=setInterval(()=>{b.value==="health"&&!y.value&&ge()},ne.value*1e3)},xe=()=>{oe&&(clearInterval(oe),oe=null),ae&&(clearInterval(ae),ae=null),W.value=0};Q(ne,()=>{ye.value&&ze()}),Q(b,l=>{l!=="health"&&ye.value?xe():l==="health"&&ye.value&&ze()});const Be=async()=>{try{const e=(await we.getConfig()).data.saved||{};if(e.proxmox_api){const i=e.proxmox_api.pass;Object.assign(r.proxmox_api,e.proxmox_api),(!i||i==="********")&&(r.proxmox_api.pass="")}e.proxmox_cluster&&Object.assign(r.proxmox_cluster,e.proxmox_cluster),e.balancing&&Object.assign(r.balancing,e.balancing),e.service&&Object.assign(r.service,e.service),e.ignored_guests&&Array.isArray(e.ignored_guests)&&(U.value=e.ignored_guests),Ve.value=(r.proxmox_cluster.maintenance_nodes||[]).join(", "),Me.value=(r.proxmox_cluster.ignore_nodes||[]).join(", "),me.value=r.balancing.node_resource_reserve?.defaults?.memory||2,ee.value=r.service.schedule?.interval||12,te.value=r.service.schedule?.format||"hours",Qe.value=JSON.stringify(e,null,2)}catch(l){console.error(l)}},De=async()=>{try{const l={proxmox_api:{...r.proxmox_api},proxmox_cluster:{...r.proxmox_cluster},balancing:{...r.balancing},service:{...r.service},ignored_guests:U.value};typeof l.proxmox_api.hosts=="string"&&(l.proxmox_api.hosts=l.proxmox_api.hosts.split(",").map(e=>e.trim()).filter(e=>e)),l.proxmox_api.pass===""&&delete l.proxmox_api.pass,await we.updateConfig(l),alert("Configurazione salvata!")}catch(l){alert("Errore nel salvataggio della configurazione"),console.error(l)}},bt=l=>(l*100).toFixed(1)+"%",je=l=>l==null||isNaN(l)?"N/A":l.toFixed(1)+"%",Fe=(l,e)=>{if(!f.value||!f.value.guests)return 0;const i=f.value.guests;let s=0;const u=e==="qemu"?"vm":"ct";for(const V in i){const P=i[V];P.node_current===l&&P.type===u&&s++}return s},be=l=>{if(!l||isNaN(l))return"N/A";const e=l/(1024*1024*1024);return e>=1?e.toFixed(1)+" GB":(l/(1024*1024)).toFixed(0)+" MB"};return $(()=>!f.value||!f.value.guests?0:Object.values(f.value.guests).filter(l=>l.type==="vm").length),$(()=>!f.value||!f.value.guests?0:Object.values(f.value.guests).filter(l=>l.type==="ct").length),ht(async()=>{await Je(),Be()}),_t(()=>{xe()}),(l,e)=>{const i=Ct("router-link");return o(),n("div",$t,[t("div",It,[e[46]||(e[46]=t("div",null,[t("h1",{class:"page-title"},"‚öñÔ∏è Cluster Load Balancer"),t("p",{class:"page-subtitle"},"Powered by ProxLB")],-1)),t("div",Rt,[k.value.length>0?(o(),n("div",Gt,[t("select",{value:x.value,onChange:e[0]||(e[0]=s=>qe(Number(s.target.value))),class:"form-select text-sm",style:{"min-width":"200px"}},[(o(!0),n(h,null,_(k.value,s=>(o(),n("option",{key:s.id,value:s.id},a(s.name)+" "+a(s.is_default?"(Default)":""),9,Vt))),128))],40,Ut)])):p("",!0),b.value==="config"?(o(),n("button",{key:1,class:"btn btn-secondary",onClick:Be},"‚ùå Reset")):p("",!0),b.value==="config"?(o(),n("button",{key:2,class:"btn btn-primary",onClick:De},"üíæ Save Config")):p("",!0)])]),t("div",Mt,[t("button",{class:g(["tab-btn",{active:b.value==="analysis"}]),onClick:e[1]||(e[1]=s=>b.value="analysis")}," üìä Analysis & Run ",2),t("button",{class:g(["tab-btn",{active:b.value==="history"}]),onClick:e[2]||(e[2]=s=>{b.value="history",Le()})}," üìú History ",2),t("button",{class:g(["tab-btn",{active:b.value==="guests"}]),onClick:e[3]||(e[3]=s=>b.value="guests")}," üß† VM/CT Manager ",2),t("button",{class:g(["tab-btn",{active:b.value==="config"}]),onClick:e[4]||(e[4]=s=>b.value="config")}," ‚öôÔ∏è Configuration ",2)]),t("div",Pt,[b.value==="analysis"?(o(),n("div",Et,[t("div",Tt,[t("button",{class:"btn btn-primary btn-lg",onClick:ge,disabled:y.value},[y.value?(o(),n("span",Ot)):p("",!0),v(" "+a(y.value?"Analyzing...":"üîç Analyze Cluster"),1)],8,Ht),m(f)?(o(),n("div",Lt,[t("div",zt,[t("span",null,[e[47]||(e[47]=v("Score: ",-1)),t("strong",null,a(Ne.value),1),e[48]||(e[48]=v(" (Lower is better)",-1))])]),t("button",{class:"btn btn-success btn-lg",onClick:e[5]||(e[5]=s=>Oe(!0)),disabled:se.value}," üß™ Dry Run ",8,Bt),t("button",{class:"btn btn-danger btn-lg",onClick:e[6]||(e[6]=s=>Oe(!1)),disabled:se.value}," üöÄ Execute Balancing ",8,Dt)])):p("",!0)]),B.value?(o(),n("div",jt,a(B.value),1)):p("",!0),j.value.length>0?(o(),n("div",Ft,[e[49]||(e[49]=t("h3",null,"Execution Log",-1)),t("div",Jt,[(o(!0),n(h,null,_(j.value,(s,u)=>(o(),n("div",{key:u},a(s),1))),128))])])):p("",!0),m(f)?(o(),n("div",qt,[t("div",Qt,[e[51]||(e[51]=t("h3",null,"Current Metrics",-1)),t("table",Wt,[e[50]||(e[50]=t("thead",null,[t("tr",null,[t("th",null,"Node"),t("th",null,"CPU Usage"),t("th",null,"Mem Usage"),t("th",null,"VMs"),t("th",null,"CTs")])],-1)),t("tbody",null,[(o(!0),n(h,null,_(m(f).nodes,(s,u)=>(o(),n("tr",{key:u},[t("td",null,a(u),1),t("td",null,a(je(s.cpu_used_percent)),1),t("td",null,a(je(s.memory_used_percent)),1),t("td",null,a(Fe(u,"qemu")),1),t("td",null,a(Fe(u,"lxc")),1)]))),128))])])]),t("div",Yt,[e[53]||(e[53]=t("h3",null,"Proposed Migrations",-1)),D.value&&D.value.length>0?(o(),n("div",Kt,[t("table",Xt,[e[52]||(e[52]=t("thead",null,[t("tr",null,[t("th",null,"Guest"),t("th",null,"Source"),t("th",null,"Target"),t("th",null,"Reason")])],-1)),t("tbody",null,[(o(!0),n(h,null,_(D.value,(s,u)=>(o(),n("tr",{key:u},[t("td",null,a(s.guest),1),t("td",null,a(s.source),1),t("td",null,a(s.target),1),t("td",null,a(s.reason),1)]))),128))])])])):(o(),n("div",Zt," ‚úÖ Cluster is balanced. No migrations needed. "))])])):p("",!0)])):p("",!0),b.value==="history"?(o(),n("div",es,[t("div",ts,[t("button",{class:"btn btn-primary",onClick:Le,disabled:ie.value},[ie.value?(o(),n("span",ls)):p("",!0),v(" "+a(ie.value?"Loading...":"üîÑ Refresh"),1)],8,ss),m(X).length>0?(o(),n("span",ns,a(m(X).length)+" migrations ",1)):p("",!0)]),m(X).length===0&&!ie.value?(o(),n("div",os,[...e[54]||(e[54]=[t("p",null,"üìú No migration history yet. Migrations performed via ProxLB will appear here.",-1)])])):(o(),n("div",as,[t("table",is,[e[55]||(e[55]=t("thead",null,[t("tr",null,[t("th",null,"Date"),t("th",null,"Guest"),t("th",null,"From"),t("th",null,"To"),t("th",null,"Reason"),t("th",null,"Status")])],-1)),t("tbody",null,[(o(!0),n(h,null,_(m(X),s=>(o(),n("tr",{key:s.id,class:g("status-"+s.status)},[t("td",rs,a(We(s.proposed_at)),1),t("td",null,[t("span",{class:g(["guest-badge",s.guest_type])},a(s.guest_type),3),v(" "+a(s.guest_name||s.guest_id),1)]),t("td",null,a(s.source_node),1),t("td",null,a(s.target_node),1),t("td",us,a(s.reason||"-"),1),t("td",null,[t("span",{class:g(["status-badge",s.status])},a(Ye(s.status))+" "+a(s.status),3)])],2))),128))])])]))])):p("",!0),b.value==="guests"?(o(),n("div",ds,[t("div",cs,[t("button",{class:"btn btn-primary",onClick:ge,disabled:y.value},[y.value?(o(),n("span",vs)):p("",!0),v(" "+a(y.value?"Reloading...":"üîÑ Refresh List"),1)],8,ps),t("div",ms,[e[56]||(e[56]=t("span",{class:"search-icon"},"üîç",-1)),d(t("input",{type:"text","onUpdate:modelValue":e[7]||(e[7]=s=>re.value=s),placeholder:"Search guests...",class:"search-input"},null,512),[[N,re.value]])]),d(t("select",{"onUpdate:modelValue":e[8]||(e[8]=s=>ue.value=s),class:"filter-select"},[...e[57]||(e[57]=[t("option",{value:"all"},"All Types",-1),t("option",{value:"vm"},"Virtual Machines",-1),t("option",{value:"ct"},"Containers",-1)])],512),[[T,ue.value]]),d(t("select",{"onUpdate:modelValue":e[9]||(e[9]=s=>de.value=s),class:"filter-select"},[e[58]||(e[58]=t("option",{value:"all"},"All Nodes",-1)),(o(!0),n(h,null,_(Y.value,s=>(o(),n("option",{key:s,value:s},a(s),9,gs))),128))],512),[[T,de.value]])]),C.value.length>0?(o(),n("div",bs,[t("span",fs,a(C.value.length)+" selected",1),t("div",ys,[t("button",{class:"btn btn-warning btn-sm",onClick:e[10]||(e[10]=s=>$e(!0))}," üö´ Ignore Selected "),t("button",{class:"btn btn-success btn-sm",onClick:e[11]||(e[11]=s=>$e(!1))}," ‚úÖ Include Selected "),t("button",{class:"btn btn-secondary btn-sm",onClick:Xe}," üîì Unlock Selected ")]),t("button",{class:"btn-text",onClick:e[12]||(e[12]=s=>C.value=[])},"Clear Selection")])):p("",!0),t("div",hs,[t("table",_s,[t("thead",null,[t("tr",null,[t("th",ks,[t("input",{type:"checkbox",checked:Ae.value,onChange:Ke},null,40,xs)]),e[59]||(e[59]=t("th",null,"Status",-1)),e[60]||(e[60]=t("th",null,"ID",-1)),e[61]||(e[61]=t("th",null,"Name",-1)),e[62]||(e[62]=t("th",null,"Type",-1)),e[63]||(e[63]=t("th",null,"Node",-1)),e[64]||(e[64]=t("th",null,"CPU",-1)),e[65]||(e[65]=t("th",null,"RAM",-1)),e[66]||(e[66]=t("th",null,"Disk",-1)),e[67]||(e[67]=t("th",null,"Ignored",-1))])]),t("tbody",null,[(o(!0),n(h,null,_(K.value,s=>(o(),n("tr",{key:s.id,class:g({"row-ignored":Se(s.id)})},[t("td",Cs,[d(t("input",{type:"checkbox","onUpdate:modelValue":e[13]||(e[13]=u=>C.value=u),value:s.id},null,8,ws),[[I,C.value]])]),t("td",null,[t("span",{class:g(["status-dot",s.status])},null,2)]),t("td",Ns,a(s.id),1),t("td",As,a(s.name||"-"),1),t("td",null,[t("span",{class:g(["guest-badge",s.type])},a(s.type),3)]),t("td",null,a(s.node_current),1),t("td",Ss,[t("div",$s,[t("span",null,a(bt(s.cpu_used||0)),1),t("span",Is,a(s.cpu_total)+" C",1)])]),t("td",Rs,[t("div",Gs,[t("span",null,a(be(s.memory_used||0)),1),t("span",Us,"/ "+a(be(s.memory_total||0)),1)])]),t("td",Vs,[t("div",Ms,[t("span",null,a(be(s.disk_used||0)),1),t("span",Ps,"/ "+a(be(s.disk_total||0)),1)])]),t("td",null,[Se(s.id)?(o(),n("span",Es,"IGNORED")):(o(),n("span",Ts,"-"))])],2))),128)),K.value.length===0?(o(),n("tr",Hs,[...e[68]||(e[68]=[t("td",{colspan:"9",class:"text-center py-4"}," No guests found matching filters. ",-1)])])):p("",!0)])])])])):p("",!0),b.value==="ha"?(o(),n("div",Os,[t("div",Ls,[e[69]||(e[69]=t("h3",null,"üõ°Ô∏è High Availability Manager",-1)),t("button",{class:"btn btn-sm btn-primary",onClick:Z,disabled:y.value}," üîÑ Refresh ",8,zs)]),O.value?(o(),n("div",Bs,[...e[70]||(e[70]=[t("span",{class:"spinner-sm"},null,-1),v(" Loading HA data... ",-1)])])):p("",!0),t("div",Ds,[e[73]||(e[73]=t("h4",null,"HA Managed Resources",-1)),t("table",js,[e[72]||(e[72]=t("thead",null,[t("tr",null,[t("th",null,"SID"),t("th",null,"Type"),t("th",null,"State"),t("th",null,"Group"),t("th",null,"Max Restart"),t("th",null,"Max Relocate"),t("th",null,"Actions")])],-1)),t("tbody",null,[(o(!0),n(h,null,_(m(Ie),s=>(o(),n("tr",{key:s.sid},[t("td",null,[t("strong",null,a(s.sid),1)]),t("td",null,[t("span",{class:g(s.type==="vm"?"badge-success":"badge-info")},a(s.type?.toUpperCase()),3)]),t("td",null,[t("span",{class:g(et(s.state))},a(s.state),3)]),t("td",null,a(s.group||"-"),1),t("td",null,a(s.max_restart||1),1),t("td",null,a(s.max_relocate||1),1),t("td",null,[t("button",{class:"btn btn-xs btn-danger",onClick:u=>tt(s)}," ‚ùå Remove ",8,Fs)])]))),128)),m(Ie).length===0?(o(),n("tr",Js,[...e[71]||(e[71]=[t("td",{colspan:"7",class:"text-center py-4"}," No HA resources configured. Use the form below to add resources. ",-1)])])):p("",!0)])])]),t("div",qs,[t("div",Qs,[e[74]||(e[74]=t("h4",null,"üìã Available Guests",-1)),t("span",Ws,a(m(H).length)+" VMs/CTs",1)]),e[87]||(e[87]=t("p",{class:"help-text"},"Select VMs/CTs to add to High Availability",-1)),m(H).length>0?(o(),n("table",Ys,[t("thead",null,[t("tr",null,[t("th",Ks,[t("input",{type:"checkbox",onChange:nt,checked:Ge.value},null,40,Xs)]),e[75]||(e[75]=t("th",null,"VMID",-1)),e[76]||(e[76]=t("th",null,"Name",-1)),e[77]||(e[77]=t("th",null,"Type",-1)),e[78]||(e[78]=t("th",null,"Node",-1)),e[79]||(e[79]=t("th",null,"Status",-1)),e[80]||(e[80]=t("th",null,"HA Status",-1))])]),t("tbody",null,[(o(!0),n(h,null,_(m(H),s=>(o(),n("tr",{key:s.vmid,class:g({"row-selected":w.value.includes(s.vmid),"row-in-ha":s.in_ha})},[t("td",null,[t("input",{type:"checkbox",checked:w.value.includes(s.vmid),onChange:u=>lt(s.vmid),disabled:s.in_ha},null,40,Zs)]),t("td",null,[t("strong",null,a(s.vmid),1)]),t("td",null,a(s.name),1),t("td",null,[t("span",{class:g(s.type==="vm"?"badge-success":"badge-info")},a(s.type?.toUpperCase()),3)]),t("td",null,a(s.node),1),t("td",null,[t("span",{class:g(s.status==="running"?"badge-success":"badge-warning")},a(s.status),3)]),t("td",null,[s.in_ha?(o(),n("span",el,"‚úÖ In HA")):(o(),n("span",tl,"Not in HA"))])],2))),128))])])):(o(),n("p",sl,"No VMs/CTs found in cluster.")),w.value.length>0?(o(),n("div",ll,[t("h5",null,"Add "+a(w.value.length)+" selected guest(s) to HA",1),t("div",nl,[t("div",ol,[e[82]||(e[82]=t("label",null,"HA Group",-1)),d(t("select",{"onUpdate:modelValue":e[14]||(e[14]=s=>A.group=s),class:"form-input"},[e[81]||(e[81]=t("option",{value:""},"-- No Group --",-1)),(o(!0),n(h,null,_(m(he),s=>(o(),n("option",{key:s.group,value:s.group},a(s.group),9,al))),128))],512),[[T,A.group]])]),t("div",il,[e[84]||(e[84]=t("label",null,"State",-1)),d(t("select",{"onUpdate:modelValue":e[15]||(e[15]=s=>A.state=s),class:"form-input"},[...e[83]||(e[83]=[t("option",{value:"started"},"Started",-1),t("option",{value:"stopped"},"Stopped",-1),t("option",{value:"disabled"},"Disabled",-1)])],512),[[T,A.state]])]),t("div",rl,[e[85]||(e[85]=t("label",null,"Max Restart",-1)),d(t("input",{type:"number","onUpdate:modelValue":e[16]||(e[16]=s=>A.max_restart=s),class:"form-input",min:"0",max:"10"},null,512),[[N,A.max_restart,void 0,{number:!0}]])]),t("div",ul,[e[86]||(e[86]=t("label",null,"Max Relocate",-1)),d(t("input",{type:"number","onUpdate:modelValue":e[17]||(e[17]=s=>A.max_relocate=s),class:"form-input",min:"0",max:"10"},null,512),[[N,A.max_relocate,void 0,{number:!0}]])])]),t("button",{class:"btn btn-primary mt-2",onClick:ot,disabled:O.value}," ‚ûï Add "+a(w.value.length)+" Guest(s) to HA ",9,dl)])):p("",!0)]),t("div",cl,[e[90]||(e[90]=t("h4",null,"HA Groups",-1)),t("table",pl,[e[89]||(e[89]=t("thead",null,[t("tr",null,[t("th",null,"Group Name"),t("th",null,"Nodes"),t("th",null,"Restricted"),t("th",null,"No Failback"),t("th",null,"Actions")])],-1)),t("tbody",null,[(o(!0),n(h,null,_(m(he),s=>(o(),n("tr",{key:s.group},[t("td",null,[t("strong",null,a(s.group),1)]),t("td",null,a(s.nodes),1),t("td",null,a(s.restricted?"‚úÖ":"‚ùå"),1),t("td",null,a(s.nofailback?"‚úÖ":"‚ùå"),1),t("td",null,[t("button",{class:"btn btn-xs btn-danger",onClick:u=>st(s.group)}," üóëÔ∏è Delete ",8,vl)])]))),128)),m(he).length===0?(o(),n("tr",ml,[...e[88]||(e[88]=[t("td",{colspan:"5",class:"text-center py-4"}," No HA groups configured. Create one below. ",-1)])])):p("",!0)])])]),t("div",gl,[e[96]||(e[96]=t("h4",null,"‚ûï Create HA Group",-1)),t("div",bl,[t("div",fl,[e[91]||(e[91]=t("label",null,"Group Name",-1)),d(t("input",{type:"text","onUpdate:modelValue":e[18]||(e[18]=s=>S.name=s),class:"form-input",placeholder:"e.g. primary-group"},null,512),[[N,S.name]])]),t("div",yl,[t("label",null,[d(t("input",{type:"checkbox","onUpdate:modelValue":e[19]||(e[19]=s=>S.restricted=s)},null,512),[[I,S.restricted]]),e[92]||(e[92]=v(" Restricted (only run on selected nodes)",-1))])]),t("div",hl,[t("label",null,[d(t("input",{type:"checkbox","onUpdate:modelValue":e[20]||(e[20]=s=>S.nofailback=s)},null,512),[[I,S.nofailback]]),e[93]||(e[93]=v(" No Failback (don't auto-migrate back)",-1))])])]),t("div",_l,[e[94]||(e[94]=t("label",null,[t("strong",null,"Select Nodes for Group")],-1)),e[95]||(e[95]=t("p",{class:"help-text"},"Check the nodes to include and set priority (higher = preferred)",-1)),m(ce).length>0?(o(),n("div",kl,[(o(!0),n(h,null,_(m(ce),s=>(o(),n("div",{key:s.name,class:"node-selection-item"},[t("input",{type:"checkbox",id:"hagroup-node-"+s.name,checked:G.value.some(u=>u.name===s.name),onChange:u=>at(s.name)},null,40,xl),t("label",{for:"hagroup-node-"+s.name,class:"ml-1"},[t("strong",null,a(s.name),1),t("span",{class:g([s.status==="online"?"badge-success":"badge-danger","ml-1"])},a(s.status?.toUpperCase()),3)],8,Cl),G.value.some(u=>u.name===s.name)?(o(),n("input",{key:0,type:"number",value:it(s.name),onInput:u=>rt(s.name,u.target.value),class:"form-input priority-input ml-2",placeholder:"Priority",min:"1",max:"1000"},null,40,wl)):p("",!0)]))),128))])):(o(),n("p",Nl,"No cluster nodes available. Load cluster data first."))]),t("button",{class:"btn btn-primary mt-3",onClick:ut,disabled:!S.name||G.value.length===0||O.value}," ‚ûï Create Group with "+a(G.value.length)+" node(s) ",9,Al)])])):p("",!0),b.value==="cluster"?(o(),n("div",Sl,[t("div",$l,[e[97]||(e[97]=t("h3",null,"üñ•Ô∏è Cluster Node Management",-1)),t("button",{class:"btn btn-sm btn-primary",onClick:ke,disabled:y.value}," üîÑ Refresh ",8,Il)]),Ze.value?(o(),n("div",Rl,[...e[98]||(e[98]=[t("span",{class:"spinner-sm"},null,-1),v(" Loading cluster data... ",-1)])])):p("",!0),m(F)?(o(),n("div",Gl,[e[103]||(e[103]=t("h4",null,"Cluster Status",-1)),t("div",Ul,[t("div",Vl,[e[99]||(e[99]=t("span",{class:"label"},"Cluster Name:",-1)),t("strong",null,a(m(F).cluster_name||"N/A"),1)]),t("div",Ml,[e[100]||(e[100]=t("span",{class:"label"},"Quorum:",-1)),t("span",{class:g(m(F).quorum?"badge-success":"badge-danger")},a(m(F).quorum?"‚úÖ YES":"‚ùå NO"),3)]),t("div",Pl,[e[101]||(e[101]=t("span",{class:"label"},"Expected Votes:",-1)),t("strong",null,a(m(F).expected_votes||0),1)]),t("div",El,[e[102]||(e[102]=t("span",{class:"label"},"Total Votes:",-1)),t("strong",null,a(m(F).total_votes||0),1)])])])):p("",!0),t("div",Tl,[e[106]||(e[106]=t("h4",null,"Cluster Nodes",-1)),t("table",Hl,[e[105]||(e[105]=t("thead",null,[t("tr",null,[t("th",null,"Node ID"),t("th",null,"Name"),t("th",null,"Votes"),t("th",null,"Status"),t("th",null,"Actions")])],-1)),t("tbody",null,[(o(!0),n(h,null,_(m(ce),s=>(o(),n("tr",{key:s.node_id},[t("td",null,a(s.node_id),1),t("td",null,[t("strong",null,a(s.name),1),s.is_local?(o(),n("span",Ol,"LOCAL")):p("",!0)]),t("td",null,a(s.votes),1),t("td",null,[t("span",{class:g(s.status==="online"?"badge-success":"badge-danger")},a(s.status?.toUpperCase()),3)]),t("td",null,[t("button",{class:"btn btn-xs btn-warning",onClick:u=>ct(s.name),title:"Clean leftover references"}," üßπ Clean ",8,Ll),t("button",{class:"btn btn-xs btn-danger",onClick:u=>dt(s.name),disabled:s.is_local,title:"Remove node from cluster (must be offline)"}," ‚ùå Remove ",8,zl)])]))),128)),m(ce).length===0?(o(),n("tr",Bl,[...e[104]||(e[104]=[t("td",{colspan:"5",class:"text-center py-4"}," No cluster nodes found or not in a cluster. ",-1)])])):p("",!0)])])]),t("div",Dl,[e[110]||(e[110]=t("h4",null,"‚ûï Add New Node",-1)),t("div",jl,[t("div",Fl,[e[107]||(e[107]=t("label",null,"New Node IP",-1)),d(t("input",{type:"text","onUpdate:modelValue":e[21]||(e[21]=s=>E.value=s),class:"form-input",placeholder:"192.168.1.100"},null,512),[[N,E.value]])]),t("div",Jl,[e[108]||(e[108]=t("label",null,"Link0 (optional)",-1)),d(t("input",{type:"text","onUpdate:modelValue":e[22]||(e[22]=s=>pe.value=s),class:"form-input",placeholder:"Primary network IP"},null,512),[[N,pe.value]])]),t("div",ql,[e[109]||(e[109]=t("label",null,"Link1 (optional)",-1)),d(t("input",{type:"text","onUpdate:modelValue":e[23]||(e[23]=s=>ve.value=s),class:"form-input",placeholder:"Secondary network IP"},null,512),[[N,ve.value]])])]),t("button",{class:"btn btn-primary mt-2",onClick:pt,disabled:!E.value}," ‚ûï Add Node to Cluster ",8,Ql),e[111]||(e[111]=t("p",{class:"help-text mt-2"},"‚ö†Ô∏è The new node must have Proxmox installed and SSH access configured.",-1))])])):p("",!0),b.value==="config"?(o(),n("div",Wl,[t("div",Yl,[t("div",Kl,[e[115]||(e[115]=t("span",{class:"note-icon"},"‚öôÔ∏è",-1)),t("div",null,[e[114]||(e[114]=t("strong",null,"Cluster Connection",-1)),t("p",null,[e[113]||(e[113]=v("La connessione al cluster Proxmox √® configurata centralmente nella sezione ",-1)),kt(i,{to:"/cluster",class:"config-link"},{default:xt(()=>[...e[112]||(e[112]=[v("Cluster & HA ‚Üí Config",-1)])]),_:1})])])])]),t("div",Xl,[e[128]||(e[128]=t("h3",{class:"section-title"},"‚öñÔ∏è Parametri Bilanciamento",-1)),t("div",Zl,[t("div",en,[t("label",null,[d(t("input",{type:"checkbox","onUpdate:modelValue":e[24]||(e[24]=s=>r.balancing.enable=s)},null,512),[[I,r.balancing.enable]]),e[116]||(e[116]=v(" Abilita Bilanciamento Automatico",-1))])]),t("div",tn,[e[118]||(e[118]=t("label",null,"Metrica principale",-1)),d(t("select",{"onUpdate:modelValue":e[25]||(e[25]=s=>r.balancing.method=s),class:"form-input"},[...e[117]||(e[117]=[t("option",{value:"memory"},"Memoria",-1),t("option",{value:"cpu"},"CPU",-1),t("option",{value:"disk"},"Disco",-1)])],512),[[T,r.balancing.method]])]),t("div",sn,[e[120]||(e[120]=t("label",null,"Modalit√†",-1)),d(t("select",{"onUpdate:modelValue":e[26]||(e[26]=s=>r.balancing.mode=s),class:"form-input"},[...e[119]||(e[119]=[t("option",{value:"used"},"Risorse Usate",-1),t("option",{value:"assigned"},"Risorse Assegnate",-1),t("option",{value:"psi"},"PSI (Pressure)",-1)])],512),[[T,r.balancing.mode]])]),t("div",ln,[e[121]||(e[121]=t("label",null,"Soglia Sbilanciamento (%)",-1)),d(t("input",{type:"range","onUpdate:modelValue":e[27]||(e[27]=s=>r.balancing.balanciness=s),min:"1",max:"50",class:"slider"},null,512),[[N,r.balancing.balanciness,void 0,{number:!0}]]),t("span",nn,a(r.balancing.balanciness)+"%",1),e[122]||(e[122]=t("span",{class:"help-text"},"Differenza massima tra nodi prima di triggerare il bilanciamento",-1))]),t("div",on,[e[123]||(e[123]=t("label",null,"Soglia Memoria Critica (%)",-1)),d(t("input",{type:"range","onUpdate:modelValue":e[28]||(e[28]=s=>r.balancing.memory_threshold=s),min:"50",max:"95",class:"slider"},null,512),[[N,r.balancing.memory_threshold,void 0,{number:!0}]]),t("span",an,a(r.balancing.memory_threshold)+"%",1)]),t("div",rn,[e[126]||(e[126]=t("label",null,"Tipi Guest:",-1)),t("label",null,[t("input",{type:"checkbox",checked:r.balancing.balance_types?.includes("vm"),onChange:e[29]||(e[29]=s=>Pe("vm"))},null,40,un),e[124]||(e[124]=v(" VMs",-1))]),t("label",null,[t("input",{type:"checkbox",checked:r.balancing.balance_types?.includes("ct"),onChange:e[30]||(e[30]=s=>Pe("ct"))},null,40,dn),e[125]||(e[125]=v(" Containers",-1))])]),t("div",cn,[t("label",null,[d(t("input",{type:"checkbox","onUpdate:modelValue":e[31]||(e[31]=s=>r.balancing.balance_larger_guests_first=s)},null,512),[[I,r.balancing.balance_larger_guests_first]]),e[127]||(e[127]=v(" Migra prima guest pi√π grandi",-1))])])])]),t("div",pn,[e[136]||(e[136]=t("h3",{class:"section-title"},"üîÑ Opzioni Migrazione",-1)),t("div",vn,[t("div",mn,[t("label",null,[d(t("input",{type:"checkbox","onUpdate:modelValue":e[32]||(e[32]=s=>r.balancing.live=s)},null,512),[[I,r.balancing.live]]),e[129]||(e[129]=v(" Migrazione Live (senza downtime)",-1))])]),t("div",gn,[t("label",null,[d(t("input",{type:"checkbox","onUpdate:modelValue":e[33]||(e[33]=s=>r.balancing.with_local_disks=s)},null,512),[[I,r.balancing.with_local_disks]]),e[130]||(e[130]=v(" Migra guest con dischi locali",-1))]),e[131]||(e[131]=t("span",{class:"help-text"},"Richiede storage condiviso",-1))]),t("div",bn,[t("label",null,[d(t("input",{type:"checkbox","onUpdate:modelValue":e[34]||(e[34]=s=>r.balancing.with_conntrack_state=s)},null,512),[[I,r.balancing.with_conntrack_state]]),e[132]||(e[132]=v(" Conserva stato connessioni (conntrack)",-1))])]),t("div",fn,[t("label",null,[d(t("input",{type:"checkbox","onUpdate:modelValue":e[35]||(e[35]=s=>r.balancing.parallel=s)},null,512),[[I,r.balancing.parallel]]),e[133]||(e[133]=v(" Migrazioni parallele",-1))])]),r.balancing.parallel?(o(),n("div",yn,[e[134]||(e[134]=t("label",null,"Numero Job Paralleli",-1)),d(t("input",{type:"number","onUpdate:modelValue":e[36]||(e[36]=s=>r.balancing.parallel_jobs=s),class:"form-input",min:"1",max:"10"},null,512),[[N,r.balancing.parallel_jobs,void 0,{number:!0}]])])):p("",!0),t("div",hn,[e[135]||(e[135]=t("label",null,"Timeout Validazione (sec)",-1)),d(t("input",{type:"number","onUpdate:modelValue":e[37]||(e[37]=s=>r.balancing.max_job_validation=s),class:"form-input",min:"60",max:"7200"},null,512),[[N,r.balancing.max_job_validation,void 0,{number:!0}]])])])]),t("div",_n,[e[139]||(e[139]=t("h3",{class:"section-title"},"üîó Regole Affinit√† e Pinning",-1)),t("div",kn,[t("div",xn,[t("label",null,[d(t("input",{type:"checkbox","onUpdate:modelValue":e[38]||(e[38]=s=>r.balancing.enforce_affinity=s)},null,512),[[I,r.balancing.enforce_affinity]]),e[137]||(e[137]=v(" Forza regole di affinit√†",-1))])]),t("div",Cn,[t("label",null,[d(t("input",{type:"checkbox","onUpdate:modelValue":e[39]||(e[39]=s=>r.balancing.enforce_pinning=s)},null,512),[[I,r.balancing.enforce_pinning]]),e[138]||(e[138]=v(" Forza pinning a nodi specifici",-1))])])]),e[140]||(e[140]=wt('<div class="info-box" data-v-7b94f60b><strong data-v-7b94f60b>‚ÑπÔ∏è Tag supportati sui Guest (in Proxmox):</strong><ul data-v-7b94f60b><li data-v-7b94f60b><code data-v-7b94f60b>plb_affinity_&lt;nome&gt;</code> ‚Äî Raggruppa guest sullo stesso nodo</li><li data-v-7b94f60b><code data-v-7b94f60b>plb_anti_affinity_&lt;nome&gt;</code> ‚Äî Separa guest su nodi diversi</li><li data-v-7b94f60b><code data-v-7b94f60b>plb_pin_&lt;nodo&gt;</code> ‚Äî Fissa guest su un nodo specifico</li><li data-v-7b94f60b><code data-v-7b94f60b>plb_ignore</code> ‚Äî Ignora guest dal bilanciamento</li></ul></div>',1))]),t("div",wn,[e[146]||(e[146]=t("h3",{class:"section-title"},"üñ•Ô∏è Gestione Nodi",-1)),t("div",Nn,[e[141]||(e[141]=t("h4",null,"Nodi in Manutenzione",-1)),e[142]||(e[142]=t("p",{class:"help-text"},"I guest verranno evacuati da questi nodi",-1)),Y.value.length>0?(o(),n("div",An,[(o(!0),n(h,null,_(Y.value,s=>(o(),n("label",{key:"maint-"+s,class:"checkbox-item"},[t("input",{type:"checkbox",checked:r.proxmox_cluster.maintenance_nodes.includes(s),onChange:u=>Ee("maintenance",s)},null,40,Sn),t("span",$n,a(s),1)]))),128))])):(o(),n("div",In,'Esegui "Analyze Cluster" per caricare la lista nodi'))]),t("div",Rn,[e[143]||(e[143]=t("h4",null,"Nodi da Ignorare",-1)),e[144]||(e[144]=t("p",{class:"help-text"},"Questi nodi non parteciperanno al bilanciamento",-1)),Y.value.length>0?(o(),n("div",Gn,[(o(!0),n(h,null,_(Y.value,s=>(o(),n("label",{key:"ignore-"+s,class:"checkbox-item"},[t("input",{type:"checkbox",checked:r.proxmox_cluster.ignore_nodes.includes(s),onChange:u=>Ee("ignore",s)},null,40,Un),t("span",Vn,a(s),1)]))),128))])):(o(),n("div",Mn,'Esegui "Analyze Cluster" per caricare la lista nodi'))]),t("div",Pn,[e[145]||(e[145]=t("label",null,"Riserva Memoria Default (GB)",-1)),d(t("input",{type:"number","onUpdate:modelValue":e[40]||(e[40]=s=>me.value=s),class:"form-input",min:"0",max:"64",style:{"max-width":"120px"}},null,512),[[N,me.value,void 0,{number:!0}]])])]),t("div",En,[e[151]||(e[151]=t("h3",{class:"section-title"},"üñ•Ô∏è Gestione Guest (VM/CT)",-1)),t("div",Tn,[t("div",Hn,[e[147]||(e[147]=t("h4",null,"‚úÖ Guest Migrabili",-1)),e[148]||(e[148]=t("p",{class:"help-text"},"Questi guest possono essere spostati tra i nodi",-1)),Te.value.length>0?(o(),n("div",On,[(o(!0),n(h,null,_(Te.value,s=>(o(),n("div",{key:"mig-"+s.id,class:"guest-item"},[t("span",{class:g(["guest-type",s.type])},a(s.type.toUpperCase()),3),t("span",Ln,a(s.name||s.id),1),t("span",zn,"@ "+a(s.node_current),1),t("button",{class:"btn-sm btn-danger",onClick:u=>vt(s),title:"Blocca migrazione"}," üö´ ",8,Bn)]))),128))])):(o(),n("div",Dn,"Nessun guest migrabile trovato"))]),t("div",jn,[e[149]||(e[149]=t("h4",null,"üîí Guest NON Migrabili",-1)),e[150]||(e[150]=t("p",{class:"help-text"},"Questi guest sono esclusi dal bilanciamento",-1)),He.value.length>0?(o(),n("div",Fn,[(o(!0),n(h,null,_(He.value,s=>(o(),n("div",{key:"ign-"+s.id,class:"guest-item ignored"},[t("span",{class:g(["guest-type",s.type])},a(s.type.toUpperCase()),3),t("span",Jn,a(s.name||s.id),1),t("span",qn,"@ "+a(s.node_current),1),t("button",{class:"btn-sm btn-success",onClick:u=>mt(s),title:"Consenti migrazione"}," ‚úÖ ",8,Qn)]))),128))])):(o(),n("div",Wn,"Nessun guest escluso"))])]),e[152]||(e[152]=t("div",{class:"info-box",style:{"margin-top":"16px"}},[t("strong",null,"üí° Suggerimento:"),v(" I guest con tag "),t("code",null,"plb_ignore"),v(" in Proxmox verranno automaticamente esclusi. Qui puoi aggiungere esclusioni aggiuntive senza modificare i tag su Proxmox. ")],-1))]),t("div",Yn,[e[158]||(e[158]=t("h3",{class:"section-title"},"‚è∞ Schedulazione Automatica",-1)),t("div",Kn,[t("div",Xn,[t("label",null,[d(t("input",{type:"checkbox","onUpdate:modelValue":e[41]||(e[41]=s=>r.service.daemon=s)},null,512),[[I,r.service.daemon]]),e[153]||(e[153]=v(" Esegui come Daemon",-1))])]),r.service.daemon?(o(),n("div",Zn,[e[155]||(e[155]=t("label",null,"Intervallo",-1)),t("div",eo,[d(t("input",{type:"number","onUpdate:modelValue":e[42]||(e[42]=s=>ee.value=s),class:"form-input small",min:"1"},null,512),[[N,ee.value,void 0,{number:!0}]]),d(t("select",{"onUpdate:modelValue":e[43]||(e[43]=s=>te.value=s),class:"form-input small"},[...e[154]||(e[154]=[t("option",{value:"hours"},"Ore",-1),t("option",{value:"minutes"},"Minuti",-1)])],512),[[T,te.value]])])])):p("",!0),t("div",to,[e[157]||(e[157]=t("label",null,"Log Level",-1)),d(t("select",{"onUpdate:modelValue":e[44]||(e[44]=s=>r.service.log_level=s),class:"form-input"},[...e[156]||(e[156]=[t("option",{value:"DEBUG"},"DEBUG",-1),t("option",{value:"INFO"},"INFO",-1),t("option",{value:"WARNING"},"WARNING",-1),t("option",{value:"ERROR"},"ERROR",-1)])],512),[[T,r.service.log_level]])])])]),t("div",so,[t("h3",{class:"section-title collapsible",onClick:e[45]||(e[45]=s=>le.value=!le.value)},a(le.value?"‚ñº":"‚ñ∂")+" Anteprima JSON ",1),le.value?(o(),n("div",lo,[t("pre",null,a(JSON.stringify(gt.value,null,2)),1)])):p("",!0)])])):p("",!0)])])}}}),io=At(no,[["__scopeId","data-v-7b94f60b"]]);export{io as default};
