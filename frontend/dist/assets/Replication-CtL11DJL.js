import{d as M,r as b,o as D,c as a,w as q,a as e,t as i,F as E,b as N,n as U,e as k,l as W,f as n,_ as R,s as B,g as z,h as Z,i as H,j as L,k as S,m as y,v as J,p as A,q as w,u as O,R as K}from"./index-CYXbFCAl.js";const Q={class:"modal-card log-modal"},X={class:"modal-header"},Y={class:"modal-body"},j={key:0,class:"loading-state"},ee={key:1,class:"empty-state"},te={key:2,class:"log-list"},se=["onClick"],oe={class:"log-status-icon"},le={key:0},ne={key:1},ae={key:2},ie={class:"log-info"},de={class:"log-time"},re={key:0,class:"log-duration"},ue={class:"log-message"},ce={class:"log-expand-icon"},ve={key:0,class:"log-details"},_e={key:0,class:"log-section error"},me={key:1,class:"log-section output"},pe={class:"log-meta"},be=M({__name:"JobLogViewer",props:{jobId:{},jobName:{},jobType:{}},emits:["close"],setup($,{emit:x}){const g=$,p=b([]),f=b(!0),v=b([]),c=async()=>{f.value=!0;try{const s=await W.getLogs({job_id:g.jobId,job_type:g.jobType});p.value=s.data,p.value.length>0&&p.value[0].status==="failed"&&v.value.push(p.value[0].id)}catch(s){console.error("Error loading logs",s)}finally{f.value=!1}},d=s=>{const _=v.value.indexOf(s);_===-1?v.value.push(s):v.value.splice(_,1)},C=s=>new Date(s).toLocaleString(),h=s=>s<60?`${s}s`:`${(s/60).toFixed(1)}m`;return D(c),(s,_)=>(n(),a("div",{class:"modal-overlay",onClick:_[1]||(_[1]=q(o=>s.$emit("close"),["self"]))},[e("div",Q,[e("div",X,[e("h2",null,"Job Logs: "+i($.jobName),1),e("button",{class:"close-btn",onClick:_[0]||(_[0]=o=>s.$emit("close"))},"Ã—")]),e("div",Y,[f.value?(n(),a("div",j,"Caricamento logs...")):p.value.length===0?(n(),a("div",ee,"Nessun log trovato per questo job.")):(n(),a("div",te,[(n(!0),a(E,null,N(p.value,o=>(n(),a("div",{key:o.id,class:U(["log-entry",o.status])},[e("div",{class:"log-summary",onClick:m=>d(o.id)},[e("div",oe,[o.status==="success"?(n(),a("span",le,"âœ…")):o.status==="failed"?(n(),a("span",ne,"âŒ")):(n(),a("span",ae,"â³"))]),e("div",ie,[e("div",de,i(C(o.started_at)),1),o.duration?(n(),a("div",re,i(h(o.duration)),1)):k("",!0)]),e("div",ue,i(o.message||o.status),1),e("div",ce,i(v.value.includes(o.id)?"â–¼":"â–¶"),1)],8,se),v.value.includes(o.id)?(n(),a("div",ve,[o.error?(n(),a("div",_e,[_[2]||(_[2]=e("h4",null,"Error",-1)),e("pre",null,i(o.error),1)])):k("",!0),o.output?(n(),a("div",me,[_[3]||(_[3]=e("h4",null,"Output",-1)),e("pre",null,i(o.output),1)])):k("",!0),e("div",pe,[e("span",null,"Job Type: "+i(o.job_type),1),e("span",null,"Node: "+i(o.node_name),1),e("span",null,"Dataset: "+i(o.dataset),1),e("span",null,"Transferred: "+i(o.transferred||"N/A"),1)])])):k("",!0)],2))),128))]))])])]))}}),G=R(be,[["__scopeId","data-v-a53140c2"]]),fe={class:"table-container"},ye={class:"data-table"},ge={class:"text-xs text-secondary"},ke={class:"text-sm"},he={key:0},$e={class:"badge badge-info"},xe={key:1,class:"text-secondary"},Ce={key:0},Se={key:1,class:"text-secondary"},Je={class:"text-sm"},Ve={key:0},we={key:1,class:"text-secondary"},ze={class:"btn-group"},Ee=["onClick","disabled"],Me=["onClick"],De=["onClick"],Re=["onClick"],Ne={key:0},Ue=M({__name:"SyncoidJobs",emits:["edit"],setup($,{expose:x,emit:g}){const p=b([]),f=b(!1),v=b(null);D(()=>{c()});const c=async()=>{f.value=!0;try{const o=await B.getJobs();p.value=o.data}catch(o){console.error("Error loading jobs",o)}finally{f.value=!1}},d=async o=>{if(confirm(`Avviare job ${o.job_name}?`))try{await B.runJob(o.id),c()}catch{alert("Errore avvio job")}},C=async o=>{if(confirm(`Eliminare job ${o.job_name}? Irreversibile.`))try{await B.deleteJob(o.id),c()}catch{alert("Errore eliminazione job")}},h=o=>new Date(o).toLocaleString(),s=o=>o<60?o+"s":(o/60).toFixed(1)+"m",_=o=>o==="success"?"badge-success":o==="error"||o==="failed"?"badge-danger":o==="running"?"badge-warning":"badge-secondary";return x({loadJobs:c}),(o,m)=>(n(),a(E,null,[e("div",fe,[e("table",ye,[m[3]||(m[3]=e("thead",null,[e("tr",null,[e("th",null,"Nome Job"),e("th",null,"Sorgente â†’ Destinazione"),e("th",null,"VM"),e("th",null,"Schedule"),e("th",null,"Ultimo Run"),e("th",null,"Stato"),e("th",null,"Azioni")])],-1)),e("tbody",null,[(n(!0),a(E,null,N(p.value,u=>(n(),a("tr",{key:u.id},[e("td",null,[e("strong",null,i(u.job_name),1),e("div",ge,i(u.id),1)]),e("td",ke,[e("div",null,i(u.source_node_name)+" : "+i(u.source_dataset),1),m[1]||(m[1]=e("div",{style:{"text-align":"center",color:"var(--text-secondary)"}},"â†“",-1)),e("div",null,i(u.dest_node_name)+" : "+i(u.dest_dataset),1)]),e("td",null,[u.vm_id?(n(),a("div",he,[e("span",$e,i(u.vm_name||"VM")+" ("+i(u.vm_id)+")",1)])):(n(),a("span",xe,"-"))]),e("td",null,[u.schedule?(n(),a("code",Ce,i(u.schedule),1)):(n(),a("span",Se,"Manuale"))]),e("td",Je,[u.last_run?(n(),a("div",Ve,i(h(u.last_run)),1)):k("",!0),u.last_duration_seconds?(n(),a("div",we,i(s(u.last_duration_seconds)),1)):k("",!0)]),e("td",null,[e("span",{class:U(["badge",_(u.last_status)])},i(u.last_status||"Never"),3)]),e("td",null,[e("div",ze,[e("button",{class:"btn btn-primary btn-xs",onClick:V=>d(u),disabled:u.last_status==="running"}," â–¶ï¸ Run ",8,Ee),e("button",{class:"btn btn-secondary btn-xs",onClick:V=>v.value=u},"ðŸ“œ Logs",8,Me),e("button",{class:"btn btn-secondary btn-xs",onClick:V=>o.$emit("edit",u)},"âœï¸",8,De),e("button",{class:"btn btn-danger btn-xs",onClick:V=>C(u),title:"Elimina"},"ðŸ—‘ï¸",8,Re)])])]))),128)),p.value.length===0&&!f.value?(n(),a("tr",Ne,[...m[2]||(m[2]=[e("td",{colspan:"7",class:"empty-state-cell"},"Nessun job di replica configurato",-1)])])):k("",!0)])])]),v.value?(n(),z(G,{key:0,"job-id":v.value.id,"job-name":v.value.job_name,"job-type":"sync",onClose:m[0]||(m[0]=u=>v.value=null)},null,8,["job-id","job-name"])):k("",!0)],64))}}),Ie=R(Ue,[["__scopeId","data-v-4d79bfa3"]]),Pe={class:"recovery-jobs-page"},Le={key:0,class:"page-header"},Be={key:1,class:"header-actions",style:{"margin-bottom":"12px",display:"flex","justify-content":"flex-end"}},Ae=["disabled"],Fe={key:0,class:"spinner-sm"},Te={key:1},Oe={key:2,class:"page-header"},qe={style:{display:"flex","align-items":"center",gap:"12px","margin-top":"12px"}},Ze=["disabled"],Ge={key:0,class:"spinner-sm"},We={key:1},He={class:"card"},Ke={class:"table-container"},Qe={class:"data-table"},Xe={class:"text-xs text-secondary"},Ye={class:"badge badge-info"},je={class:"text-xs mt-1"},et={class:"text-sm"},tt={style:{color:"#ce93d8"}},st={key:0},ot={key:1,class:"text-secondary"},lt={key:0},nt={key:1,class:"text-secondary text-xs"},at={key:0,class:"status-with-phase"},it={class:"badge badge-running"},dt={key:1},rt={class:"btn-group"},ut=["onClick","disabled"],ct=["onClick"],vt=["onClick"],_t=["onClick"],mt={key:0},pt={class:"modal modal-lg"},bt={class:"modal-header"},ft={class:"modal-body"},yt={class:"settings-section"},gt={class:"form-row"},kt={class:"form-group flex-1"},ht=["value"],$t={class:"form-group flex-1"},xt=["value"],Ct={class:"form-row"},St={class:"form-group flex-1"},Jt=["value"],Vt={class:"form-group flex-1"},wt=["value"],zt={class:"settings-section"},Et={class:"form-group"},Mt={class:"form-row"},Dt={class:"form-group flex-1"},Rt={class:"form-group flex-1"},Nt={class:"settings-section"},Ut={class:"form-row"},It={class:"form-group flex-1"},Pt={class:"form-group flex-1"},Lt={class:"checkbox-group"},Bt={class:"settings-section"},At={class:"form-row"},Ft={class:"form-group flex-1"},Tt={class:"form-group flex-1"},Ot={class:"form-row"},qt={class:"form-group flex-1"},Zt={class:"checkbox-group"},Gt={class:"checkbox-group"},Wt={class:"checkbox-group"},Ht={class:"settings-section"},Kt={class:"form-row"},Qt={class:"form-group flex-1"},Xt={class:"form-group flex-1"},Yt={class:"checkbox-group"},jt={class:"checkbox-group"},es={class:"checkbox-group"},ts={class:"modal-footer"},ss=["disabled"],os=M({__name:"PBSJobs",props:{embedded:{type:Boolean,default:!0}},setup($,{expose:x}){const g=b([]),p=b(!1),f=b(!1),v=b(!1),c=b(!1),d=Z({}),C=b(null),h=b(null),s=r=>{C.value=r.id,Object.assign(d,{name:r.name,schedule:r.schedule,backup_mode:r.backup_mode,backup_compress:r.backup_compress,include_all_disks:r.include_all_disks,overwrite_existing:r.overwrite_existing,restore_start_vm:r.restore_start_vm,restore_unique:r.restore_unique,vm_id:r.vm_id,vm_type:r.vm_type,vm_name:r.vm_name,source_node_name:r.source_node_name,pbs_node_name:r.pbs_node_name,dest_node_name:r.dest_node_name,pbs_datastore:r.pbs_datastore,dest_vm_id:r.dest_vm_id,dest_vm_name_suffix:r.dest_vm_name_suffix,dest_storage:r.dest_storage,max_retries:r.max_retries,retry_delay_minutes:r.retry_delay_minutes,retry_on_failure:r.retry_on_failure,is_active:r.is_active,notify_on_each_run:r.notify_on_each_run}),v.value=!0},_=async()=>{if(C.value){c.value=!0;try{await L.updateJob(C.value,d),v.value=!1,m()}catch(r){alert("Errore salvataggio modifiche"),console.error(r)}finally{c.value=!1}}};let o=null;D(()=>{m(),o=setInterval(()=>{g.value.some(r=>r.current_status&&r.current_status!=="idle")&&m()},3e3)}),H(()=>{o&&clearInterval(o)});const m=async()=>{p.value=!0;try{const r=await L.getJobs();g.value=r.data}catch(r){console.error("Error loading recovery jobs",r)}finally{p.value=!1}},u=async r=>{if(confirm(`Avviare replica per ${r.name}?`))try{await L.runJob(r.id),m()}catch{alert("Errore avvio job")}},V=async r=>{if(confirm("Eliminare questo job di replica?"))try{await L.deleteJob(r.id),m()}catch{alert("Errore eliminazione job")}},F=r=>new Date(r).toLocaleString(),T=r=>r==="success"||r==="OK"?"badge-success":r==="error"||r==="failed"?"badge-danger":r==="running"||r==="backing_up"||r==="restoring"?"badge-running":"badge-secondary",I=r=>({backing_up:"ðŸ“¤ Backup...",restoring:"ðŸ“¥ Restore...",running:"ðŸ”„ In esecuzione...",idle:"Idle"})[r]||r;return x({loadJobs:m}),(r,t)=>(n(),a("div",Pe,[$.embedded?k("",!0):(n(),a("div",Le,[...t[22]||(t[22]=[e("h1",{class:"page-title"},"ðŸ”„ Replica via PBS",-1),e("p",{class:"page-subtitle"},"Sincronizzazione VM tra cluster tramite Proxmox Backup Server",-1)])])),$.embedded?(n(),a("div",Be,[e("button",{class:"btn btn-secondary btn-sm",onClick:m,disabled:p.value},[p.value?(n(),a("span",Fe)):(n(),a("span",Te,"ðŸ”„ Aggiorna"))],8,Ae)])):(n(),a("div",Oe,[e("div",qe,[e("button",{class:"btn btn-secondary btn-sm",onClick:m,disabled:p.value},[p.value?(n(),a("span",Ge)):(n(),a("span",We,"ðŸ”„ Aggiorna"))],8,Ze),e("button",{class:"btn btn-primary btn-sm",onClick:t[0]||(t[0]=l=>f.value=!0)}," + Nuova Replica ")])])),e("div",He,[e("div",Ke,[e("table",Qe,[t[25]||(t[25]=e("thead",null,[e("tr",null,[e("th",null,"Nome"),e("th",null,"VM"),e("th",null,"Path (Srg â†’ PBS â†’ Dst)"),e("th",null,"Schedule"),e("th",null,"Ultimo Run"),e("th",null,"Stato"),e("th",null,"Azioni")])],-1)),e("tbody",null,[(n(!0),a(E,null,N(g.value,l=>(n(),a("tr",{key:l.id},[e("td",null,[e("strong",null,i(l.name),1),e("div",Xe,i(l.backup_mode),1)]),e("td",null,[e("span",Ye,i(l.vm_type)+" "+i(l.vm_id),1),e("div",je,i(l.vm_name),1)]),e("td",et,[S(i(l.source_node_name)+" â†’ ",1),e("span",tt,i(l.pbs_node_name),1),S(" â†’ "+i(l.dest_node_name),1)]),e("td",null,[l.schedule?(n(),a("code",st,i(l.schedule),1)):(n(),a("span",ot,"Manuale"))]),e("td",null,[l.last_run?(n(),a("div",lt,i(F(l.last_run)),1)):k("",!0),l.last_duration?(n(),a("div",nt,i(l.last_duration)+"s ",1)):k("",!0)]),e("td",null,[l.current_status&&l.current_status!=="idle"?(n(),a("div",at,[e("span",it,[t[23]||(t[23]=e("span",{class:"pulse-dot"},null,-1)),S(" "+i(I(l.current_status)),1)])])):(n(),a("div",dt,[e("span",{class:U(["badge",T(l.last_status)])},i(l.last_status||"Never"),3)]))]),e("td",null,[e("div",rt,[e("button",{class:"btn btn-primary btn-xs",onClick:P=>u(l),disabled:l.last_status==="running",title:"Esegui Ora"}," â–¶ï¸ ",8,ut),e("button",{class:"btn btn-secondary btn-xs",onClick:P=>h.value=l,title:"Visualizza Log"}," ðŸ“œ ",8,ct),e("button",{class:"btn btn-secondary btn-xs",onClick:P=>s(l),title:"Modifica"}," âœï¸ ",8,vt),e("button",{class:"btn btn-danger btn-xs",onClick:P=>V(l),title:"Elimina"},"ðŸ—‘ï¸",8,_t)])])]))),128)),g.value.length===0&&!p.value?(n(),a("tr",mt,[...t[24]||(t[24]=[e("td",{colspan:"7",class:"empty-state-cell"},"Nessun job di replica PBS configurato",-1)])])):k("",!0)])])])]),v.value?(n(),a("div",{key:3,class:"modal-overlay",onClick:t[20]||(t[20]=q(l=>v.value=!1,["self"]))},[e("div",pt,[e("div",bt,[e("h3",null,"Modifica Job: "+i(d.name),1),e("button",{class:"close-btn",onClick:t[1]||(t[1]=l=>v.value=!1)},"Ã—")]),e("div",ft,[e("div",yt,[t[30]||(t[30]=e("h4",null,"Informazioni (Non modificabili)",-1)),e("div",gt,[e("div",kt,[t[26]||(t[26]=e("label",null,"VM Sorgente",-1)),e("input",{value:`${d.vm_type} ${d.vm_id} - ${d.vm_name||"N/A"}`,class:"form-control",disabled:""},null,8,ht)]),e("div",$t,[t[27]||(t[27]=e("label",null,"Nodo Sorgente",-1)),e("input",{value:d.source_node_name,class:"form-control",disabled:""},null,8,xt)])]),e("div",Ct,[e("div",St,[t[28]||(t[28]=e("label",null,"Nodo PBS",-1)),e("input",{value:d.pbs_node_name,class:"form-control",disabled:""},null,8,Jt)]),e("div",Vt,[t[29]||(t[29]=e("label",null,"Nodo Destinazione",-1)),e("input",{value:d.dest_node_name,class:"form-control",disabled:""},null,8,wt)])])]),e("div",zt,[t[35]||(t[35]=e("h4",null,"Impostazioni Generali",-1)),e("div",Et,[t[31]||(t[31]=e("label",null,"Nome Job",-1)),y(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>d.name=l),type:"text",class:"form-control"},null,512),[[J,d.name]])]),e("div",Mt,[e("div",Dt,[t[32]||(t[32]=e("label",null,"Schedule (Cron)",-1)),y(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>d.schedule=l),type:"text",class:"form-control",placeholder:"es. 0 2 * * *"},null,512),[[J,d.schedule]]),t[33]||(t[33]=e("small",{class:"text-secondary"},"Formato: minuto ora giorno mese weekday",-1))]),e("div",Rt,[t[34]||(t[34]=e("label",null,"Datastore PBS",-1)),y(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>d.pbs_datastore=l),type:"text",class:"form-control",placeholder:"datastore1"},null,512),[[J,d.pbs_datastore]])])])]),e("div",Nt,[t[41]||(t[41]=e("h4",null,"Backup",-1)),e("div",Ut,[e("div",It,[t[37]||(t[37]=e("label",null,"ModalitÃ  Backup",-1)),y(e("select",{"onUpdate:modelValue":t[5]||(t[5]=l=>d.backup_mode=l),class:"form-control"},[...t[36]||(t[36]=[e("option",{value:"snapshot"},"Snapshot (Live)",-1),e("option",{value:"suspend"},"Suspend",-1),e("option",{value:"stop"},"Stop",-1)])],512),[[A,d.backup_mode]])]),e("div",Pt,[t[39]||(t[39]=e("label",null,"Compressione",-1)),y(e("select",{"onUpdate:modelValue":t[6]||(t[6]=l=>d.backup_compress=l),class:"form-control"},[...t[38]||(t[38]=[e("option",{value:"zstd"},"ZSTD (Consigliato)",-1),e("option",{value:"lzo"},"LZO (Veloce)",-1),e("option",{value:"gzip"},"GZIP",-1),e("option",{value:"none"},"Nessuna",-1)])],512),[[A,d.backup_compress]])])]),e("div",Lt,[e("label",null,[y(e("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=l=>d.include_all_disks=l)},null,512),[[w,d.include_all_disks]]),t[40]||(t[40]=S(" Includi tutti i dischi ",-1))])])]),e("div",Bt,[t[48]||(t[48]=e("h4",null,"Destinazione/Restore",-1)),e("div",At,[e("div",Ft,[t[42]||(t[42]=e("label",null,"VM ID Destinazione",-1)),y(e("input",{"onUpdate:modelValue":t[8]||(t[8]=l=>d.dest_vm_id=l),type:"number",class:"form-control",placeholder:"Stesso della sorgente"},null,512),[[J,d.dest_vm_id,void 0,{number:!0}]])]),e("div",Tt,[t[43]||(t[43]=e("label",null,"Suffisso Nome VM",-1)),y(e("input",{"onUpdate:modelValue":t[9]||(t[9]=l=>d.dest_vm_name_suffix=l),type:"text",class:"form-control",placeholder:"_replica"},null,512),[[J,d.dest_vm_name_suffix]])])]),e("div",Ot,[e("div",qt,[t[44]||(t[44]=e("label",null,"Storage Destinazione",-1)),y(e("input",{"onUpdate:modelValue":t[10]||(t[10]=l=>d.dest_storage=l),type:"text",class:"form-control",placeholder:"local-zfs"},null,512),[[J,d.dest_storage]])])]),e("div",Zt,[e("label",null,[y(e("input",{type:"checkbox","onUpdate:modelValue":t[11]||(t[11]=l=>d.overwrite_existing=l)},null,512),[[w,d.overwrite_existing]]),t[45]||(t[45]=S(" Sovrascrivi se esiste ",-1))])]),e("div",Gt,[e("label",null,[y(e("input",{type:"checkbox","onUpdate:modelValue":t[12]||(t[12]=l=>d.restore_start_vm=l)},null,512),[[w,d.restore_start_vm]]),t[46]||(t[46]=S(" Avvia VM dopo restore ",-1))])]),e("div",Wt,[e("label",null,[y(e("input",{type:"checkbox","onUpdate:modelValue":t[13]||(t[13]=l=>d.restore_unique=l)},null,512),[[w,d.restore_unique]]),t[47]||(t[47]=S(" Genera UUID unici (Consigliato) ",-1))])])]),e("div",Ht,[t[54]||(t[54]=e("h4",null,"Retry e Notifiche",-1)),e("div",Kt,[e("div",Qt,[t[49]||(t[49]=e("label",null,"Max Retry",-1)),y(e("input",{"onUpdate:modelValue":t[14]||(t[14]=l=>d.max_retries=l),type:"number",class:"form-control",min:"0",max:"10"},null,512),[[J,d.max_retries,void 0,{number:!0}]])]),e("div",Xt,[t[50]||(t[50]=e("label",null,"Ritardo Retry (minuti)",-1)),y(e("input",{"onUpdate:modelValue":t[15]||(t[15]=l=>d.retry_delay_minutes=l),type:"number",class:"form-control",min:"1"},null,512),[[J,d.retry_delay_minutes,void 0,{number:!0}]])])]),e("div",Yt,[e("label",null,[y(e("input",{type:"checkbox","onUpdate:modelValue":t[16]||(t[16]=l=>d.retry_on_failure=l)},null,512),[[w,d.retry_on_failure]]),t[51]||(t[51]=S(" Retry automatico su fallimento ",-1))])]),e("div",jt,[e("label",null,[y(e("input",{type:"checkbox","onUpdate:modelValue":t[17]||(t[17]=l=>d.is_active=l)},null,512),[[w,d.is_active]]),t[52]||(t[52]=S(" Job attivo ",-1))])]),e("div",es,[e("label",null,[y(e("input",{type:"checkbox","onUpdate:modelValue":t[18]||(t[18]=l=>d.notify_on_each_run=l)},null,512),[[w,d.notify_on_each_run]]),t[53]||(t[53]=S(" Notifica ad ogni esecuzione ",-1))])])])]),e("div",ts,[e("button",{class:"btn btn-secondary",onClick:t[19]||(t[19]=l=>v.value=!1)},"Annulla"),e("button",{class:"btn btn-primary",onClick:_,disabled:c.value},i(c.value?"Salvataggio...":"Salva Modifiche"),9,ss)])])])):k("",!0),h.value?(n(),z(G,{key:4,"job-id":h.value.id,"job-name":h.value.name,onClose:t[21]||(t[21]=l=>h.value=null)},null,8,["job-id","job-name"])):k("",!0)]))}}),ls=R(os,[["__scopeId","data-v-bb125666"]]),ns={class:"pve-replication-jobs"},as={key:0,class:"loading-state"},is={key:1,class:"empty-state"},ds={key:2,class:"table-container"},rs={class:"data-table"},us={class:"job-id"},cs={class:"vm-info"},vs={key:0,class:"next-sync"},_s=["title"],ms={key:0},ps={key:0,class:"duration"},bs={key:1},fs={class:"actions-cell"},ys=["onClick","disabled"],gs={key:0,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ks={key:1,class:"spinner-small"},hs=["onClick"],$s=M({__name:"PVEReplicationJobs",setup($,{expose:x}){const g=b([]),p=b(!0),f=b(new Set),v=async()=>{p.value=!0;try{g.value=await O.getJobs()}catch(o){console.error("Errore caricamento job PVE Native:",o)}finally{p.value=!1}},c=async o=>{f.value.add(o);try{await O.runJob(o),alert("Replica completata con successo"),await v()}catch(m){alert("Errore durante la replica: "+(m.response?.data?.detail||m.message))}finally{f.value.delete(o)}},d=async o=>{if(confirm(`Sei sicuro di voler eliminare il job ${o}?`))try{await O.deleteJob(o),await v()}catch{alert("Errore eliminazione job")}},C=o=>o.enabled?o.error||o.fail_count&&o.fail_count>0?"status-error":"status-ok":"status-disabled",h=o=>o.enabled?o.error||o.fail_count&&o.fail_count>0?"Errore":"Attivo":"Disabilitato",s=o=>o?new Date(o).toLocaleTimeString():"",_=o=>!o||o==="0"?"-":(o.includes("-")?new Date(o):new Date(parseInt(o)*1e3)).toLocaleString();return D(v),x({loadJobs:v}),(o,m)=>(n(),a("div",ns,[p.value?(n(),a("div",as," Caricamento job in corso... ")):g.value.length===0?(n(),a("div",is," Nessun job di replica nativa PVE configurato. ")):(n(),a("div",ds,[e("table",rs,[m[2]||(m[2]=e("thead",null,[e("tr",null,[e("th",null,"ID / VM"),e("th",null,"Sorgente"),e("th",null,"Destinazione"),e("th",null,"Programmazione"),e("th",null,"Stato"),e("th",null,"Ultima Sincronizzazione"),e("th",null,"Azioni")])],-1)),e("tbody",null,[(n(!0),a(E,null,N(g.value,u=>(n(),a("tr",{key:u.id},[e("td",null,[e("div",us,i(u.id),1),e("div",cs,"VM "+i(u.vm),1)]),e("td",null,i(u.source||"N/A"),1),e("td",null,i(u.target),1),e("td",null,[e("code",null,i(u.schedule),1),u.next_sync?(n(),a("div",vs,"Prox: "+i(s(u.next_sync)),1)):k("",!0)]),e("td",null,[e("span",{class:U(["status-badge",C(u)])},i(h(u)),3),u.error?(n(),a("div",{key:0,class:"error-text",title:u.error}," Errore rilevato ",8,_s)):k("",!0)]),e("td",null,[u.last_sync?(n(),a("div",ms,[S(i(_(u.last_sync))+" ",1),u.duration?(n(),a("div",ps,"("+i(u.duration.toFixed(1))+"s)",1)):k("",!0)])):(n(),a("div",bs,"-"))]),e("td",fs,[e("button",{class:"btn-icon",title:"Esegui ora",onClick:V=>c(u.id),disabled:f.value.has(u.id)},[f.value.has(u.id)?(n(),a("div",ks)):(n(),a("svg",gs,[...m[0]||(m[0]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"},null,-1),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])]))],8,ys),e("button",{class:"btn-icon text-danger",title:"Elimina",onClick:V=>d(u.id)},[...m[1]||(m[1]=[e("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,hs)])]))),128))])])]))]))}}),xs=R($s,[["__scopeId","data-v-fbe80de5"]]),Cs={class:"modal large-modal"},Ss={class:"modal-header"},Js={class:"header-left"},Vs={class:"job-id-badge"},ws={class:"modal-body"},zs={class:"grid-2 mb-6"},Es={class:"info-card"},Ms={class:"value highlight"},Ds={class:"sub-value"},Rs={key:0,class:"sub-label"},Ns={class:"info-card"},Us={class:"value"},Is={class:"form-group mt-2"},Ps=["placeholder"],Ls={class:"form-container"},Bs={class:"grid-3"},As={class:"form-group"},Fs={key:0,class:"form-group"},Ts={class:"form-group"},Os={class:"grid-3 mt-4"},qs={class:"form-group checkbox-group"},Zs={class:"checkbox-label"},Gs={class:"form-group checkbox-group"},Ws={class:"checkbox-label"},Hs={class:"grid-2"},Ks={class:"form-group checkbox-group centered"},Qs={class:"checkbox-label"},Xs={class:"form-group"},Ys={class:"modal-footer"},js=["disabled"],eo=M({__name:"SyncJobEdit",props:{job:{}},emits:["close","saved"],setup($,{emit:x}){const g=$,p=x,f=b(!1),v=b("manual"),c=Z({dest_dataset:"",schedule:"",compress:"lz4",recursive:!1,enabled:!0,register_vm:!1,dest_vm_id:null});D(()=>{c.dest_dataset=g.job.dest_dataset,c.schedule=g.job.schedule||"",c.compress=g.job.compress||"lz4",c.recursive=g.job.recursive,c.enabled=g.job.enabled!==!1,c.schedule?c.schedule==="0 * * * *"?v.value="hourly":c.schedule==="0 0 * * *"?v.value="daily":v.value="custom":v.value="manual"});const d=()=>{v.value==="manual"?c.schedule="":v.value==="hourly"?c.schedule="0 * * * *":v.value==="daily"&&(c.schedule="0 0 * * *")},C=async()=>{f.value=!0;try{await B.updateJob(g.job.id,{dest_dataset:c.dest_dataset,schedule:c.schedule,compress:c.compress,recursive:c.recursive,enabled:c.enabled}),p("saved"),p("close")}catch(h){alert("Errore salvataggio: "+(h.response?.data?.detail||h.message))}finally{f.value=!1}};return(h,s)=>(n(),a("div",{class:"modal-overlay",onClick:s[10]||(s[10]=q(_=>h.$emit("close"),["self"]))},[e("div",Cs,[e("div",Ss,[e("div",Js,[e("h3",null,"Modifica Replica: "+i($.job.job_name),1),e("span",Vs,i($.job.id),1)]),e("button",{class:"btn-icon",onClick:s[0]||(s[0]=_=>h.$emit("close"))},"âœ•")]),e("div",ws,[s[28]||(s[28]=e("div",{class:"section-title"},"ðŸ“ Origine & Destinazione",-1)),e("div",zs,[e("div",Es,[s[11]||(s[11]=e("div",{class:"label"},"Sorgente",-1)),e("div",Ms,i($.job.source_node_name),1),e("div",Ds,i($.job.source_dataset),1),$.job.vm_id?(n(),a("div",Rs,"VM ID: "+i($.job.vm_id),1)):k("",!0)]),e("div",Ns,[s[13]||(s[13]=e("div",{class:"label"},"Destinazione (Nodo)",-1)),e("div",Us,i($.job.dest_node_name),1),e("div",Is,[s[12]||(s[12]=e("label",{class:"text-xs"},"Dataset Destinazione",-1)),y(e("input",{type:"text","onUpdate:modelValue":s[1]||(s[1]=_=>c.dest_dataset=_),class:"form-input text-xs",placeholder:$.job.dest_dataset},null,8,Ps),[[J,c.dest_dataset]])])])]),s[29]||(s[29]=e("div",{class:"section-title"},"âš™ï¸ Configurazione",-1)),e("div",Ls,[e("div",Bs,[e("div",As,[s[15]||(s[15]=e("label",null,"Schedule",-1)),y(e("select",{"onUpdate:modelValue":s[2]||(s[2]=_=>v.value=_),onChange:d,class:"form-input"},[...s[14]||(s[14]=[e("option",{value:"manual"},"ðŸ”’ Manuale",-1),e("option",{value:"hourly"},"â° Ogni ora",-1),e("option",{value:"daily"},"ðŸ“… Giornaliero",-1),e("option",{value:"custom"},"âœï¸ Personalizzato",-1)])],544),[[A,v.value]])]),v.value==="custom"?(n(),a("div",Fs,[s[16]||(s[16]=e("label",null,"Custom Cron",-1)),y(e("input",{type:"text","onUpdate:modelValue":s[3]||(s[3]=_=>c.schedule=_),class:"form-input"},null,512),[[J,c.schedule]])])):k("",!0),e("div",Ts,[s[18]||(s[18]=e("label",null,"Compressione",-1)),y(e("select",{"onUpdate:modelValue":s[4]||(s[4]=_=>c.compress=_),class:"form-input"},[...s[17]||(s[17]=[e("option",{value:"lz4"},"LZ4 (Veloce)",-1),e("option",{value:"zstd"},"ZSTD (Bilanciato)",-1),e("option",{value:"gzip"},"GZIP",-1),e("option",{value:"none"},"Nessuna",-1)])],512),[[A,c.compress]])])]),e("div",Os,[e("div",qs,[e("label",Zs,[y(e("input",{type:"checkbox","onUpdate:modelValue":s[5]||(s[5]=_=>c.recursive=_)},null,512),[[w,c.recursive]]),s[19]||(s[19]=e("span",{class:"check-text"},"Ricorsivo (-r)",-1))]),s[20]||(s[20]=e("div",{class:"help-text"},"Include snapshot e descendent",-1))]),e("div",Gs,[e("label",Ws,[y(e("input",{type:"checkbox","onUpdate:modelValue":s[6]||(s[6]=_=>c.enabled=_)},null,512),[[w,c.enabled]]),s[21]||(s[21]=e("span",{class:"check-text"},"Abilitato",-1))]),s[22]||(s[22]=e("div",{class:"help-text"},"Attiva/Disattiva esecuzione automatica",-1))])]),s[26]||(s[26]=e("div",{class:"separator mt-4 mb-4"},null,-1)),s[27]||(s[27]=e("div",{class:"section-title"},"ðŸ–¥ï¸ Registrazione VM",-1)),e("div",Hs,[e("div",Ks,[e("label",Qs,[y(e("input",{type:"checkbox","onUpdate:modelValue":s[7]||(s[7]=_=>c.register_vm=_)},null,512),[[w,c.register_vm]]),s[23]||(s[23]=e("span",{class:"check-text"},"Registra VM su destinazione",-1))])]),e("div",Xs,[s[24]||(s[24]=e("label",null,"ID VM Destinazione (Opzionale)",-1)),y(e("input",{type:"number","onUpdate:modelValue":s[8]||(s[8]=_=>c.dest_vm_id=_),class:"form-input",placeholder:"Auto"},null,512),[[J,c.dest_vm_id]]),s[25]||(s[25]=e("div",{class:"help-text"},"Lascia vuoto per auto-assegnazione",-1))])])])]),e("div",Ys,[e("button",{class:"btn btn-secondary",onClick:s[9]||(s[9]=_=>h.$emit("close"))},"Annulla"),e("button",{class:"btn btn-primary",onClick:C,disabled:f.value},i(f.value?"Salvataggio...":"Salva Modifiche"),9,js)])])]))}}),to=R(eo,[["__scopeId","data-v-7a8af82f"]]),so={class:"replication-view"},oo={class:"stats-grid"},lo={class:"stat-card"},no={class:"stat-value"},ao={class:"stat-card"},io={class:"stat-value text-success"},ro={class:"stat-card"},uo={class:"stat-value text-danger"},co={class:"tabs"},vo=["onClick"],_o={class:"tab-content"},mo=M({__name:"Replication",setup($){const x=b("syncoid"),g=b(!1),p=b(!1),f=b(null),v=b(),c=b(),d=b(),C=[{id:"syncoid",label:"Syncoid (ZFS)"},{id:"pve",label:"PVE Native"},{id:"pbs",label:"PBS Replication"}],h=b(0),s=b(0),_=b(0),o=()=>{f.value=null,g.value=!0},m=r=>{f.value=r,x.value==="syncoid"?p.value=!0:alert("Modifica non ancora implementata per questo tipo di job")},u=()=>{g.value=!1,f.value=null},V=()=>{p.value=!1,f.value=null},F=()=>{u(),I()},T=()=>{V(),I()},I=()=>{x.value==="syncoid"&&v.value?v.value.loadJobs():x.value==="pve"&&d.value?d.value.loadJobs():x.value==="pbs"&&c.value&&c.value.loadJobs()};return D(()=>{}),(r,t)=>(n(),a("div",so,[e("div",{class:"header-section"},[t[1]||(t[1]=e("div",null,[e("h1",null,"Gestione Repliche"),e("p",{class:"subtitle"},"Sistema unificato per Syncoid, PVE Native e PBS Recovery")],-1)),e("div",{class:"actions"},[e("button",{class:"btn-primary",onClick:o},[...t[0]||(t[0]=[e("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),S(" Nuova Replica ",-1)])])])]),e("div",oo,[e("div",lo,[t[2]||(t[2]=e("div",{class:"stat-label"},"Job Attivi",-1)),e("div",no,i(h.value),1)]),e("div",ao,[t[3]||(t[3]=e("div",{class:"stat-label"},"Successi (24h)",-1)),e("div",io,i(s.value),1)]),e("div",ro,[t[4]||(t[4]=e("div",{class:"stat-label"},"Fallimenti (24h)",-1)),e("div",uo,i(_.value),1)])]),e("div",co,[(n(),a(E,null,N(C,l=>e("button",{key:l.id,class:U(["tab-btn",{active:x.value===l.id}]),onClick:P=>x.value=l.id},i(l.label),11,vo)),64))]),e("div",_o,[x.value==="syncoid"?(n(),z(Ie,{key:0,ref_key:"syncJobsRef",ref:v,onEdit:m},null,512)):x.value==="pbs"?(n(),z(ls,{key:1,ref_key:"pbsJobsRef",ref:c},null,512)):x.value==="pve"?(n(),z(xs,{key:2,ref_key:"pveJobsRef",ref:d},null,512)):k("",!0)]),g.value?(n(),z(K,{key:0,"editing-job":f.value,onClose:u,onCreated:F},null,8,["editing-job"])):k("",!0),p.value&&f.value?(n(),z(to,{key:1,job:f.value,onClose:V,onSaved:T},null,8,["job"])):k("",!0)]))}}),bo=R(mo,[["__scopeId","data-v-1a4e6d46"]]);export{bo as default};
